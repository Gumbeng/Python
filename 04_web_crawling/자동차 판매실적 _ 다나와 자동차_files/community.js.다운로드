/**
 * 
 */

var cheditor = '';

$(document).ready(function() {
		$('#comment_form input[name="Action"]').val('add')
		$('.commentList .input .left textarea').val('');
});

$(function () {
	
	if (gnb == 'news') {
		
		$(document).on('click', '#newsAdver', function(){
			eval('try{ _trk_clickTrace( \'EVT\', \'자동차_삼성 보험 버튼_게시물 하단(웹)\' ); }catch(_e){ }');
		});

		$(document).on('click', '#btnNewsAdver', function(){
			eval('try{ _trk_clickTrace( \'EVT\', \'자동차_삼성 보험 버튼_게시물 하단 관련 차종(웹)\' ); }catch(_e){ }');
		});
		
		//뉴스 게시물 추천
    	$('.newsViewer .board_exp div.recome a').live('click', function () {
    		var no = $(this).attr('code');
    		var recomeNo = $(this).find("span").text()*1;

    		if(no>0){		
    			$.ajax({
    				url:webUrl+'/action/news.action.php',
    				type:'POST',
    				dataType : 'JSON',
    				data:{
    					'action' : "recommend",
    					'no' : no
    				},
    				success:function (data) {
    					console.dir(data);
    		    		if (data['result'] == 'success'){
    		    			$(".newsViewer div.recome a span").text(recomeNo+1);
    		    			$(".newsViewer div.info .recome.cont").text(recomeNo+1);
    		    		}
    		    		else{
    		    			if (data['alert']){
    		    				alert(data['msg']);
    		    			}
    		    		}
    				},
    				error:function (err) {
    					alert('오류가 발생하였습니다.');
    				}
    			});//ajax end
    		}//if end
    	});//recome end
    
    	// 주요뉴스 앵커이동
    	$('.newsGrouplist li a[href*=#]').live('click', function(event){     
    	    event.preventDefault();
    	    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 300);
    	});
		
    	// 블라인드
    	$(document).on("click", "#blindButton", function() {
			$("#popup_data").html($("#blindArea").html());
			openPopup('블라인드', 600, 'center');
		});

		$(document).on("click", "#blindRevertButton", function() {
			$("#popup_data").html($("#blindRevertArea").html());
			openPopup('블라인드', 600, 'center');
		});

		//blindCancel
		$(document).on("click", "#blindCancel, #blindRevertCancel", function() {
			$("#autodanawa_popup").addClass("off");
		});
		
		//blindRegist
		$(document).on("click", "#blindRegist", function() {
			if ($("input[name=blind]:checked").val()) {
				var boardNo = 0;
				
				if($("#comment_form").length > 0) {
					boardNo = $("#comment_form input[name='ContentsNo']").val();
				}
				else if($("#answerForm").length > 0) {
					boardNo = $("#answerForm input[name='boardNo']").val();
				}
				
				$.ajax({
					url: webUrl+"/action/community.action.ajax.php",
					type: "POST",
					data: {
						"action":"change",
						"no":boardNo,
						"blind":$("input[name=blind]:checked").val(),
						"backwards":location.search
					},
					dataType: "json",
					contentType: "application/x-www-form-urlencoded; charset=UTF-8",
					async: true,
					cache: false,
					beforeSend: function () {
						$("#loading").show();
					},
					complete: function () {
						$("#loading").hide();
					},
					success: function (data) {
						$("#autodanawa_popup").addClass("off");
						alert(data.message);
						$(location).attr('href', data.url);
					},
					error: function (request, error) {
						console.log('error : ' + error);
						$("#loading").hide();
					}
				});
			}
			else {
				alert("블라인드 종류를 선택해주세요.3");
			}
		});

		// 블라인드 복원
		$(document).on("click", "#blindRevertExec", function() {
			var boardNo = 0;
			
			if($("#comment_form").length > 0) {
				boardNo = $("#comment_form input[name='ContentsNo']").val();
			}
			else if($("#answerForm").length > 0) {
				boardNo = $("#answerForm input[name='boardNo']").val();
			}
			
			$.ajax({
				url: webUrl+"/action/community.action.ajax.php",
				type: "POST",
				data: {
					"action":"change",
					"no":boardNo,
					"blind":"0",
					"backwards":location.search
				},
				dataType: "json",
				contentType: "application/x-www-form-urlencoded; charset=UTF-8",
				async: true,
				cache: false,
				beforeSend: function () {
					$("#loading").show();
				},
				complete: function () {
					$("#loading").hide();
				},
				success: function (data) {
					$("#autodanawa_popup").addClass("off");
					alert(data.message);
					$(location).attr('href', data.url);
				},
				error: function (request, error) {
					console.log('error : ' + error);
					$("#loading").hide();
				}
			});
		});
		// 블라인드
		
		// 말머리 (자유게시판)
		$(document).on("change", "#headTextSelect", function(){

			var aUrl = location.search.split("&HeadText");
			var aUrl2 = '';
			if(aUrl[1] && aUrl[1].indexOf('&') != -1) {
				aUrl2 = aUrl[1].split("&"); 
				aUrl2 = '&' + aUrl2[0];
			}

			window.location=aUrl[0] + aUrl2 + '&HeadText='+$(this).val();
		});
		
		
		if (lnb == 'home') {
			
		}
		else if (lnb == 'list') {
			
			// 커뮤니티 영역
			if (tab == 'gossip') {
				
			}
			else if (tab == 'freeboard') {
				
			}
			else if (tab == 'review') {
				
			}
			else if (tab == 'driveuse') {
				
			}
			else if (tab == 'qna') {
				$(document).on("click", "#searchBtn", function(){
					location.href="/talk/?Tab=recommend&Work=qna&searchType="+$("#searchType").val()+"&searchKeyword="+$("#searchKeyword").val();
				});
			}
			else if (tab == 'movie') {
				$(document).on('click', '#autodanawa_gridC .btn_news_multimedia', function () {
					openAutoTab('brand');
				});

			}
			else if (tab == 'photo') {
				$(document).on('click', '#autodanawa_gridC .btn_news_multimedia', function () {
					openAutoTab('brand');
				});
			}
			// news 영역
			else {

				// 모터쇼 롤링
				tabButton('motorshowInfoBox');
				
				function tabButton(thms){
					$("#"+thms+" .TabContents > li").each(function(){
						if($(this).hasClass("on")) thisTab = "on";
						else thisTab=""
						$("#"+thms+" .TabButton").append($("<li class='"+thisTab+"'></li>"));
					});
				}
			}
		}
		// 궁금했차
		else if (lnb == 'qna') {
			var selectBrandSeq = '';
			var selectModelSeq = '';
			var selectLineupSeq = '';
			var selectString = '';

			$(document).on("click", "#searchBtn", function(){
				location.href="/talk/?Tab=recommend&Work=qna&searchType="+$("#searchType").val()+"&searchKeyword="+$("#searchKeyword").val();
				
			});

			// 문의 글 등록
			$(document).on("click", "#qnaBtn", function() {
				if($.cookie('dasysMSeq')) {
					if($.cookie("dasysMcut")) {
						if($.cookie("dasysMcut").indexOf('B') > -1 || $.cookie("dasysMcut").indexOf('b') > -1) {
							alert("본 계정은 자유게시판 글쓰기가 제한되었습니다.\n다나와자동차 고객센터 1644-3834(유료)로 문의 해주세요.");
							return false;
						}
					} else {
						if ($("#qnaSubject").val() == "") {
							alert("제목을 입력해주세요.");
							return false;
						} else if ($(".qnaContents").val() == "") {
							alert("내용을 입력해주세요.");
							return false;
						} else {
							if (confirm("문의 하시겠습니까?") == true) {    //확인
								frmSubmit('add', '');
							}
						}
					}
				} else {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {    //확인
						loginPopup();
					}
					
				}
			});

			function frmSubmit(actionType, boardSeq) {
				if (actionType == 'add') {
					var url = apiUrl + "/v1/I/community/?type=boardWrite";
				} else if (actionType == 'modify') {
					var url = apiUrl + "/v1/U/community/"+boardSeq+"/?type=boardWrite";
				}
			
				$("#contents").val(encodeURIComponent($(".qnaContents").val()));
			
				$('#qnaFrom').ajaxForm({
					url: url,
					type: 'POST',
					dataType : 'json',
					success: function(result){
					},
					complete: function () {
						location.reload();
					}
				});
			
				$("#qnaFrom").submit();
				return false;
			}

			// 문의글 수정
			$(document).on("click", "#qnaModifyBtn", function(){
				if($.cookie('dasysMSeq')) {
					if($.cookie("dasysMcut")) {
						if($.cookie("dasysMcut").indexOf('B') > -1 || $.cookie("dasysMcut").indexOf('b') > -1) {
							alert("본 계정은 자유게시판 글쓰기가 제한되었습니다.\n다나와자동차 고객센터 1644-3834(유료)로 문의 해주세요.");
							return false;
						}
					} else {
						if ($("#qnaSubject").val() == "") {
							alert("제목을 입력해주세요.");
							return false;
						} else if ($(".qnaContents").val() == "") {
							alert("내용을 입력해주세요.");
							return false;
						} else {
							if (confirm("수정 하시겠습니까?") == true) {    //확인
								var boardSeq = $(this).attr("value");
								frmSubmit('modify', boardSeq);
							}
						}
					}
				} else {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {
						loginPopup();
					}
				}
			});
			
			$(document).on("click", ".qna_comment .qnaModify", function() {
				$(this).parent().parent().parent().parent().find(".form").toggleClass("off")
			});

			// 삭제
			$(document).on("click", ".qnaDelete", function(){
				if (confirm("정말 삭제하시겠습니까?") == true) {    //확인
					var url = apiUrl + "/v1/U/community/"+$(this).attr("value")+"/?type=boardDelete&memNo="+$("#answerForm input[name='memNo']").val();
					
					$.ajax({
						url : url,
						type: 'GET',
						dataType : 'json',
						success: function(result){
							location.href="/talk/?Tab=recommend&Work=qna";
						}
					});
				} else {
					return false;
				}
			});


			//궁금했.차 > 상세 > 글 수정
			$(document).on("click", ".container_qna .detail_action .left .btn_modify , .container_qna .detail_modify .button_area .btn_modify", function() {
				$(".container_qna .qna_detail .detail_area").toggleClass("off")
				$(".container_qna .qna_detail .detail_modify").toggleClass("off")
				$(".container_qna .qna_detail .detail_reply").toggleClass("off")
				$(".container_qna .qna_detail .detail_action .left").toggleClass("off")
			});

			//궁금했.차 > 상세 > 답변달기
			$(document).on("click", ".qna_detail .detail_reply .btn_reply, .container_qna .qna_detail .replay_action .btn_cancel", function() {
				
				if(!$.cookie('dasysMSeq')) {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {
						loginPopup();
					}
					return false;
				}
				else {
					$(".container_qna .qna_detail .detail_reply .reply_open").toggleClass("off")
					$(".container_qna .qna_detail .detail_reply .reply_write").toggleClass("off")
				}
			});

			//궁금했.차 > 상세 > 답변수정
			$(document).on("click", ".container_qna .reply_list .writer_action .btn_modify, .container_qna .qna_reply .replay_action .btn_cancel", function() {
				$(this).parent().parent().parent().find(".writer_action").toggleClass("off")
				$(this).parent().parent().parent().find("> .contents").toggleClass("off")
				$(this).parent().parent().parent().find(".reply_write").toggleClass("off")
			});

			//궁금했.차 > 답변 > 의견
			$(document).on("click", ".container_qna .reply_list .action .btn_reply", function() {
				$(this).parent().parent().parent().find(".new_comment").toggleClass("off")
			});
			
			//궁금했.차 > 답변 > 의견수정
			$(document).on("click", ".container_qna .reply_list .comment_area .user .action .btn_modify", function() {
				$(this).parent().parent().toggleClass("off")
				$(this).parent().parent().parent().parent().find(".contents").toggleClass("off")
				$(this).parent().parent().parent().parent().find(".comment_write").toggleClass("off")
			});

			//궁금했.차 > 답변 > 의견수정 > 취소
			$(document).on("click", ".container_qna .reply_list .comment_write .action .btn_cancel", function() {
				$(this).parent().parent().toggleClass("off")
				$(this).parent().parent().parent().find(".contents").toggleClass("off")
				$(this).parent().parent().parent().find(".user .action").toggleClass("off")
			});

			$(document).on("click", ".qnaLineup", function(){
				var selectModelNumber = $("#selectModel").val();
				
				var brand = $(this).attr("brand");
				var model = $(this).attr("model");
				var lineup = $(this).attr("lineup");

				$("#suggestBrand"+selectModelNumber).val(brand);
				$("#suggestModel"+selectModelNumber).val(model);
				$("#suggestLineup"+selectModelNumber).val(lineup);
				
				if (lineup != "") {
					selectString = $(this).find("span").attr("modelName")+" "+$(this).find("span").eq(0).text();
				} else {
					selectString =  $(this).find("span").attr("modelName");
				}

				$(".btn_model"+selectModelNumber).addClass("sel_model");
				$(".btn_model"+selectModelNumber).text(selectString);
				selectString ="";

				 history.back(-1);
			});

			//브랜드 선택 (2204 파인더 개선)
			$(document).on("click", ".container_qna .reply_write .recommend_model .btn_model", function() {
				$("#selectModel").val($(this).attr("value"));
				openAutoTab('brand');
			});

			// 댓글 추천
			$(document).on("click", ".recome", function () { 
				if(!$.cookie('dasysMSeq')) {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {
						loginPopup();
					}
					return false;
				}
				// action 작업 필요
				var no = $(this).attr('key');
				var recomeNo = $(this).find("em").text()*1;
				
				if (no>0) {		
					$.ajax({
						url:'/event/campaign/action/commentAction.php',
						type:'POST',
						dataType : 'JSON',
						async: false,
						data:{
							'action' : "recommend",
							'CommentNo' : no
						},
						success:function (data) {
							console.log(data['message']);
							if( data['code'] ==1 ) {
								alert(data['message']);
								recomeNo = recomeNo+1;
							} else {
								alert(data['message']);
							}
						},
						error:function (err) {
							alert('오류가 발생하였습니다.');
						}
					});//ajax end

					$(this).find("em.recommNum").text(recomeNo);
					$(this).addClass("my");
				}//if end
			});//recomm end

			$(document).on("click", ".commentSave", function(){
				if(!$.cookie('dasysMSeq')) {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {
						loginPopup();
					}
					return false;
				}
				if ($("#answerComment").val() == "") {
					alert("답변을 입력하세요.");
					return false;
				} else {
					$("#comment").val($("#answerComment").val());
				
				
					var brandStr = "";
					var modelStr = "";
					
					for( var i=1; i<4; i++) {
						if ($("#suggestBrand"+i).val() != "") {
							brandStr += $("#suggestBrand"+i).val();
							brandStr += "|";
						}
						
						if ($("#suggestModel"+i).val() != "") {
							modelStr += $("#suggestModel"+i).val();
							if ($("#suggestLineup"+i).val() != "") {
								modelStr += "_"+$("#suggestLineup"+i).val();
							}
							modelStr += "|";
						}
					}

					$("#answerBrand").val(brandStr);
					$("#answerModel").val(modelStr);
					
					frmCommentSubmit('');
				}
			});

			$(document).on("click", ".commentModifySave", function(){
				if(!$.cookie('dasysMSeq')) {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {
						loginPopup();
					}
					return false;
				}
				var commentSeq = $(this).attr("value");
				if ($("#answerComment"+commentSeq).val() == "") {
					alert("답변을 입력하세요.");
					return false;
				} else {
					$("#comment"+commentSeq).val($("#answerComment"+commentSeq).val());
				
				
					var brandStr = "";
					var modelStr = "";
					
					for( var i=1; i<4; i++) {
						if ($("#suggestBrand"+commentSeq+"_"+i).val() != "") {
							brandStr += $("#suggestBrand"+commentSeq+"_"+i).val();
							brandStr += "|";
						}
						
						if ($("#suggestModel"+commentSeq+"_"+i).val() != "") {
							modelStr += $("#suggestModel"+commentSeq+"_"+i).val();
							if ($("#suggestLineup"+commentSeq+"_"+i).val() != "") {
								modelStr += "_"+$("#suggestLineup"+commentSeq+"_"+i).val();
							}
							modelStr += "|";
						}
					}

					
					$("#answerBrand"+commentSeq).val(brandStr);
					$("#answerModel"+commentSeq).val(modelStr);
					
					frmCommentSubmit(commentSeq);
				}
			});

			function frmCommentSubmit(commentSeq, commentType) {
				$("#comment"+commentSeq).val(encodeURIComponent($("#comment"+commentSeq).val()));
				
				var url = "";
				if (commentSeq == "") {
					url = apiUrl + "/v1/I/community/?type=commentWrite";
				} else if (commentSeq > 0 ) {
					url = apiUrl + "/v1/U/community/"+commentSeq+"/?type=commentModify";
				} else {
					alert("잘못된 요청입니다.");
					return false;
				}

				if (commentType == "recomment") {
					commentSeq = "";
				}

				$('#answerForm'+commentSeq).ajaxForm({
					url: url,
					type: 'POST',
					dataType : 'json',
					success: function(result){
					},
					complete: function () {
						 location.reload();
					}
				});

				$("#answerForm"+commentSeq).submit();
				return false;
			}

			$(document).on("click", ".commentDelete", function(){

				if (confirm("정말 삭제하시겠습니까?") == true) {    //확인
					
					var commentSeq = $(this).attr("value");
					var parentcmt = $(this).attr("parentcmt");
					var sApiStr = "&parentcmt=0";
					if (parentcmt != "undefined" || parentcmt != "") {
						sApiStr +=  "&parentcmt="+parentcmt;
					}
					var url = apiUrl + "/v1/U/community/"+commentSeq+"/?type=commentDelete&memNo="+$("#answerForm input[name='memNo']").val()+"&no="+$("#boardNo").val()+sApiStr;

					$.ajax({
						url : url,
						type: 'GET',
						dataType : 'json',
						success: function(result){
						//	console.log(result);
						},
						complete: function () {
							 location.reload();
						}
					});
				} else {
					return false;
				}
			});


			$(document).on("click", ".comment_save", function(){
				if(!$.cookie('dasysMSeq')) {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {
						loginPopup();
					}
					return false;
				}
				//var boardNo = $("#boardNo").val();
				if ($(this).parent().parent().find("textarea").val() == "") {
					alert("댓글을 입력하세요.");
					return false;
				} else {
					$("#comment").val($(this).parent().parent().find("textarea").val());
					if ($(this).parent().parent().parent().find("div").eq(0).attr("depth") != undefined) {
						var depth = Number($(this).parent().parent().parent().find("div").eq(0).attr("depth"))+Number(1);
						var parentCmt = $(this).parent().parent().parent().find("div").eq(0).attr("parentCmt");
						$("#depth").val(depth);
						$("#parentCmt").val(parentCmt);
					}
				}
				
				frmCommentSubmit('');
			});

			$(document).on("click", ".recomment_save", function(){
				if(!$.cookie('dasysMSeq')) {
					if (confirm("로그인이 필요한 페이지 입니다.") == true) {
						loginPopup();
					}
					return false;
				}
				//var boardNo = $("#boardNo").val();
				var recommentSeq = '';
				if ($(this).parent().parent().find("textarea").val() == "") {
					alert("댓글을 입력하세요.");
					return false;
				} else {
					recommentSeq = $(this).attr("recommentSeq");
					
					$("#comment").val($(this).parent().parent().find("textarea").val());
					if ($(this).parent().parent().parent().attr("depth") != undefined) {
						var depth = Number($(this).parent().parent().parent().attr("depth"))+Number(1);
						var parentCmt = $(this).parent().parent().parent().find("div").eq(0).attr("parentCmt");
						$("#depth").val(depth);
						$("#parentCmt").val(parentCmt);
					}
					
				}
				
				frmCommentSubmit(recommentSeq, "recomment");
			});
		}
		else if (lnb == 'detail') {
			
			// 뉴스 상세 > 판매조건 보기
			$(document).on("click", ".model_info a[name='newcarSales']", function () {
			    getHttprequest(webUrl+"/theme/modelSales.php?model="+ $(this).attr('model') + '&brand=' + $(this).attr('brand'), 'popup_data');
			    openPopup($(this).parent().parent().find('.clearFix .info .subj strong').text() + ' 판매조건', 600, 'center');
			});
			
		}
	}
	else if (0) {
		
	}
	
});

// 댓글 버튼 클릭
$('.commentList .recmnt').live('click', function () {
		var currentCommentKey = $(this).attr('key');
		var currentCommentCode = $('#comment_'+ currentCommentKey).attr('code');
		var currentCommentAction = $('#comment_form input[name="Action"]').val();
		var currentCommentBoxDisplay = $('#comment_'+ currentCommentKey +' .input').css('display');
		
		if (currentCommentAction != 'add' && currentCommentAction.length > 0) {
			$('#comment_form input[name="Action"]').val('add');
			$('.commentList .input').css('display', 'none');
			$('.commentList .input .left textarea').val('');
			
			$('#comment_'+ currentCommentKey +' .input .secret').removeClass('off');
			$('#comment_'+ currentCommentKey +' .input').css('display', 'block');
		}
		else {
			if (currentCommentBoxDisplay == 'none') {
				$('#comment_form input[name="Action"]').val('add');
				$('.commentList .input').css('display', 'none');
				$('.commentList .input .left textarea').val('');
				
				$('#comment_'+ currentCommentKey +' .input').css('display', 'block');
			}
			else {
				$('#comment_form input[name="Action"]').val('');
				$('#comment_'+ currentCommentKey +' .input .left textarea').val('');
				
				$('#comment_'+ currentCommentKey +' .input').css('display', 'none');
			}
		}
	});

// 수정 버튼 클릭
$('.commentList .modify').live('click', function () {
		var currentCommentKey = $(this).attr('key');
		var currentCommentCode = $('#comment_'+ currentCommentKey).attr('code');
		var currentCommentAction = $('#comment_form input[name="Action"]').val();
		var currentCommentBoxDisplay = $('#comment_'+ currentCommentKey +' .input').css('display');
		var currentCommentBoxContents = $('#comment_'+ currentCommentKey +' > .left .text').html().trim();
		currentCommentBoxContents = currentCommentBoxContents.replace(/(<|<\;)br\s*\/*(>|>\;)/gi, "\r");
		
		if (currentCommentAction != 'modify' && currentCommentAction.length > 0) {
			$('#comment_form input[name="Action"]').val('modify');
			$('.commentList .input').css('display', 'none');
			$('.commentList .input .left textarea').val('');
			
			$('#comment_'+ currentCommentKey +' .input .secret').addClass('off');
			$('#comment_'+ currentCommentKey +' .input .left textarea').val(currentCommentBoxContents);
			$('#comment_'+ currentCommentKey +' .input').css('display', 'block');
		}
		else {
			if (currentCommentBoxDisplay == 'none') {
				$('#comment_form input[name="Action"]').val('modify');
				$('.commentList .input').css('display', 'none');
				
				$('#comment_'+ currentCommentKey +' .input .left textarea').val(currentCommentBoxContents);
				$('#comment_'+ currentCommentKey +' .input').css('display', 'block');
			}
			else {
				$('#comment_form input[name="Action"]').val('');
				$('#comment_'+ currentCommentKey +' .input .left textarea').val('');
				
				$('#comment_'+ currentCommentKey +' .input').css('display', 'none');
			}
		}
	});

$('.commentList .delete').live('click', function () {
		var currentCommentKey = $(this).attr('key');
		var currentCommentCode = $('#comment_'+ currentCommentKey).attr('code');
		var borderKey = $('#comment_form input[name="BorderKey"]').val();
		
		$('.commentList .input').css('display', 'none');
		$('#comment_form input[name="Action"]').val('delete');
		
		execCommentProcess(currentCommentKey, currentCommentCode, borderKey);
	});

$('.commentList .report').live('click', function () {
	
	var commentKey = $(this).attr('key');
	var commentTtitle = $('#comment_'+ commentKey + " div.text").text();
	
	openReportPopup(1, commentKey, commentTtitle);
});

$('#reportLayer #reportKindText').live('change', function () {
		if ($(this).val() == '기타') {
			$('#reportLayer #reportEtcContents').css('display', 'block');
		}
		else {
			$('#reportLayer #reportEtcContents').css('display', 'none');
		}
	});

$('#reportLayer #report').live('click', function () {
		var reportKindText = $('#reportLayer #reportKindText').val().trim();
		var reportKey = $('#reportLayer #reportKey').val();
		var reportCode = $('#reportLayer #reportCode').val();
		var reportTarget = $('#reportLayer #reportTarget').val();
		var reportTargetGnb = $('#reportLayer #reportTargetGnb').val();
		var reportTargetLnb = $('#reportLayer #reportTargetLnb').val();
		
		if (reportKindText.length == 0) {
			alert('신고 사유를 선택해주세요.');
		}
		else if (reportKindText == '기타') {
			if ($('#reportLayer #reportEtcContents').val().trim().length == 0) {
				alert('기타 사유의 경우 추가 내용을 입력해주세요.');
				reportKindText
				reportKindText = '';
			}
			else {
				reportKindText += ' : ' + $('#reportLayer #reportEtcContents').val().trim();
			}
		}
		
		if (reportKindText.length > 0) {
			if (reportTarget == 'comment') {
				var currentDepth = 0;
				
				$('#comment_form textarea').val(reportKindText);
				$('#comment_form input[name="CommentCode"]').val(reportCode);
				$('#comment_form input[name="CommentNo"]').val(reportKey);
				
				if ($('#comment_'+ reportKey).attr('class').indexOf('depth') != -1) {
					currentDepth = Number($('#comment_'+ reportKey).attr('class').replace('depth', ''));
				}
				
				$('#comment_form input[name="CommentDepth"]').val(currentDepth);
				
				document.comment_form.submit();
			}
			else if (reportTarget == 'request') {
				$.post('/action/report.action.php',
						{
							ReportKey:reportKey,
							ReportHashCode:reportCode,
							ReportContents:reportKindText,
							ReportTarget:reportTarget,
							ReportTargetGnb:reportTargetGnb,
							ReportTargetLnb:reportTargetLnb
						},
						function (data, status) {
							if (data == 0 && status == 'success') {
								$("#autodanawa_popup").addClass("off");
								alert('신고하신 게시물입니다.');
							}
							else if (data == -1 || status != 'success') {
								alert('신고 내용 접수 중 오류가 발생하였습니다.');
								$('#reportLayer').focus();
							}
							else if (data != -1 && status == 'success') {
								$("#autodanawa_popup").addClass("off");
								alert('신고 내용이 접수되었습니다.');
							}
						}
					);
			}
		}
	});

$('#memoLayer #memo').live('click', function () {
		var memoKey = $('#memoLayer #memoKey').val();
		var memoCode = $('#memoLayer #memoCode').val();
		var memoTo = $('#memoLayer #memoTo').val();
		var memoTarget = $('#memoLayer #memoTarget').val();
		var memoTargetGnb = $('#memoLayer #memoTargetGnb').val();
		var memoTargetLnb = $('#memoLayer #memoTargetLnb').val();
		var memoSubject = $('#memoLayer #subject').val().trim();
		var memoContents = $('#memoLayer #contents').val().trim();
		
		
		if (memoSubject.length == 0) {
			alert('제목을 입력해주세요.');
		}
		else if (memoContents.length == 0) {
			alert('내용을 입력해주세요.');
		}
		else {
			$.post('/action/memo.action.php',
					{
						MemoKey:memoKey,
						MemoHashCode:memoCode,
						MemoTo:memoTo,
						MemoTarget:memoTarget,
						MemoTargetGnb:memoTargetGnb,
						MemoTargetLnb:memoTargetLnb,
						MemoSubject:memoSubject,
						MemoContents:memoContents
					},
					function (data, status) {
						if (data == -1 || status != 'success') {
							alert('쪽지 발송 중 오류가 발생하였습니다.');
							$('#memoLayer').focus();
						}
						else if (data != -1 && status == 'success') {
							$("#autodanawa_popup").addClass("off");
							alert('쪽지가 발송되었습니다.');
						}
					}
				);
		}
	});

//게시물 추천
$('.boardViewer .board_exp div.recome a').live('click', function () {
	var no = $(this).attr('code');
	var recomeNo = $(this).find("span").text()*1;

	if(no>0){		
		$.ajax({
			url:webUrl+'/action/community.action.php',
			type:'POST',
			dataType : 'JSON',
			data:{
				'action' : "recommend",
				'no' : no
			},
			error : function(response, error) {
				//console.dir(response);
				alert('오류가 발생하였습니다.2');
			},
			success:function (data) {
	    		if (data['result'] == 'success'){
	    			$(".boardViewer .board_exp div.recome a span").text(recomeNo+1);
	    		}
	    		else{
	    			if (data['alert']){
	    				alert(data['msg']);
	    			}
	    		}
			}
		});//ajax end
	}//if end
});

$('.commentList button.recome').live('click', function () {
		var currentCommentKey = $(this).attr('key');
		var currentCommentCode = $('#comment_'+ currentCommentKey).attr('code');
		
		$('.commentList .input').css('display', 'none');
		$('#comment_form input[name="Action"]').val('recommend');
		
		execCommentProcess(currentCommentKey, currentCommentCode);
	});

$('.newsPopular .tabHead .list button').live('click', function () {
		var targetName = $(this).attr('target');
		
		$('.newsPopular .tabHead .list li').removeClass('on');
		$('.newsPopular .newsList.popular').removeClass('on');
		
		$('.newsPopular .tabHead .list #' + targetName + 'Btn').addClass('on');
		$('.newsPopular #' + targetName).addClass('on');
		
		console.log($(this).attr('target'));
	});

/**
 * 모델 댓글 평점 선택
 * */
//코멘트 포인트 선택
$(document).on("click","#point_select>.point>li button",function(){
	$("#point_select>.selected").html($(this).parent().html());
	$("#point_select .point").addClass("off");
});

//평점 선택 레이어 표시 
$(document).on("mouseenter","#point_select",function(){	// 마우스 over
  	$("#point_select .point").removeClass("off");
});

$(document).on("focus","#point_select",function(){	// 탭 포커스	// 엔터 클릭하면 오픈하는 것으로 변경 예정..
	$("#point_select .point").removeClass("off");
});

$(document).on("mouseleave","#point_select",function(){	// 마우스 out
	$("#point_select .point").addClass("off");
});

$(document).on("focus","#point_select textarea",function(){	// 탭 아웃 엔터 클릭하면 오픈하는 것으로 변경 예정..
	$("#point_select .point").addClass("off");
});

$(document).on('click', '.editRow input[name="headText"]', function () {
	if ($(this).is(':checked')) {
		$('.editRow input[name="headText"]').removeAttr('checked');
		$(this).attr('checked', 'true');
	}
});

$(document).on('click', '#eventSubmit', function () {
	eventSubmit();
});

$(document).on('click', '#eventCancel', function () {
	history.go(-1);
});

$(document).on('click', '.editRow#surveyKind input[type="checkbox"]', function () {
	if ($(this).is(':checked')) {
		$(this).parent().parent().find('input[type="text"]').removeAttr('disabled');
	}
	else {
		$(this).parent().parent().find('input[type="text"]').attr('disabled', 'true');
	}
});

$(document).on('click', '#voteSubmit', function () {
	document.write_form.submit();
});

$(document).on('click', '#voteCancel', function () {
	history.go(-1);
});

/**
 * 커뮤니티 글쓰기
 */
function communitySubmit(obj) {
	if($.cookie('dasysMSeq') && $.cookie("dasysNick")) {
		if($.cookie("dasysMcut")) {
			if($.cookie("dasysMcut").indexOf('B') > -1 || $.cookie("dasysMcut").indexOf('b') > -1){
				alert("본 계정은 자유게시판 글쓰기가 제한되었습니다.\n다나와자동차 고객센터 1644-3834(유료)로 문의 해주세요.");
				return false;
			}
		}
	}
	else if ($.cookie('dasysMSeq') && $.cookie("dasysNick")===null){
		nickChangePopup();
		return false;
	}
	else {
		loginPopup();
		return false;
	}
	
	var validFlag = 1;
	var cheditorContents = CrossEditor.GetBodyValue();
	//var cheditorImagePosition = cheditorContents.indexOf('/cheditor/attach');
	var cheditorImagePosition = cheditorContents.indexOf('/cheditor/crossEdit');
	var cheditorImage = '';

	$('#contents').val(cheditorContents);
	
	cheditorImage = $('#contents').find('img');

	if (cheditorImagePosition > 0) {
		$('#attachRename').val('1');
	}
	else {
		$('#attachRename').val('');
	}

	cheditorImage.each(function (i) {
			imageSource = $(this).attr('src');

			if (imageSource.indexOf('/cheditor/crossEdit') > 0) {
				imageSourceArray = imageSource.split('/cheditor/crossEdit');

				$('#attachThumb').val('crossEdit' + imageSourceArray[1]);

				return false;
			}
		});
	
	// validation check
	if (!$('#subject').val()) {
		alert('제목을 입력해주세요.');
		$('#subject').focus();
		validFlag = -1;
	}
	
	if ($("#write_form #headText option:selected").length && $("#write_form #headText option:selected").val() == '') {
		alert('말머리를 선택해주세요');
		$("#write_form #headText option:selected").focus();
		validFlag = -1;
	}
	
	if ($('#tab').val() == 'blackbox' && $('#write_form .tabHead li:eq(0)').hasClass('on')) {
		if (!$('#sourceCode').val()) {
			alert('소스코드를 입력해주세요.');
			$('#sourceCode').focus();
			validFlag = -1;
		}
		else if (!$('#sourceDescription').val()) {
			alert('내용을 입력해주세요.');
			$('#sourceDescription').focus();
			validFlag = -1;
		}
		
		if($('#sourceDescription').val()){
			$('#contents').val($('#sourceDescription'));
			alert('간략보기 데이터 합쳐야함');
			return false;
		}
	}
	else {
		if (!$('#contents').val()) {
			alert('내용을 입력해주세요.');
			$('#contents').focus();
			validFlag = -1;
		}
	}
	
	if (validFlag == 1) {
		// TODO : ajax 변경
		//document.write_form.submit();
		
		$("#write_form").append("<div id='loading' style='display:none; position:fixed; z-index:999; height:100%; width:100%; top:0; left:0; background-color:#aaa; fileter:alpha(opacity=60); opacity:0.6; -moz-opacity:0.8;'><div style='z-index:1000; margin:300px auto; width:128px; height:128px; filter:alpha(opacity=100); opacity:1; -moz-opacity:1;'><img src='//autoimg.danawa.com/html/pix/common/now_loading.gif' alt='' /></div></div>");
		
		$.ajax({
			url: "/action/community.action.ajax.php",
			type: "POST",
			data: $("#write_form").serialize(),
			dataType: "json",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
			async: true,
			cache: false,
			beforeSend: function () {
				$("#loading").show();
			},
			complete: function () {
				$("#loading").hide();
			},
			success: function (data) {
				$(obj).attr("disabled", "disabled");
				alert(data.message);
				$(location).attr('href', data.url);
			},
			error: function (request, error) {
				console.log('error : ' + error);
				$("#loading").hide();
			}
		});
	}
}

/**
 * 이벤트 전송
 * TODO : 변수 일반 커뮤니티 글쓰기와 맞춘 후 하나의 함수를 사용하도록 변경해야 함
 */
function eventSubmit() {
	var validFlag = 1;
	var cheditorContents = CrossEditor.GetBodyValue();
	var cheditorImagePosition = cheditorContents.indexOf('/cheditor/attach');
	var cheditorImage = '';

	$('#exp').val(cheditorContents);
	
	if (!$('#subj').val()) {
		alert('제목을 입력해주세요.');
		$('#subj').focus();
		validFlag = -1;
	}
	
	if (!$('#exp').val()) {
		alert('내용을 입력해주세요.');
		$('#exp').focus();
		validFlag = -1;
	}
	
	if (validFlag == 1) {
		document.write_form.submit();
	}
}

/**
 * 댓글 크기 제한 체크
 * @param contents
 * @param info
 */
function onCommentCheck(contents, info, length) {
	var commentContents = $('#' + contents).val();
	var commentLength = commentContents.length;
	var commentMaxLength = commentContents.length+(escape(commentContents)+"%u").match(/%u/g).length-1;
	var limitedLength = length;
	var contentsCutPoint = 0;
	var contentsCutLine = 0;
	
	if (contents == 'reportMemo') {
		commentMaxLength = commentContents.length;
	}
	
	if (commentMaxLength > limitedLength) {
		contentsCutPoint = commentMaxLength - limitedLength;
		
		for (i = 0; i < contentsCutPoint; i++) {
			contentsCutLine = Math.ceil(contentsCutPoint / 2);
			commentContents = commentContents.substr(0, commentLength - contentsCutLine);
			commentMaxLength = commentContents.length+(escape(commentContents)+"%u").match(/%u/g).length-1;
			
			if (contents == 'reportMemo') {
				commentMaxLength = commentContents.length;
			}
			
			commentLength = commentContents.length;
			
			if (commentMaxLength <= limitedLength) {
				i = contentsCutPoint;
			}
		}
		
		$("#"+contents).val(commentContents);
		
		alert(limitedLength + '자 이상은 입력하실 수 없습니다.');
	}
	
	$('#'+info).text(commentMaxLength);
}

/**
 * 댓글 글쓰기
 */
function execCommentProcess(target, hashCode, borderKey, code1, type) {
	var validFlag = 1;
	var currentAction = $('#comment_form input[name="Action"]').val();
	var currentCssClass = $('#comment_'+target).attr('class');
	var currentDepth = 0;
	if($.cookie("dasysMcut")) {
		if(($.cookie("dasysMcut").indexOf('B') > -1 || $.cookie("dasysMcut").indexOf('b') > -1) && currentAction !='delete'){
			alert("본 계정은 자유게시판 글쓰기가 제한되었습니다.\n다나와자동차 고객센터 1644-3834(유료)로 문의 해주세요.");
		}
	} 
	else if ($.cookie('dasysMkd') == 'N' && gnb == 'auto' && (lnb == 'brand' || lnb == 'model') && $('#comment_form input[name="Action"]').val() == 'add') {
		alert("일반회원만 댓글 작성이 가능합니다.");
	}
	else {
		if ($("#bidding").length && !$.isNumeric($("#bidding").val())) {
			alert('희망 매입가를 입력해주세요');
			$('#bidding').focus();
			return false;
		}
		
		//$('#comment_form input[name="Action"]').val(action);
		$('#comment_form input[name="CommentCode"]').val(hashCode);
		if(borderKey){
			$('#comment_form input[name="BorderKey"]').val(borderKey);
		}
		if(code1){
			$('#comment_form input[name="ContentsNo"]').val(code1);
		}
		
		// 평점
		if(borderKey == 'model' && $("#point_select .selected>button").length ){
			if($("#point_select .selected>button").attr('code')>0){
				$('#comment_form input[name="Review"]').val($("#point_select .selected>button").attr('code'));			
			}
		}
		
		if ($('#comment_'+target+' textarea').val().trim() != "") {
			$('#comment_form textarea').val($('#comment_'+target+' textarea').val());
		}
		else {
			if (currentAction == 'add' || currentAction == 'modify') {
				alert('내용을 입력해주세요.');
				$('#comment_'+target+' textarea').focus();
				validFlag = -1;
			}
		}
		
		if (currentCssClass.indexOf('depth') == -1) {
			currentDepth = 0;
		}
		else {
			currentDepth = Number(currentCssClass.replace('depth', ''));
		}
		
		$('#comment_form input[name="CommentDepth"]').val(currentDepth);
		
		if (target > 0) {
			$('#comment_form input[name="CommentNo"]').val(target);
		}
		else {
			$('#comment_form input[name="CommentNo"]').val('');
		}
		
		if ($("#comment_"+target+" input[name='secret']").attr('checked') == 'checked') {
			$("#comment_form input[name='IsSecret']").val($("#comment_"+target+" input[name='secret']").val());
		}
		else {
			$("#comment_form input[name='IsSecret']").val('');
		}
		
		// TODO : ajax 처리 및 해당 영역 동적으로 불러오기
		if (validFlag == 1) {
			if (type == 1) {
				document.comment_form.submit();
			}
			else {
				var commentData = '';
				
				$("#comment_form").append("<div id='loading' style='display:none; position:fixed; z-index:999; height:100%; width:100%; top:0; left:0; background-color:#aaa; fileter:alpha(opacity=60); opacity:0.6; -moz-opacity:0.8;'><div style='z-index:1000; margin:300px auto; width:128px; height:128px; filter:alpha(opacity=100); opacity:1; -moz-opacity:1;'><img src='//autoimg.danawa.com/html/pix/common/now_loading.gif' alt='' /></div></div>");
				$("#comment_form").append("<input type='hidden' name='Mode' value='ajax' />");
				
				$.ajax({
					url: "/action/comment.action.php",
					type: "POST",
					data: $("#comment_form").serialize(),
					dataType: "html",
					contentType: "application/x-www-form-urlencoded; charset=UTF-8",
					async: true,
					cache: false,
					beforeSend: function () {
						$("#loading").show();
					},
					complete: function () {
						$("#loading").hide();
					},
					success: function (data) {
						alert(data);
						
						commentData = getCommentData();
						
						if (commentData) {
							$('.auto_comment').html(commentData);
							$("#tx_contents0").val('');
						}
					},
					error: function (request, error) {
						console.log('error : ' + error);
						$("#loading").hide();
					}
				});
				
			}
		}
	}
}

//단일체크
function category_sel_one(headTextKey){
	clCt = $("input[name=headText]").length;
	var categorySel = "";
	for(cl=0;cl<clCt;cl++){
		//if($("#headText"+cl).is(":checked")){
		//		if(categorySel) categorySel += ",";
		//		categorySel+=$("#headText"+cl).val();
		//}
		
		if($("#headText"+cl).val() == headTextKey) {
			// 체크
			categorySel+=$("#headText"+cl).val();
		} else {
			// 체크해제
			$("#headText"+cl).attr('checked', false);
		}
		
	}
	
	var aUrl = location.search.split("&HeadText");
	var aUrl2 = '';
	if(aUrl[1] && aUrl[1].indexOf('&') != -1) {
		aUrl2 = aUrl[1].split("&"); 
		aUrl2 = '&' + aUrl2[0];
	}
	window.location=aUrl[0] + aUrl2 + '&HeadText='+categorySel;
	//window.location="?Work=list&Tab=freeboard&Category="+categorySel;
}

function category_sel(){
	/*
	//var lnkqry="";
	//var aUrl2 = '';
	var categorySel = "";
	
	$("input[name='headText']").each(function(idx, element){
		if($(this).is(":checked")) {
			if(categorySel != '') {
				categorySel += ",";
			}
			categorySel += $(element).val();
		}
	});
	/*
	// 검색어 물고갈경우 수정 필요
	window.location="?Tab="+board+"&Stab="+tab+"&Page=1&Category="+categorySel;
	/*
	var aUrl = location.search.split("&HeadText");
	if(aUrl[1] && aUrl[1].indexOf('&') != -1) {
		aUrl2 = aUrl[1].split("&"); 
		aUrl2 = '&' + aUrl2[0];
	}
	window.location=aUrl[0] + aUrl2 + '&HeadText='+categorySel+lnkqry;
	*/
	clCt = $("input[name=headText]").length;
	var categorySel = "";
	for(cl=0;cl<clCt;cl++){
		if($("#headText"+cl).is(":checked")){
				if(categorySel) categorySel += ",";
				categorySel+=$("#headText"+cl).val();
		}
	}
	
	var aUrl = location.search.split("&HeadText");
	var aUrl2 = '';
	if(aUrl[1] && aUrl[1].indexOf('&') != -1) {
		aUrl2 = aUrl[1].split("&"); 
		aUrl2 = '&' + aUrl2[0];
	}
	window.location=aUrl[0] + aUrl2 + '&HeadText='+categorySel;
	//window.location="?Work=list&Tab=freeboard&Category="+categorySel;
}

/** 
 * write 에디터 전환
 * */
$('#write_form .tabHead li').live('click', function () {
	var confirmResult = confirm('편집된 내용이 모두 사라지게 됩니다. 모드를 전환하시겠습니까?');
	
	if (confirmResult) {
		$("#write_form .tabHead li").each(function(idx, element){
			$(this).removeClass('on');
			$("#"+$(this).attr('val')).hide();
		});
		
		$(this).addClass('on');
		$("#"+$(this).attr('val')).show();

//		$('.boardUpload .edit *').removeClass('on');
//		$(this).addClass('on');
//		$('.boardUpload .edit #' + $(this).attr('val') + 'Mode').addClass('on');
//		$('input[name=editor]').val($(this).attr('val'));
	}
});


/**
 * 게시물 이동
 */
function moveBoard(url){
	if($("#boardList option:selected").val()>0){
		window.location = url+"&changeId="+$("#boardList option:selected").val()
		//console.log(url+"&changeId="+$("#boardList option:selected").val());
	}
}

function edit_preview(win){
	if(win=="new"){
		newwin = window.open("/talk/votingPreview.php","newwin1","toolbar=no, location=no, status=no, directories=no, scrollbars=yes, menubar=no, resizable=yes, height=600, width=710, left=0, top=0");
	}else{
		window.newwin.focus();
		newwin.edit_copy($("#exp").val()); 
	}
}

/* 블랙박스 기존소스 수정필요 */	
function tabRotateControl(thms,num){
	var thisTab = 1;
	var CtB = 1;
	
	if(thms.indexOf("_sub")>=0){
		var subClass="_sub";
	}else{
		var subClass="";			
	}
	
	$("#"+thms+" .TabContents"+subClass+" > li").each(function(){
		if($(this).hasClass("on")) thisTab = CtB;
		CtB ++;
	});
	if(num=='Before') nextTab = thisTab - 1;
	else if(num=='Next') nextTab = thisTab + 1;
	else if(num) nextTab = num;
	else nextTab = thisTab + 1;
	if(nextTab<1) nextTab = CtB -1;
	else if(nextTab>=CtB) nextTab = 1;
	
	CtB = 1;
	$("#"+thms+" .TabContents"+subClass+" > li").each(function(){
		if(nextTab == CtB) $(this).addClass("on");
		else $(this).removeClass("on");
		CtB ++;
	});
	CtB = 1;
	$("#"+thms+" .TabButton > li").each(function(){
		img = $(this).children('button').children('img').attr("src");
		if(nextTab == CtB){
			$(this).addClass("on");
			//$(this).children('button').css("background-position-y","-43px");
			//if(typeof img != 'undefined'){
				//if(img.indexOf("-over.")<0) $(this).children('button').children('img').attr("src",img.replace(".","-over."));
				//$(this).children('button').css("background-position","0 -43px");
			//	$(this).children('button').css("border","1px solid #ffccff");
			//}
		}else{
			$(this).removeClass("on");
			//if(typeof img != 'undefined'){
			//	if(img.indexOf("-over.")>=0) $(this).children('button').children('img').attr("src",img.replace("-over.","."));
			//}
		}
		CtB ++;
	});
	CtB = 1;
	$("#"+thms+" .TabMore > li").each(function(){
		if(nextTab == CtB) $(this).addClass("on");
		else $(this).removeClass("on");
		CtB ++;
	});
}
$(document).on("click",".TabArrowBefore",function(){	// 이전 화살표
	var thms = $(this).parent().attr("id");
	var arrw = $(this).attr("class").substring(8);
	tabRotateControl(thms,'Before')
});
$(document).on("click",".TabArrowNext",function(){	// 다음 화살표
	var thms = $(this).parent().attr("id");
	var arrw = $(this).attr("class").substring(8);
	tabRotateControl(thms,'Next')
});
$(document).on("click",".TabButton > li",function(){	// 버튼 클릭
	if($(this).hasClass("on")){
		if($(this).children("a").attr("href")=="#"){
			msieversion();
		}
		
	}else{
		var thms = $(this).parent().parent().attr("id");
		$(".TabButton > li").attr("tabClick","");
		$(this).attr("tabClick","sel");
		var thisTab = 1;
		var CtB = 1;
		$("#"+thms+" .TabButton > li").each(function(){
			if($(this).attr("tabClick")=="sel") thisTab = CtB;
			CtB ++;
		});
		
		msieversion();
		tabRotateControl(thms,thisTab);
	}

function msieversion() {
	if (window.navigator.userAgent.indexOf("MSIE") > 0) { // If Internet Explorer, return version number
		return event.returnValue = false;
	}else if(window.navigator.userAgent.indexOf("Firefox") > 0){
		return false;
	} else { // If another browser, return 0
		return event.preventDefault();
	}
}
/* 블랙박스 기존소스 */	
	
});

//비밀댓글 선택
$(document).on("click","input[name='secret']",function(){
	var kd = $.cookie('dasysMkd')  != null ? $.cookie('dasysMkd') : '';
	var use = $.cookie('dasysMuse') != null ? $.cookie('dasysMuse') : '';
	var accessSite = $.cookie('AccessSite') != null ? $.cookie('AccessSite') : '';
	var result = false;
	var url = '';
	if(gnb=='buy' && kd != 'N' && use.indexOf("D") == -1){
		$(this).attr('checked', false);
		if(accessSite == 'danawa'){
			result = confirm("비밀댓글은 다나와 신차 영업회원만 작성 할 수 있습니다.\n신차 영업회원으로 신청하시겠니까?");
			url = '/mypage/?Work=memAgree';
			// 신차영업 신청
		}else{
			result = confirm("비밀댓글은 다나와 신차 영업회원만 작성 할 수 있습니다.\n다나와 회원으로 가입하시겠습니까?");
			url = 'https://auth.danawa.com/joinStep1?url=' + webUrl +'/social/connect.php?site=danawa';
			// 다나와 가입, 신차영업 신청
		}
		if(result){
			newwin = window.open(url,"newwin1","toolbar=no, location=no, status=no, directories=no, scrollbars=yes, menubar=no, resizable=yes, left=0, top=0");
		}
	}else{
		
	}
});

//2년전 글 목록보기 도움말 보기/닫기
$(document).on("click",".pageListNew .buttonHelp, .pageListNew .help_layer .close",function(){
	if($(".pageListNew .help_layer").css('display') == 'none'){
		$(".pageListNew .help_layer").show();
	}else{
		$(".pageListNew .help_layer").hide();
	}
});

function getCommentData() {
	var commentData = '';
	
	$.ajaxSetup({async:false, cache: false});
	
	$.get(
			'/service/ajax_comment.php',
			{
				Work:$('#comment_form input[name="Work"]').val(),
				Tab:$('#comment_form input[name="Tab"]').val(),
				Brand:$('#comment_form input[name="Brand"]').val(),
				Model:$('#comment_form input[name="Model"]').val(),
				no:$('#comment_form input[name="ContentsNo"]').val(),
				Order:$('#comment_form input[name="Order"]').val(),
				Cp:$('#comment_form input[name="Cp"]').val(),
				useOldData:$('#comment_form input[name="useOldData"]').val(),
				gnb:$('#comment_form input[name="Gnb"]').val()
			},
			function (data, status) {
				if (status == 'success') {
					commentData = data;
				}
				else {
					//alert('get comment list failed');
				}
			});
	
	return commentData;
}

// 댓글 리스트 정렬 변경
function changeCommentOrder(order) {
	var commentData = '';
	
	$('#comment_form input[name="Order"]').val(order);
	commentData = getCommentData();
	
	if (commentData) {
		$('.auto_comment').html(commentData);
		$('.auto_comment .indexHead.comment').attr("tabindex", -1).focus();
	}
}

//댓글 리스트 페이지 변경
function changeCommentPage(page) {
	var commentData = '';
	
	$('#comment_form input[name="Cp"]').val(page);
	commentData = getCommentData();
	
	if (commentData) {
		$('.auto_comment').html(commentData);
		$('.auto_comment .indexHead.comment').attr("tabindex", -1).focus();
	}
}

//라인업
function qnaLineupNavi(brand, model, modelName) {
	var html ="";

	$.ajax({
		url:apiUrl + '/v1/S/car/?type=lineup&data=3&brand=I:E:'+brand+'&model=I:E:'+model+'&order=1&limit=0',
		type:'GET',
		dataType : 'JSON',
		sync : "false", 
		success:function (result) {
			html += '<ul>';
			html += '	<li><a href="#" onclick="javascript:return false;" brand="'+brand+'" model="'+model+'" lineup="" class="qnaLineup"><span class="txt" modelName="'+modelName+'">라인업 선택 없이 모델 등록</span><span class="icon">선택</span></a></li>';
			$.each(result.data, function(index, entry) {
				if (entry.status != 0) {
					html += '<li><a href="#" onclick="javascript:return false;" brand="'+brand+'" model="'+model+'" lineup="'+entry.no+'" class="qnaLineup"><span class="txt" modelName="'+modelName+'">'+entry.myNew+' '+entry.name+'</span><span class="icon">선택</span></a></li>';
				}
			});

			html += '</ul>';

			$("#popup_data").empty().html($(".qnaTrimBox").clone(true, true).show().html(html));
		} , complete : function() {
			openPopup('라인업 선택', 600, '');
		}
	});
}

// 신차견적 댓글 UI개선 연관 함수
if (1) {
	function writeComment(e){
		
		if (!$(e).hasClass('on')) {
			return;
		}
		
		$(e).removeClass('on');
		
		if($.cookie('dasysMSeq')) {
			if($.cookie("dasysMcut")) {
				if(($.cookie("dasysMcut").indexOf('B') > -1 || $.cookie("dasysMcut").indexOf('b') > -1)){
					alert("본 계정은 자유게시판 글쓰기가 제한되었습니다.\n다나와자동차 고객센터 1644-3834(유료)로 문의 해주세요.");
					return;
				}
			} 
			
			var url = webUrl+"/action/comment.action.php";
			
			$.ajax({
				url: url,
				type: 'POST',
				dataType : 'json',
				data: $("#newcarComment_form").serialize(),
				contentType: "application/x-www-form-urlencoded; charset=UTF-8",
				beforeSend: function () {
				},
				success: function(result){
					console.dir(result)
					
					if (!result.result) {
						alert(result.msg)
					}
				},
				complete: function () {
					//$("#layerPopup .btn-close").click();
					location.reload();
				},
				error: function (request, error) {
					console.log('error : ' + error);
				}
			});		
		} else {
			if (confirm("로그인이 필요한 페이지 입니다.")) {
				loginPopup();
			}
		}
	}
	
	function writeReComment(commentNo) {
		
		var url = webUrl+"/action/comment.action.php";
		
		$.ajax({
			url: url,
			type: 'POST',
			dataType : 'json',
			data: {
				'action': 'commentReply',
				'commentNo': commentNo,
				'exp': $("#replyForm_"+commentNo).val()
			},
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
			beforeSend: function () {
			},
			success: function(result){
				console.dir(result)
				
				if (!result.result) {
					alert(result.msg)
				}
			},
			complete: function () {
				location.reload();
			},
			error: function (request, error) {
				console.log('error : ' + error);
			}
		});	
	} 
	
	function modifyComment(no){
		
		if($.cookie('dasysMSeq')) {
			if($.cookie("dasysMcut")) {
				if(($.cookie("dasysMcut").indexOf('B') > -1 || $.cookie("dasysMcut").indexOf('b') > -1)){
					alert("본 계정은 자유게시판 글쓰기가 제한되었습니다.\n다나와자동차 고객센터 1644-3834(유료)로 문의 해주세요.");
					return;
				}
			} 
			
			var url = webUrl+"/action/comment.action.php";
			
			$.ajax({
				url: url,
				type: 'POST',
				dataType : 'json',
				data: {
					'service': 'newcar',
					'action': 'modify',
					'exp': $("#replyModifyForm_"+no).val(),
					'commentNo': no
				},
				contentType: "application/x-www-form-urlencoded; charset=UTF-8",
				beforeSend: function () {
				},
				success: function(result){
					console.dir(result)
					
					if (!result.result) {
						alert(result.msg)
					}
				},
				complete: function () {
					location.reload();
				},
				error: function (request, error) {
					console.log('error : ' + error);
				}
			});		
		} else {
			if (confirm("로그인이 필요한 페이지 입니다.")) {
				loginPopup();
			}
		}
	}
	
	function deleteComment(userNo, no, boardNo) {
		
		if (userNo && no) {
			var url = webUrl+"/action/comment.action.php";
			
			$.ajax({
				url: url,
				type: 'POST',
				dataType : 'json',
				data: {
					'Action': 'delete',
					'Mode': 'ajaxDelete',
					'BorderKey': 4,
					'CommentCode': userNo,
					'ContentsNo': boardNo,
					'CommentNo': no
				},
				contentType: "application/x-www-form-urlencoded; charset=UTF-8",
				beforeSend: function () {
				},
				success: function(result){
					if (result.code == 1) {
						$("#comment_"+no).remove();
						$("#comment_list .result .num").text($("#comment_list .result .num").text()-1)
					}
				},
				complete: function () {
					location.reload();
				},
				error: function (request, error) {
				}
			});
		}
	}
	
	function openCommentForm(service, no) {
		if (service == 'newcar') {
			getHttprequest(webUrl + '/service/ajax_comment_form.php?service='+service+'&type=write&no='+no, 'layerPopup .g-layer__cont');
			openLayerPopup('dim', '댓글달기');
			return;
		}
	}
	
	function openModifyCommentForm(userNo, no, depth) {
		
		if (userNo && no) {
			if (depth == 0) {
				getHttprequest(webUrl + '/service/ajax_comment_form.php?service=newcar&type=modify&commentNo='+no, 'layerPopup .g-layer__cont');
				openLayerPopup('dim', '댓글수정');
				return;
			} else {
				if ($("#commentReplyModify_"+no).length) {
					$("#replyModifyForm_"+no).trigger('keyup');
					$("#commentReplyModify_"+no).addClass('show').removeClass('hide')
				}
			}
		}
	}

	function toggleCommentIntro(e) {
		if ($(e).prev().hasClass('spread')) {
			$(e).removeClass('fold').text('더보기')
			$(e).prev().removeClass('spread')
		} else {
			$(e).addClass('fold').text('접기')
			$(e).prev().addClass('spread')
		}
	}
	
	function toggleCommentOptBox(e) {
		if ($(e).hasClass('show')) {
			$(e).removeClass('show')
		} else {
			$(e).addClass('show')
		}
	}
	
	function showCommentReplyForm(no){
		var id = "#commentReply_"+no;
		
		if ($(id).length) {
			if ($(id).hasClass('show')) {
				$(id).removeClass('show')
			} else {
				$(id).addClass('show')
			}
		}
	}
	
	function checkTextLength(inputID, resultID, maxLength) {
		
		if (!$("#"+inputID).length || !maxLength) {
			return;
		}
		
		var inputValue = $("#"+inputID).val();
		var textLength = getTextLength(inputValue);
		var nowLength = 0;
		var cutPos = 0;
		
		if (textLength > maxLength) {
			
			for (cutPos = 0; cutPos < textLength; cutPos++) {
				nowLength += (inputValue.charCodeAt(cutPos) > 128) ? 2 : 1;
				
				if (nowLength > maxLength) {
					nowLength -= (inputValue.charCodeAt(cutPos) > 128) ? 2 : 1;
					break;
				}
			}
			
			textLength = nowLength
			$("#"+inputID).val($("#"+inputID).val().substring(0, cutPos))
			
			alert(maxLength + '자 이상은 입력하실 수 없습니다.');
		}
		
		if ($("#"+resultID).length) {
			$("#"+resultID).text(textLength);
		}
	}
}

function getTextLength(str) {
    var len = 0;
    for (var i = 0; i < str.length; i++) {
        if (escape(str.charAt(i)).length == 6) {
            len++;
        }

        len++;
    }

    return len;
}