/* 저장할 변수 정의   배열로 ebox 받음.. aaa=bbb; */
rsltCode=new Array();	// estmContPut : 코드 묶어서 표시
rsltName=new Array();	// calculate : 명칭 _로 구분
rsltConf=new Array();	// calculate : 설정 @로 구분  0옵션  1조건  2면세  3등록  4다자녀/기타  5 탁송
rsltFcfg=new Array();	// 금융 설정 @로 구분 // 할부 리스 분리 ..
rsltSumy=new Array();	// 비용 종합
rsltOthr=new Array();	// 위 정보 종합.
saveEstm=new Array(); // 저장 견적 불러오기 정보 임시 보관
rsltFinc=new Array();	// 금융비교 결과..

ebox = "";	// 현재 계산하는 프레임 표시, 여러 프레임 계산시 반복 실행 
fbox = ""; // 할부 박스.. 사용하지 않고 class 에서 ftab 으로 넣어서 해결.. 
ftab = "";	// 일반인용 견적의 탭 선택 정보.. etab 에서 변경..
echg = "";	// chng 광역에서 사용하기 위해 추가..
popSet = "";	// 팝업에서 옵션 등 연결..
itmNo = 10;
temNo = 10;
finNo = 10;	// 불러온 할부와 번호 조회해야.. 
fodr = "C"; // C 이자합계, M 월 납입금 
alt = ""; // alert 메모.. 
payMethod = '';

MYBONDS = -1;	// -1 자동 사용,
MYBONDL = -1;	// -1 자동 사용,

// 2018-07-23 "X" 값 삭제
// 2016-01-20 기능 중지 , 개소세 혜택 전후 표시기능 삭제 2016-07-22
// 2016-01-01 에는 X 기본으로 변경 표시
// 개소세 혜택 적용/종료 선택 기능 추가 2015-11-24
var ctaxCalType = "";
var oldCarSel = false;  //노후차

sidoList={
	D33:"강원",
	D31:"경기",
	D55:"경남",
	D5522:"창원",	// 2023.05.08 신차견적 공채를 위한 하드코딩 추가적용
	D54:"경북",
	S62:"광주",
	S53:"대구",
	S42:"대전",
	S51:"부산",
	S20:"서울",
	S44:"세종",
	S52:"울산",
	S32:"인천",
	D61:"전남",
	S64:"제주",
	D63:"전북",
	D41:"충남",
	D43:"충북"};

// 신차견적 구매요약 광고상품 랜덤 노출 키
var adFinenceSelectPosition = 0;
// 신차견적 구매요약 광고상품 변경 유무
var hasFincCNoAdChange = false;
// 선택한 구매요약 광고상품 번호
var selectedAdFincCNo = 0;
//2018.08.27 mjmjmjmj91@danawa.com 통합브랜드 예외처리, 브랜드 치환 전 브랜드코드
var salesBrand = "";

// 2010.03 개별소비세 인하
var hasSpecialConsumptionTaxDiscounted = 0;

function calculate (chng, part)
{
	ebox = estmAct;
	
	// 2018.03.02 verere@danawa.com 신차견적 구매요약 내 할부원금 변경시 광고상품 유지 기능 추가
	if (chng == 'fincC_ad') {
		hasFincCNoAdChange = true;
		chng = 'fincC';
	}
	
	echg = chng;
	
	valCode = new Array(); // 코드 분할
	setFree = new Array(); // 면세 조건
	
	//견적 계산 결과 저장 위한 임시 변수 정의 
	codes = new Array(); // 코드 설정 정리 code(코드) free(면세) zone(지역) othr(다자녀) incnt(보조금) 
	texts = new Array();	// 옵션, 명칭, 조건 등 텍스트 값
	price = new Array();// 차량 가격 계산
	entry = new Array();// 등록비용 계산
	infos = new Array();// 부가정보 처리
	sumry = new Array();// 종합정리	
	
	//기본 변수 확인 Code 생성 
	codes.code = rsltCode[ebox];
	
	valCode.brnd = codes.code.substring(0,3);
	valCode.modl = codes.code.substring(3,7);
	valCode.line = codes.code.substring(7,12);
	valCode.trms = codes.code.substring(12);
	
	salesBrand = valCode.brnd;
	
	if (valCode.brnd == "316") {
		valCode.brnd = "312";
	}
	else if (valCode.brnd == "322") {
		valCode.brnd = "321";
	}
		
	// 모델 정보 불러오기
	var str = dnw_deChar2(estmDataAuto['M'+valCode.modl]);
	
	dnw_array2(str, "setModl");
	
	// 라인업 정보 불러오기
	var str = dnw_deChar2(estmDataAuto["L"+valCode.line]);
	
	dnw_array2(str, "setLine");
	
	// 트림 정보 불러오기 
	var str = dnw_deChar2(estmDataAuto["T" + valCode.trms]);
	
	dnw_array2(str, "setTrms");
	
	tmpName = setTrms.name.split("`");
	
	if (tmpName[4]) tmpName[3] += " (" + tmpName[4] + ")";
	
	rsltName[ebox] = tmpName[0] + "_" + tmpName[1] + "_" + tmpName[2] + "_" + tmpName[3] + "_" + tmpName[5] + " (" + tmpName[6] + ")";
	
	texts.name = tmpName[1]+" "+tmpName[2]+" "+tmpName[3]+" "+tmpName[5]+" ("+tmpName[6]+")";
	texts.brand = tmpName[0];
	texts.model = tmpName[1];
	texts.lineup = tmpName[2]+" "+tmpName[3]+" "+tmpName[5]+" ("+tmpName[6]+")";
	texts.lineup2 = tmpName[3];
	texts.trim = tmpName[5]+" ("+tmpName[6]+")";
	texts.modelYear = tmpName[2];
	
	infos.othr = setTrms.othr;
	infos.spec = setTrms.spec;
	infos.photo = setLine.poto;	// 이미지 경로 변경 : 2016-02-05
	infos.classify = setModl.classify; // 해당 모델 차종 : 2019-03-22
	
	//판매조건 정보 불러오기 
	var useTerm = false;	// 판매조건 이용여부 확인
	
	if (typeof(estmDataTerm["B"+valCode.brnd])!="undefined" && estmDataTerm["B"+valCode.brnd]!="none" && typeof(estmDataTerm["M"+valCode.modl])!="undefined" && estmDataTerm["M"+valCode.modl]!="none"){
		str = dnw_deChar2(estmDataTerm["B"+valCode.brnd]);
		dnw_array2(str,"setTermB");
		
		var str = dnw_deChar2(estmDataTerm["M"+valCode.modl]);
		dnw_array2(str,"setTermM");
		
		useTerm = true;
	}
	
	price.ctaxOld = setTrms.ctax;
	price.spDC = 0;
	
	// 선택사양 목록 만들기 
	if (chng == "redy" || chng == "copy" || chng == "line" || chng == "trms" || chng == "ctax") {
		items_list();	// 선택사양 목록 표시
	}
	
	// 개소세 혜택 적용/종료 선택 기능 추가 2015-11-24  옵션 선택 복원..
	if (chng == "ctax") {
		codes_reset();
	}
	
	// 판매조건 목록 만들기
	//2019.02.11 mjmjmjmj91@danawa.com 수입차, 트림 변경 시 판매조건 리스트가 변경되어 추가
	if (chng == "redy" || chng == "copy" || ((chng == "trms" || chng == "line") && valCode.brnd >= 340)) {	// 선택사양 목록 표시
		terms_list(useTerm);	// 판매조건 목록표시
	}
	
	// 판매조건 기본지정 
	if (chng == "redy" || chng == "copy" || chng == "line" || chng == "trms") {
		// 제외조건 히든 처리
		terms_disabled();
		
		// 판매조건 자동지정
		//2019.02.11 mjmjmjmj91@danawa.com 수입차는 판매조건 리스트 작성에서 자동지정 처리
		if (chng != "copy" && valCode.brnd < 340) {
			terms_auto();
		}
		
		// 렌트리스 가격 갱신
		if (estmDataLeaserent["T"+valCode.trms] || estmDataLeaserent["M"+valCode.modl]) {
			var leaserentSet = estmDataLeaserent["M"+valCode.modl].split("`");

//			if (estmDataLeaserent["T"+valCode.trms]){
//				leaserentSet = estmDataLeaserent["T"+valCode.trms].split("`");
//			}
			
			$("#info_finance li:eq(2)").removeClass('tab-box__item--disabled');
			$("#info_finance li:eq(2) .txt").text("월 "+number_format(leaserentSet[4])+"원~")
		}
		else {
		    $("#info_finance li:eq(2)").addClass('tab-box__item--disabled');
		    $("#info_finance li:eq(2) .txt").text("(상품없음)")
		}

	}
	
	// 판매조건 중복 제거 
	if (chng == "term") {
		if (part.substr(0, 1) != "U" && $("#Term_" + ebox + " .eChkTermList input[code='" + part + "']").is(":checked")) {	// U 수동입력
			terms_check(part);	// 중복체크
		}
	}
	
	// 면세 선택 
//	if (setTrms.ctax < 0 && (chng == "redy" || chng == "line")) {
//		if ($("#Free_"+ebox+" .eSelFreeKind").val() == "PG") {
//			if (tmpName[3].indexOf("장애") >= 0) codes.free = "H1";
//			else if (tmpName[3].indexOf("렌트") >= 0 || tmpName[3].indexOf("렌터") >= 0 || tmpName[3].indexOf("랜트") >= 0 || tmpName[3].indexOf("랜터") >= 0) codes.free = "CG";
//			else if (tmpName[3].indexOf("택시") >= 0) codes.free = "CT";
//			else codes.free = "H1";
//			
//			$("#Free_"+ebox+" .eSelFreeKind").val(codes.free);
//		}
//	}
	
	if ((chng == "redy" || chng == "line" || chng == "trns")) {
		if (tmpName[5].indexOf("장애") >= 0) codes.free = "H1";
		else if (tmpName[5].indexOf("렌트") >= 0 || tmpName[5].indexOf("렌터") >= 0 || tmpName[5].indexOf("랜트") >= 0 || tmpName[5].indexOf("랜터") >= 0) codes.free = "CG";
		else if (tmpName[5].indexOf("택시") >= 0) codes.free = "CT";
		else {
			if(setTrms.ctax < 0) {
				codes.free = "H1";
			} else {
				if(typeof(codes.free) == "undefined") {
					codes.free = $("#Free_" + ebox + " .eSelFreeKind").val();
				}
			}
		}
		
		$("#Free_"+ebox+" .eSelFreeKind").val(codes.free);
	}
	
	// 탁송료 
	if (setLine.trns && chng == "redy") {
		$("#eDiv_" + ebox + " .btnTrnsView").attr("code", setLine.trns);
	}
	
	// 탁송료 
	if (chng == "redy" || chng == "copy" || chng == "line") {
		if (setLine.trns) {
			$(".btnTrnsView").attr('Code', setLine.trns);
			getHttprequest(webUrl + "/service/transForm.php?Code=" + setLine.trns + "&kind=form&carCode="+codes.code+"&Conf="+rsltConf[ebox], "eViewTrnsCost");
		}		
		else {
			$("#eViewTrnsCost").html("<div class='estimate__cont'><div class='article-box'><div class='estimate__blank'>구매 계약시 별도 협의</div></div></div>");
		}
		
		// 상용차 취득세, 공채  비노출(상용차도 취득세 노출해달라는 요청으로 주석처리)
//		if (infos.classify.substring(0, 1) == "O") {
//			$("#Enty_1").addClass('off');
//		}
	}
	
	// 등록조건 초기 선택 지정 
	if (chng == "redy" || chng == "copy") {
		$("#Enty_" + ebox + " .eChkRegiBond").attr("name", "eChkBond"+ebox);
		
		if(chng == "redy"){
			$("#Enty_"+ebox+" .eChkRegiBond[value='S']").prop("checked",true);
			$("#Loca_"+ebox+" .eSelRegiSido").val("S20");
		}
		if(valCode.brnd==312 || valCode.brnd==316 || valCode.brnd==326) $("#eDiv_"+ebox+" .eSelCostTrns").val("X");	// 쉐보레 쌍용 탁송료 별도표시..
	}
	
	// 불러온 설정 지정하기 
	if (chng == "redy" && rsltConf[ebox]) {
		codes_reset();
	}
	
	// 2019.02.14 mjmjmjmj91@danawa.com 수입차는 selectbox 미사용으로 일반인 분리 처리
	codes.free = $("#Free_" + ebox + " .eSelFreeKind").val();
	infos.free = (codes.free == 'PG') ? '일반인 (해당없음)' : $("#Free_" + ebox + " .eSelFreeKind option:selected").text();
	
	tfree_value(codes.free);
	
	// 등록지역 선택 
	codes.zone = $("#Loca_" + ebox + " .eSelRegiSido").val();
	
	infos.zone = $("#Loca_" + ebox + " .eSelRegiSido option:selected").text();
	codes.othr = "";	// 다자녀(C), 법인등록 ... 등
	
	if ($("#Loca_" + ebox + " .eChkRegiChild").is(":checked")) codes.othr = "C"; 
		
	/* 차량가격 계산 */
	calculate_price(chng);
	
	/*등록지역 채권 할인표시*/
	var cidoCode = codes.zone;
	
	if (chng == "redy" || chng == "copy" || chng == "free" || chng == "trns") {
		$.each($(".eSelRegiSido option"), function() {
			 codes.zone = $(this).val();
			 sido_calculate_entry();
			 
			 if(entry.bondBR > 100) {
				 $(this).html(sidoList[codes.zone] + " (" + number_format(entry.bondBR) + ")") ;
			 }
			 else {
				 $(this).html(sidoList[codes.zone] + " (" + entry.bondBR + "%)");
			 }
		});
	}
	
	codes.zone = cidoCode;
	    
	// 등록비용 계산 
	calculate_entry();
	
	//노후차
	var txt = "";
	
	//외제차  장애인, 하이브리드 전기차 제외 // 수입차 제외
	if (valCode.brnd < 340 && setFree['pric'] != 0 && setTrms['ctax'] != '100.0' && price.taxK != 'h') {}
	
	$("#Term_"+ebox+" .eOldCar").html(txt);
	
	// 유지비용 설정, 계산 
	if (gnb == "compare") codes.year = $("#Mile_" + ebox + " .eSelMantYear").val();
	else codes.year = 3;
	
	if (gnb == "compare") codes.mile = $("#Mile_" + ebox + " .eSelMantMile").val();
	else codes.mile = 15000;
	
	setSpecKeyValue();
	calculate_infos();
	
	sumry.sign = 0;	// 계약금
	
	/* 할부인지 일시불인지 */
	payMethod = $("#info_finance li.tab-box__item--on").data('type');

	// 금융 계산 시작 (순서는 변경될 수 있음) finc fincM fincC 
	if (gnb == "buy" || gnb == "newcar" || gnb == "estimate") ftab = $("#eDiv_"+ebox+" .estmRsltBox > div.selected").attr("ftab");
	else if(gnb == "compare")  ftab = $("#Finc_"+ebox+" .fincTab > li.on").attr("ftab");
	
	if (!ftab) ftab = "CashS";
	
	// 일시불 계산 
	if (!$("#compSelCashCaps").val() || (payMethod =='cash' && chng != 'cashP') && $("#compSelCashCaps").attr('kind') != 'handWork') {
		$("#compSelCashCaps").val(Math.floor(price.total / 10000));		
		$("#compSelCashCaps").closest('.estimate-pay__prepay').find('.emphasis').html('* ~' + number_format( number_round(price.total, 10000, 'floor') / 10000 ));
	}
	
	if (chng == 'cashP') {
		calculate_cashback(part,'cash');
	}
	else if (chng != 'cashC' && (chng == 'redy' || chng == 'cash' || payMethod =='cash')) {
		var cash = parseInt($("#compSelCashCaps").val() * 10000);
		
		if (valCode.brnd != "303" && valCode.brnd != "304" && valCode.brnd != "307" && valCode.brnd != "321" ){
			cash -= price.trns;
		}
		
		calculate_cashback(cash,'cash');
	} 

	//일시불 금융상품 선택
	lump = new Array();// 할부 계산 시작
	
//	if (payMethod == 'cash') {
//		/*
//		 *lump.card 카드결제
//		 *lump.cash 현금결재 
//		 *lump.cashback	//캐시백
//		 *lump.cashbackTtr //캐시백율
//		 */
//		if ($("#compSelCashCaps").attr('kind') == 'handWork') {
//			if ($("#compSelCashCaps").val() * 10000 > price.total) {
//				$("#compSelCashCaps").attr('kind', '');
//				lump.card = price.total;			
//				$("#compSelCashCaps").val(Math.floor(price.total / 10000));
//				$("#compSelCashCaps").closest('.estimate-pay__prepay').find('.emphasis').html('* ~' + number_format( number_round(price.total, 10000, 'floor') / 10000 ));
//			}
//			else {
//				lump.card = $("#compSelCashCaps").val() * 10000;				
//			}
//		}
//		else {
//			lump.card = price.total;			
//			$("#compSelCashCaps").val(Math.floor(price.total / 10000));
//			$("#compSelCashCaps").closest('.estimate-pay__prepay').find('.emphasis').html('* ~' + number_format( number_round(price.total, 10000, 'floor') / 10000 ));
//		}
//		
//		var temp = $(".eRsltListCashback input:checked").val().split(':');
//		
//		lump.cash = price.total - $("#compSelCashCaps").val() * 10000;
//		lump.cashback = temp[0];
//		lump.cashbackTtr = temp[1];
//		lump.name = $(".eRsltListCashback input:checked").siblings('span').text();
//	}
	
	var fIParam = "";	
	var colorParam = "";
	
	if(!_.isUndefined(rsltConf[ebox])) {
		var rsltConfArray = rsltConf[ebox].split("@");
		if(rsltConfArray.length >= 10) {
			fIParam = rsltConfArray[9];
			if(!_.isUndefined(rsltConfArray[10])) {
				colorParam = rsltConfArray[10];
			}
		}
	}
	
	rsltConf[ebox] = codes.itms+"@"+codes.term+"@"+codes.free+"@"+codes.zone+"@"+codes.othr+"@"+codes.trns+"@"+codes.year+"@"+codes.mile+"@"+ftab+"@" + fIParam + "@" + colorParam + "@";
	
	// 할부 계산 
	if (chng == "redy" || chng == "copy" || chng=="line") {
		// 할부/금융 목록 만들기
		var selFinc = "";
		var selLeas = "";
		var tmp = "";
		
		// 공통 할부
		if (typeof(estmDataFinc["B100"]) != "undefined" && estmDataTerm["B100"] != "none") {
			var str = dnw_deChar2(estmDataFinc["B100"]);
			
			dnw_array2(str, "setFincB");

			tmp = '';
			
			if (setFincB.fincList.indexOf("!") != -1) {
				tmp = setFincB.fincList.split("!");
			}
			
			for (var key in tmp) {
				var tmp2 = tmp[key].split("@");
				var goNext = 1;// 브랜드 적합 확인
				
				if (tmp2[4] == "3") {
					goNext = 0;
				}
				// 전체
				else if (tmp2[3] == "A"){}
				// 국산
				else if (tmp2[3] == "K" && valCode.brnd < 340){}
				// 수입
				else if (tmp2[3] == "I" && valCode.brnd > 340){}
				// 적용 브랜드 인지
				else if (tmp2[3].substring(0, 1) == "W" && tmp2[3].indexOf(valCode.brnd) > 0) {}
				else if (tmp2[3].substring(0, 1) == "X") {
					if (tmp2[3].indexOf(valCode.brnd) > 0) goNext = 0;
					else if (valCode.brnd > 340 && tmp2[3].indexOf("I") > 0) goNext = 0;
					else if (valCode.brnd < 340 && tmp2[3].indexOf("K") > 0) goNext = 0;
				}
				else {
					goNext = 0;
				}
				
				if (goNext) {
					if (tmp2[2].substring(0, 1) == "L") {
						selLeas += "<option value=\"" + tmp2[0] + "\">"+tmp2[1] + "</option>";
					}
					else if(tmp2[2].substring(0, 1) == "R") {
						selRent += "<option value=\"" + tmp2[0] + "\">" + tmp2[1] + "</option>";
					}
					else {
						selFinc += "<option value=\"" + tmp2[0] + "\">" + tmp2[1] + "</option>";
					}
				}
			}
		}
		
		// 브랜드 할부
		if (typeof(estmDataFinc["B" + valCode.brnd]) != "undefined" && estmDataFinc["B" + valCode.brnd] != "none") {
			var str = dnw_deChar2(estmDataFinc["B" + valCode.brnd]);
			
			dnw_array2(str, "setFincB");
			
			tmp = '';
			
			if (setFincB.fincList.indexOf("!") != -1) {
				tmp = setFincB.fincList.split("!");
			}
			
			for (var key in tmp) {
				var tmp2 = tmp[key].split("@");
				
				// 라인업 적용 확인
				if (setLine.finc.indexOf(tmp2[0]) >= 0) {
					if (tmp2[2].substring(0, 1) == "L") {
						selLeas +="<option value=\"" + tmp2[0] + "\">" + tmp2[1] + "</option>";
					}
					else if (tmp2[2].substring(0, 1) == "R") {
						selRent +="<option value=\"" + tmp2[0] + "\">" + tmp2[1] + "</option>";
					}
					else {
						selFinc +="<option value=\"" + tmp2[0] + "\">" + tmp2[1] + "</option>";
					}
				}
			}
		}
		
		$("#Finc_" + ebox + " .eSelFincGood").html(selFinc);
	}
	
	// 할부 계산 시작
	fince = new Array();
	
	if (chng == "fincC") {
		fincCompO = new Array();	// 비교 적합 목록 이자/월납입금 fodr  C M
		fincCompX = new Array();	// 비교 참고 목록 번호..
		fincCompC = new Array();	// 결과에 대한 할부번호
		
		odrCt = 100000000;
		
		var tmp = "";
		if(!_.isUndefined(part)) {
			tmp = part.split(":");
		}
		
		codes.mon = parseInt(tmp[0]);
		codes.cap = parseInt(tmp[1]);
		
		var fl = 0;
		
		$("#Finc_" + ebox + " .eSelFincGood option").each(function() {
			codes.finc = $(this).val();
			fince = new Array();// 할부 계산
			
			if (codes.finc.substring(0,1) == "U") {
				var str = dnw_deChar2(estmDataSelf["F"+codes.finc.substring(1)]);
			}
			else {
				var str = dnw_deChar2(estmDataFinc["F"+codes.finc]);
			}
			
			dnw_array2(str, "setFinc");
			
			// 트림 제외할부 예외
			if (setTrms.exfn == "" || (setTrms.exfn && setTrms.exfn.indexOf(codes.finc) < 0)) {
				calculate_finance(chng);
				
				var fval = "a" + parseFloat(fince.itr) + ":" + codes.finc + ":" + fince.adBadge;
				
				// 비교 적합 목록 이자/월납입금 fodr  C M
				if (codes.mon == fince.mon && codes.cap == fince.cap) {
					fincCompO[fl] = fval;
				}
				// 비교 참고 목록 번호
				else {
					fincCompX[fl] = fval;
				}
				
				odrCt ++;
				fl++;
				
				fic = ""; 
				
				for (var i in fince) {
					fic += "fince_" + i + "^" + fince[i] + "#";
				}
				
				rsltFinc[codes.finc] = fic;
			}
		});
	}
	// 비교에서 선택한 할부 적용
	else if (chng == "fincP") {
		codes.finc = $("#Finc_" + ebox + " .eSelFincGood").val();
		
		var tmp = part.split(":");
		
		codes.mon = parseInt(tmp[0]);
		codes.cap = parseInt(tmp[1]);
		
		var str = dnw_deChar2(estmDataFinc["F" + codes.finc]);
		
		dnw_array2(str, "setFinc");
		calculate_finance(chng);
	}
	// 임시 : redy일때 104상품 고정
	else {
		codes.finc = 104;
		
		if ($("#Finc_" + ebox + " .ePutFincMons").val()) codes.mon = $("#Finc_" + ebox + " .ePutFincMons").val();
		else codes.mon = 36;
		
		// 원금 수동입력 C
		if (chng != "fincC" && $("#Finc_" + ebox + " .eSelfFincCaps").hasClass("sel")){
				codes.cap = number_only($("#Finc_" + ebox + " .ePutFincCaps").val());
				codes.cas = "";
		}
		else {
			// 디폴트 전액으로 변경
			codes.cas = 0;
			
			if ($("#compSelFincCaps").val()) {
				codes.cap = $("#compSelFincCaps").val() * 10000
			}
			else {
				codes.cap = (price.total >= 20000000) ? ($("#compSelFincCaps").val() * 10000) : price.total;
				
				if (valCode.modl == '3657') {
					codes.cap = 30000000;
				}
			}
		}
		
		codes.rem = "";
		
		var str = dnw_deChar2(estmDataFinc["F" + codes.finc]);
		
		dnw_array2(str, "setFinc");
		
		calculate_finance(chng);
	}

	// 할부 설정
	// 0 no, 1 수동설정, 2 기간, 3 이자, 4 선수, 5 원금, 6 유예
	rsltFcfg[ebox] = codes.finc + ":";
	rsltFcfg[ebox] += ":" + fince.mon + ":" + fince.itr + ":" + fince.cas + ":" + fince.cap + ":" + fince.remS + ":";
	
	if (chng == "fincC") {
		expression_fincC();
	}
	else {
		// 비용 총정리
		if (ftab == "CashS" || ftab == "FincS") calculate_sumry();
		
		// 결과 종합
		txt = ""; 
		
		for (var r in price) {
			txt += "price_" + r + "^" + price[r] + "#";
		}
		
		for (var r in entry) {
			txt += "entry_" + r + "^" + entry[r] + "#";
		}
		
		for (var r in infos) {
			txt += "infos_" + r + "^" + infos[r] + "#";
		}
		
		for (var r in fince) {
			txt += "fince_" + r + "^" + fince[r] + "#";
		}
		
		for (var r in lump) {
			txt += "lump_" + r + "^" + lump[r] + "#";
		}
		
		sumy = ""; 
		
		for (var r in sumry) {
		  sumy += "sumry_" + r + "^" + sumry[r] + "#";
		}
		
		rsltSumy[ebox] = sumy;
		rsltOthr[ebox] = txt+sumy;
		
		// 결과 표시
		expression();
	}
	
	fIValCode = valCode;
	fIPrice = price;
	if(chng == "redy") {
		if(_.isEmpty(fIParam)) {
			setFinancialInstrumentInitialization();
		} else {
			setFinancialInstrumentInitialization(fIParam);
		}
	} else {
		setFinancialPrice();
	}
}

// 총주행거리 추출 
function getTotalDistance (trims) {

	$.ajax({
		url: webUrl + '/service/ajax_getTotalDistance.php',
		type: 'GET',
		dataType: 'json',
		data:{
			Trims: trims
		},
		error: function() {},
		success: function(data) {
			if (data.result) {
				if ($("#totalDistance").length) {
					$("#totalDistance").text(" · 총주행거리 " + data.totalDistance + "km");
				}
				else {
					$(".estimate-model__spec .row").eq(1).append("<span id='totalDistance'> · 총주행거리 " + data.totalDistance + "km</span>");
				}				
				
			}
			else{
				$("#totalDistance").remove();
			}
		}
	});
}

function expression() {
	var src = "//autoimg.danawa.com/photo/" + valCode.modl + "/" + setLine.poto + "/lineup_360.png";
	
	$("meta[property='og:title']").attr('content', rsltName[ebox].replace(/_/gi, " ") + "  | 신차견적 :: 다나와 자동차");
	$("meta[property='og:url']").attr('content', location.origin + "/newcar/?Work=estimate&Code=" + rsltCode[ebox] + "&Conf=" + rsltConf[ebox]);
	
	$("#metaUrl").val(location.origin + "/newcar/?Work=estimate&Code=" + rsltCode[ebox] + "&Conf=" + rsltConf[ebox]);
	window.history.replaceState("견적", "신차견적", $("meta[property='og:url']").attr('content'));
	
	if (!$("#layerPopup").hasClass('off')) {
		if(!window.location.hash || window.location.hash.indexOf("popup")<0) {
			window.location.hash= window.location.hash + 'popup';
		}
	}
	
	$("meta[property='og:image']").attr('content', src);
	
	if (echg == 'line' || echg == 'trns' || echg == 'redy') {
		//모델 이미지
		$("#modelColorList").attr('key', lineInfo[valCode.line]['photo']);
		$(".eImgModel").attr('src', "//autoimg.danawa.com/photo/" + valCode.modl + "/" + setLine.poto + "/lineup_360.png");
		$(".eImgModel").attr('alt', texts.model);
		
		//랴인 색상
		var exteriorColor = dnw_deChar2(lineInfo[valCode.line]['colorExterior'])
		var exteriorColorArray = exteriorColor.split('\n')
		var txt = '';
		var selectedButton = '';
		
		for (key in exteriorColorArray) {
			var temp = exteriorColorArray[key].split('`');
			
			if (valCode.brnd < 340) {
				if (temp[1] != undefined && (temp[1] == '1' || temp[1] == '2')) {
					var colorHexadecimal = temp[3].split('/');
					
					if (colorHexadecimal.length == 1) {
						txt +=
							"<button class='" + selectedButton + "' style='background:#" + temp[3] + "' type='button' color=" + temp[0] + ">" +
								"<span class='screen_out'>" + temp[2] + "</span>" +
							"</button>";						
					}
					else if (colorHexadecimal.length == 2) {
						txt +=
							"<button class='" + selectedButton + "' style='background:#" + colorHexadecimal[0] + "' type='button' color=" + temp[0] + ">" +
								"<span style='background:#"+ colorHexadecimal[1] +"' class='color twotone'></span>" +
							"</button>";
					}					
				}
			}
		}
		
		$("#modelColorList").html(txt);
	}
	
	//브랜드 로고
	if (mobile) {
		$(".eImgBrandLogo").attr('src', '//autoimg.danawa.com/photo/brand/' + salesBrand + '_90.png');
	}
	else {
		$(".eImgBrandLogo").attr('src', '//autoimg.danawa.com/photo/brand/' + salesBrand + '_40.png');
	}

	//트림 이름
	var str = dnw_deChar2(estmDataAuto['M' + valCode.modl]);
	
	dnw_array2(str, "setModl");
	
	var tmp = setModl.trimsList.split("`");	
	
	$("#info_summary .eFullName").text(texts.brand+" "+texts.model+" "+texts.modelYear+" "+texts.lineup2+" "+texts.trim);

	/*트림 정보*/
	$("#trimLaunchDate").text(lineInfo[valCode.line]['launch'].substr(0,7).replace('-', '.') + '. 출시');
	$("#trimFuel").text(infos.fuel);
	
	if (setTrms.fuel.substring(0, 1) == "E") {
		$("#trimDisp").addClass('off');
		
		if(_.isEmpty(infos.effm)) {
			$("#trimEffm").text("복합전비 인증中");
		} else {
			$("#trimEffm").text('복합 ' + infos.effm + ' ㎞/kWh');
		}
	}
	else if (setTrms.fuel.substring(0, 1) == "H") {
		$("#trimDisp").addClass('off');
		if(_.isEmpty(infos.effm)) {
			$("#trimEffm").text("복합전비 인증中");
		} else {
			$("#trimEffm").text('복합 ' + infos.effm + ' ㎞/kg');
		}
	}
	else {
		$("#trimDisp").text(infos.disp + 'cc');
		if(_.isEmpty(infos.effm)) {
			$("#trimEffm").text("복합연비 인증中");
		} else {
			$("#trimEffm").text('복합 ' + infos.effm + ' ㎞/ℓ');
		}
	}
	
	//옵션가격
	if (price.itms != 0) {
		if (price.itms > 0) {
			$(".eOptionPriceInfo").text('+' + number_format(price.itms));
		}
		else {
			$(".eOptionPriceInfo").text('-' + number_format(Math.abs(price.itms)));
		}
	}
	else {
		$(".eOptionPriceInfo").text(number_format(price.itms));		
	}
	
	//옵션 목록
	var txt = '';
	
	if (price.itmsN.length > 0) {
		var temp = price.itmsN.split('!');
		
		$.each(temp, function(key, val) {
			val = val.split('`');
			
			var selectOptiontext = "";
			
			if (val[1] > 0) {
				selectOptiontext = "+" + number_format(val[1]);
			}
			else {
				selectOptiontext = "-" + number_format(Math.abs(val[1]));
			}

			txt += "<div class='row'>\
                        <div class='item'>"+val[2]+"</div>\
                        <div class='price'>"+selectOptiontext+"</div>\
                        <div class='del'><a href='javascript:void(0);' class='btn_del optionDel' val='"+val[0]+"'><span class='blind'>선택품목 삭제</span></a></div>\
                    </div>";
		});		
	}
	
	$(".eSelOptionList").html(txt);
	
	//할인
	$(".eRsltTermSum").text(number_format(price.DCsum));
	
	$("#info_summary .estimate-result__total .sale").text("");
	if (brand > 300 && price.DCsum) {
		$("#info_summary .estimate-result__total .sale").text(number_format(price.DCsum)+" 할인");
	}
	
	//할인 목록
	txt = '';
	
	if (price.termN.length > 0) {
		var temp = price.termN.split('!');
		var point = '';
		
		$.each(temp, function(key, val) {
			val = val.split('`');
			point = '';
			
			if (estmDataTermImport["T"+valCode.trms]) {
				point = 'point';
			}
			
			if (val[0] != 'OUD2') {
				
				var pricText = "";
				
				if (val[1] > 0) {
					pricText = "-"+number_format(val[1]);
				}

				txt += "<div class='row'>\
							<div class='item "+point+"'>"+val[2]+"</div>\
							<div class='price "+point+"'>"+pricText+"</div>\
							<div class='del'><a href='javascript:void(0);' class='btn_del discountDel' val='"+val[0]+"'><span class='blind'>선택품목 삭제</span></a></div>\
						</div>";				
			}
		});		
	}
	
	$(".eSelDiscountList").html(txt);
	
	
	// 면세조건
	// 2019.01.01 경차 세액 한도에 따른 문구 추가 k (경차 감면) 
	/*
	var taxDesc = '';
	
	if (entry.ataxK == "C") taxDesc = "(다자녀 감면)";
	else if (entry.ataxK == "h") taxDesc = "(하이브리드 감면)";
	else if (entry.ataxK == "e") taxDesc = "(전기차 감면)";
	else if (entry.ataxK == "K") taxDesc = "(경차 면제)";
	else if (entry.ataxK == "k") taxDesc = "(경차 감면)";
	else if (entry.ataxK == "o") taxDesc = "(노후차 감면)";	
 	else if (entry.ataxK) taxDesc = "(장애인 면제)";
	else taxDesc = "(" + entry.ataxR + "%)";
	
	$("#Enty_"+ebox+" .eRsltRegiTaxR").text($("#select_01 option:selected").text()+" "+taxDesc);
	*/
	
	$("#Enty_"+ebox+" .eRsltRegiTaxR").text($("#select_free option:selected").text());
	$("#Enty_"+ebox+" .eRsltRegiTax").text(number_format(entry.atax)+"원");
	
	// 채권 할인
	/*
	var bondDesc = "";
	
	if (entry.bondK == "h") bondDesc += "하이브리드 감면";
	else if (entry.bondK == "e") bondDesc += "전기차 감면";
	else if (entry.bondK == "K") bondDesc += "경차 면제";
	else if (entry.bondK) bondDesc += "장애인 면제";
	else if (entry.bondB) bondDesc += "= 매입 <span class='num'>" + number_format(entry.bondB) + "</span> X 할인율 " + entry.bondSR + "%";
	else bondDesc += "채권 매입 없음";
	$("#Enty_"+ebox+" .eRsltRegiBondR").text($("#select_02 option:selected").text()+" "+bondDesc);
	*/

	$("#Enty_"+ebox+" .eRsltRegiBondR").text($("#select_loca option:selected").text());
	$("#Enty_"+ebox+" .eRsltRegiBond").text(number_format(entry.bondS)+"원");
	
	/* 세제혜택 */
	var freeDesc = "없음";
	var freeSum = "0";
	
	if (price.free > 0) {
		freeDesc = "과세추가";
		freeSum = "+" + number_format(price.free);
		
		if (hasSpecialConsumptionTaxDiscounted > 0) {
			freeDesc = "개별소비세 인하 + " + freeDesc;
		}
	}
	else if (price.free < 0 && price.taxK == "e") {
//		freeDesc = "전기차";
//		freeSum = "-" + number_format(price.free*-1);
//		
//		if (hasSpecialConsumptionTaxDiscounted > 0) {
//			freeDesc = "개별소비세 인하 + " + freeDesc;
//		}
	}
	else if (price.free < 0 && price.taxK == "c") {
		freeDesc = "연료전지차";
		freeSum = "-" + number_format(price.free*-1);
		
		if (hasSpecialConsumptionTaxDiscounted > 0) {
			freeDesc = "개별소비세 인하 + " + freeDesc;
		}
	}
	else if (price.free < 0 && price.taxK == "h") {
		freeDesc = "하이브리드";
		freeSum = "-" + number_format(price.free*-1);
		
		if (hasSpecialConsumptionTaxDiscounted > 0) {
			freeDesc = "개별소비세 인하 + " + freeDesc;
		}
	}
	else if (price.free < 0 && (price.taxK == "T" || price.taxK == "C")){
		freeDesc = "영업용면세";
		freeSum = "-"+number_format(price.free*-1);
		
		if (hasSpecialConsumptionTaxDiscounted > 0) {
			freeDesc = "개별소비세 인하 + " + freeDesc;
		}
	}
	else if (hasSpecialConsumptionTaxDiscounted > 0) {
		freeDesc = "개별소비세 인하";
		freeSum = "-"+number_format(price.free*-1);
	}
	else if (price.taxK == 'G') {
		freeDesc = "다자녀 감면";
		freeSum = "-"+number_format(price.free*-1);
	}
	else if (price.free < 0) {
		freeDesc = "장애인면세";
		freeSum = "-"+number_format(price.free*-1);
	}
	
	if (price.free == 0 && price.taxK) {
		freeDesc = "면세가격 확인중";
		freeSum = '';
	}
	
	// 관리자 친환경 형식의 "BEV" 선택된 경우 해당 노출하도록 변경
	if(!_.isNull(setTrms.dvsn) && !_.isUndefined(setTrms.dvsn) && setTrms.dvsn.match("d")) {
		freeDesc = "전기차";
		freeSum = "-" + number_format(price.free*-1);
		
		if (hasSpecialConsumptionTaxDiscounted > 0) {
			freeDesc = "개별소비세 인하 + " + freeDesc;
		}		
	}
	
	$(".eRsltFreeDesc").text('');
	if (price.free != 0) {
		$(".eRsltFreeDesc").text(freeSum).prev(".item").text(freeDesc);
	}
	// 개소세 혜택 적용/종료 선택 기능 추가 2015-11-24
	else if(price.spDC) {
		if (ctaxCalType == "X") {
			$(".eRsltFreeTextDesc").text("개별소비세 인하 종료");
			$(".eRsltFreeDesc").text("-"+number_format(Math.abs(price.spDC / 10000)));
		}
	}
	
	/*노후차 코맨트 입력 2019.10.17 제거*/
	//$(".eRsltOldCarFreeDesc").html('');

	// 차량 가격 (hide)
	$(".eRsltPriceSum").html(number_format(price.base));
	
	// 기본가격
	$(".eTextPriceInfo").text(number_format(price.base+price.free));
	
	// 기본가격>세금 혜택 적용 전
	if(price.taxK == "e" || price.taxK == "h" || price.taxK == "c") {
		$(".preTaxBenefit").show();
		$(".eRsltBeforeFreeDesc").html(number_format(price.base))
	} else {
		$(".preTaxBenefit").hide();
	}
	
	
	// 기본가격>세금 혜택 적용 전
	$(".eRsltBeforeFreeDesc").html(number_format(price.base))
	
	// 차량 가격
	$(".eRsltVehicleSum").html(number_format(price.total-price.trns));
	
	// 가격 + 비용
	$(".eRsltPriceTotalSum").html(number_format(price.total+entry.total));
	
	// 탁송료
	var trnsDesc = "";
	
	if (price.trnsSite) {
		trnsDesc = number_format(price.trns);
		$(".eRsltTrnsDesc").addClass('num');
	}
	else {
		trnsDesc = "별도";
		$(".eRsltTrnsDesc").removeClass('num');
	}
	
	$(".eRsltTrnsDesc").html(trnsDesc);
	
	// 전기차 보조금
	var sEvLocIncntText = "지자체 보조금";
	var nEvLocIncnt = 0;
	var nEvGovIncnt = 0;
	
	if(infos.incntZone) {
		tmp = infos.incntZone.split("`");
		if(tmp[0]) sEvLocIncntText = tmp[0];
		if(tmp[1]) sEvLocIncntText += " > "+tmp[1];
		
		if(sEvLocIncntText != "") sEvLocIncntText = "지자체 보조금("+sEvLocIncntText+")";
	}
	
	if(infos.incntLoc) {
		nEvLocIncnt = infos.incntLoc;
	}
	
	if(infos.incntGov) {
		nEvGovIncnt = infos.incntGov;
	}
	$("#Incnt_1 .nGovIncentive").attr("data-govincentive",(nEvGovIncnt * -1)/10000)
	$("#Incnt_1 .nGovIncentive").text((nEvGovIncnt*-1)/10000 + "만 원");
	
	$("#info_summary .eRsltGovIncnt").html(number_format(nEvGovIncnt*-1));
	$("#info_summary .eRsltLocIncnt").prev(".left").html(sEvLocIncntText);
	$("#info_summary .eRsltLocIncnt").html(number_format(nEvLocIncnt*-1));
	$("#info_summary .eRsltTotIncnt").html(number_format(price.incnt*-1));
	
	// 비용 (기타가격 합계)
	$(".eEtcPriceSum").html(number_format(entry.total+price.trns))
	
	// 할부 상품 상세
	$("#Finc_" + ebox + " .eRsltFincName").attr("fincNo", fince.codeF);
	$("#Finc_" + ebox + " .eRsltFincName").attr("fincComp", fince.mon + ":" + fince.cap);
	$("#Finc_" + ebox + " .eRsltFincName").text(fince.nameC + ' ' + fince.nameF);
	$("#Finc_" + ebox + " .eFinceCap").text(number_format(fince.cap));
	$("#Finc_" + ebox + " .eRsltFincRate").text(fince.itr + "%");
	$("#Finc_" + ebox + " .eRsltFincItrSum").text(number_format(fince.itrSum));	
	
	var payTxt = "월납입금액";
	var costSum = price.total-fince.cap;
	var monthTxt = "";
	var closeSum = 0;
	var closeTxt = "";
	
	if (fince.kindC.substr(0, 1) == "W") {
		var payArr = fince.payM.split("~");
		var pay = number_format(payArr[0]) + "~" + number_format(payArr[1]);
	}
	else if (fince.kindC.substr(0, 1) == "G") {
		var payArr = fince.payM.split("~");
		var pay = number_format(payArr[0]) + "/" + number_format(payArr[1]);
	}
	else {
		var pay = number_format(fince.payM);
	}
	
	//원금균등
	if (fince.kindC.substr(0, 1) == "W") {
		var payArr = fince.payM.split("~");
		var pay = number_format(payArr[0]) + "~" + number_format(payArr[1]);
	}
	//거치
	else if (fince.kindC.substr(0, 1) == "G") {
		var payArr = fince.payM.split("~");
		var pay = number_format(payArr[0]) + "/" + number_format(payArr[1]);
	}
	//그외
	else {
		var pay = number_format(fince.payM);
		
		//유예원금
		$(".eRsltFincComment").html('');
		
		if (fince.kindC.substr(0, 1) == "U") {
			closeSum = fince.rem;
			$(".eRsltFincComment").html('(유예 ' + number_format(fince.rem) + ')');
		}
		//자유상환
		else if (fince.kindC.substr(0,1) == "F") {
			closeSum = fince.cap;
		}
	}
	
	$("#Finc_" + ebox + " .eRsltFincGrand").text(number_format(fince.cap + fince.itrSum));
	$("#Finc_" + ebox + " .eRsltFincPayM").text(pay);
	$("#Finc_" + ebox + " .eRsltFincPayName").text(payTxt);
	
	//카드 캐시백, 모바일 주유권
	var fincDiscountSum = 0;
	var txt = '';
	var gasPrice = 0;
	
	// 삼성카드 다이렉트 카드할부일 때 중도상환 수수료 내용 추가
	if (fince.codeF == '449') {
		txt += "<div class='desc'><span class='txt'>중도상환 수수료 면제, 대출기록 남지 않음</span><span class='price'></span></div>";
	}
	
	if (fince.codeF == '104' || fince.codeF == '449') {
		var now = new Date();
		var todayDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
		var compareDate = new Date("04/01/2019");
		
		if (parseInt(fince.cap) >= 20000000 && todayDate.getTime() < compareDate.getTime()) {
			fince.back = 399000;
		}
		else {
			fince.back = 0;
		}
	} else if (fince.codeF == '453') {
		if (parseInt(fince.cap) >= 30000000) {
			fince.back = 300000;
		}
	}
	
	if (fince.back != 0 && fince.codeF != '458') {
		fincDiscountSum += fince.back;

		var title = '할부원금 캐시백';
		
		if (fince.codeF == '104' || fince.codeF == '449') {
			title = "파인뷰 LX200 블랙박스 증정<button type='button' class='buttonHelp eFincPopup' val='' subject='파인뷰 LX2000 블랙박스 증정 이벤트 안내' kind='event'><span class='screen_behind'>보기</span></button>";
		}
		
		txt += "<div class='desc'><span class='txt'>"+title + "</span><span class='price'>" + number_format(fince.back * (-1)) + "</span></div>";
	}
	
	/*
	 * 차량가 캐시백 cashbackC
	 * 2018.08.14 verere@danawa.com
	 */
	if (fince.backC) {
		var title = "차량가 캐시백";
		
		fincDiscountSum += fince.backC;
		
		title += "<button type='button' class='buttonHelp eFincPopup' val='' subject='차량가 캐시백' kind='cashbackC'><span class='screen_behind'>보기</span></button>";

		txt += "<div class='desc'><span class='txt'>"+title+ "</span><span class='price'>" + number_format(fince.back * (-1)) + "</span></div>";
	}

	// 카드 캐시백 선수금
	if (fince.preP) {
		fincDiscountSum += fince.preP;

		txt += "<div class='desc'><span class='txt'>선수금 캐시백</span><span class='price'>" + number_format(fince.preP * (-1)) + "</span></div>";
	}
	
	var eventPrice = 0;
	var eventTitle = '첫 달 할부 이자 지원';
	var eventLink = '/event/?Tab=event&Work=detail&Stab=ing&no=3321601&reply=3321601&Page=1';
	var eventPrimeRateHtml = '';
	
	var brandCode = valCode.brnd;
	var modelCode = valCode.modl;
	
	// ajax를 통한 추가혜택 기본링크, 우대금리 데이터 조회하기
	$.ajax({
		url: webUrl + '/service/ajax_estimate_action.php',
		type: 'POST',
		dataType: 'json',
		data:{
			Wjob: 'getFinceInfo',
			No: fince.codeF
		},
		async: false,
		error: function() {},
		success: function(data) {
			if (data.rslt) {
				if (data.description2 != '') {
					eventLink = data.description2;
				}
				
				if (data.description3 != '') {
					eventPrimeRateHtml = data.description3;
				}
			}
		}
	});
	
//	var now = new Date();
//	var compareDate = new Date("2022-06-01");		//2022년 6월 1일자 이벤트 분기날짜 적용
//	var bCompareDatePassed = false;
//	
//	if (now > compareDate) {
//		bCompareDatePassed = true;
//	}
	
	// 삼성카드 카드할부 455, 삼성카드 오토할부 104
	if (fince.codeF == '104' || fince.codeF == '455') {
		if ($("#compSelFincCaps").val() >= 4500) {
			eventPrice = 519000;
			eventTitle = '파인뷰 LXQ2000+출장장착';
			eventLink = '/event/?Tab=event&Work=detail&Stab=ing&no=3534712&reply=3534712&Page=1';
			txt += "<div class='desc'><span class='txt'>"+ eventTitle +" <a href='"+ eventLink +"' target='_blank'>이벤트</a></span><span class='price'>" + number_format(eventPrice * (-1)) + "</span></div>";
		}
	//하나은행 원더카 452
	} else if (fince.codeF == 452) {
		var cashbackRaito = 0;

		if (fince.mon < 36) {
			cashbackRaito = 0;
		} else if (fince.mon < 60) {
			cashbackRaito = 2.0;
		} else if (fince.mon < 120) {
			cashbackRaito = 2.2;
		} else if (fince.mon >= 120) {
			cashbackRaito = 2.4;
		}

		eventPrice = (($("#compSelFincCaps").val() * 10000) * cashbackRaito)/100;
		eventLink = '/event/?Tab=event&Work=detail&Stab=ing&no=3426818&reply=3426818&Page=1';		//하나은행 원더카 이벤트 링크 변경 220421

		if (eventPrice) {
			eventTitle = cashbackRaito + '% 캐시백';
			txt += "<div class='desc'><span class='txt'>"+ eventTitle +" <a href='"+ eventLink +"' target='_blank'>이벤트</a></span><span class='price'>" + number_format(eventPrice * (-1)) + "</span></div>";
		}
	//국민은행 슬림할부 458
	} else if (fince.codeF == 458) {		
		if ($("#compSelFincCaps").val() >= 1000) {
			cashbackRaito = 0.7;
			eventPrice = (($("#compSelFincCaps").val() * 10000) * cashbackRaito)/100;
			eventLink = '/event/?Tab=event&Work=detail&Stab=ing&no=3523313&reply=3523313&Page=1';
			eventTitle = '할부원금 0.7% 캐시백';
			
			txt += "<div class='desc'><span class='txt'>"+ eventTitle +" <a href='"+ eventLink +"' target='_blank'>이벤트</a></span><span class='price'>" + number_format(eventPrice * (-1)) + "</span></div>";
		}
	//신한 마이카 할부, 운영은 451
	} else if (fince.codeF == 451) {		
		if ($("#compSelFincCaps").val() >= 2000 && $("#compSelFincCaps").val() < 4000) {
			eventPrice = 150000;
			eventTitle = '15만 포인트';
		} else if ($("#compSelFincCaps").val() >= 4000 && $("#compSelFincCaps").val() < 5000) {
			eventPrice = 200000;
			eventTitle = '20만 포인트';
		} else if ($("#compSelFincCaps").val() >= 5000) {
			eventPrice = 250000;
			eventTitle = '25만 포인트';
		}
			
			eventLink = '/event/?Tab=event&Work=detail&Stab=ing&no=3515540&reply=3515540&Page=1';		//하나은행 원더카 이벤트 링크 변경 220421

		if(eventPrice >= 150000) {
			txt += "<div class='desc'><span class='txt'>"+ eventTitle +" <a href='"+ eventLink +"' target='_blank'>이벤트</a></span><span class='price'>" + number_format(eventPrice * (-1)) + "</span></div>";
		}
	}
	
	// 기본할인 조건 변경
	if (fince.lost) {
		fincDiscountSum += fince.lost * (-1);
		
		var title = '';
		var sign = '';
		var risk = '';
		var riskClass = 'txt';
		var mobileRiskClass = '';
		var mobileRisk = '';
		
		if (fince.lost > 0) {
			title += '기본할인 감소 금액';			
			sign = '-';
			riskClass = 'txt_risk';
			risk = '<span class="risk">!</span>';
			mobileRiskClass = 'red';
			mobileRisk = '<em class="risk"></em>';
		}
		else {
			title += '기본할인 증가 금액';
		}
		
		txt += "<div class='desc'><span class='txt'>"+title+"</span><span class='price'>" + number_format(Math.abs(fince.lost  * (-1))) + "</span></div>";
	}

	// 추가혜택
	$("#Finc_"+ebox+" .eRsltFincDiscount").html("<div class='title'>추가혜택</div>"+txt).addClass('hide');
	
	if (txt) {
		$("#Finc_"+ebox+" .eRsltFincDiscount").removeClass('hide');
		
		if (eventPrimeRateHtml) {
			$("#Finc_"+ebox+" .eRsltFincDiscount").addClass('cont_exce');
		}
		else {
			$("#Finc_"+ebox+" .eRsltFincDiscount").removeClass('cont_exce');
		}
	}
	
	// 우대금리
	$("#Finc_"+ebox+" .eRsltFincDiscountSum").html(number_format(fincDiscountSum  * (-1)));		
	
	$("#Finc_"+ebox+" #eRsltPrimeRate_"+fince.codeF).html(eventPrimeRateHtml).addClass('hide');
	
	if (eventPrimeRateHtml) {
		$("#Finc_"+ebox+" #eRsltPrimeRate_"+fince.codeF).removeClass('hide').find('div[class^="estimate-pay__rate--"]').not('.estimate-pay__rate--middle').find(".rate_num").text(parseFloat(fince.itr).toFixed((fince.itr).length-2)+"%");
	}
	
	// 추가혜택X, 우대금리X
	if ($("#Finc_"+ebox+" .eRsltFincDiscount").hasClass('hide') && $("#Finc_"+ebox+" #eRsltPrimeRate_"+fince.codeF).hasClass('hide')) {
		$("#financeList_"+fince.codeF+" .choice-pay__ad").addClass('hide');
	}
	
	if (fince.preP) {
		var sum = parseInt(fince.cap) + parseInt(fince.itrSum) - (fince.lost * (-1)) - fince.back - fince.backC - fince.preP;
	}
	else {
		var sum = parseInt(fince.cap) + parseInt(fince.itrSum) - (fince.lost * (-1)) - fince.back - fince.backC;		
	}

	// 등록 부대 비용
	$(".eRsltRegiSum").html(number_format(entry.total - 40000));

	// 할부 금액, 일시불 결제 가격범위
	var val = $("#compSelFincCaps").val() * 10000;
	var consignmentFee = price.trns;
	var sellingPrice = price.total;
	var maxFiancePrincipal = 0;
	
	if (!$.isNumeric(consignmentFee)) {
		consignmentFee = 0;
	}
	
	maxFiancePrincipal = sellingPrice - consignmentFee;

	$("#compSelFincCaps").closest('.estimate-pay__prepay').find('.emphasis').html('* ' + number_format( number_round(maxFiancePrincipal, 1000000, 'ceil') / 1000000 ) + '만원 ~ ' + number_format( number_round(maxFiancePrincipal, 10000, 'floor') / 10000 ));
	$("#compSelCashCaps").closest('.estimate-pay__prepay').find('.emphasis').html('* ~' + number_format( number_round(price.total, 10000, 'floor') / 10000 ));
	
	if($('#usePopRequestLayer').val() == 'Y') {
		$(window).load(function(){
			$('div.estimate-result__request a#requestSubmit').trigger('click');
			$('#usePopRequestLayer').val('');
		});
	}
}

// 모델의 트림 표시
function listTrims(eNo, modl)
{
	var sildeHeadCss = "";
	var slideListCss = "";
	var slideBtn = "";
	var slideBtnEnd = "";
	
	var str = dnw_deChar2(estmDataAuto['M'+modl]);
	
	dnw_array2(str, "setModl");
	
	var eLine = new Array();
	var tmpL = setModl.lineupList.split("`");
	
	for (key in tmpL) {
		var tmpL2 = tmpL[key].split(":");
		var codeL = tmpL2[0].substring(7);
		
		eLine[codeL] = tmpL2[1];
	}
	
	var txt = "";
	var oldL = "0";
	var eCkd = "";
	var tmp = setModl.trimsList.split("`");
	var ct = 0;
	var lineCkd = "";
	var trimsAddInfo = '';
	var trimsDiscount = '';
	var lct = 0;
	var trimChecked = "";

	var trimsCountList = "";
	for (key in tmp) {
		var tmp2 = tmp[key].split(":");
		var tmpTrim = tmp2[0].substring(12,17);
		
		if (!trimsCountList) {
			trimsCountList += tmpTrim
		}
		else {
			trimsCountList += "," + tmpTrim
		}
	}
	
	var trimsEVCountList = [];
	$.ajax({
		type : "GET",
		url : webUrl + "/service/ajax_EVincentive_trimCheck.php",
		dataType : "json",
		data : {trimsCode : trimsCountList},
		async : false, 
		success : function (data) {
			trimsEVCountList = data;
		},
		error : function () {}
	});

	var checkedTrim = '';
	
	for (key in tmp) {
		var bExistsImportBenefit = false;
		var bExistsImportBenefitAdditional = false;
		
		var tmp2 = tmp[key].split(":");
		var codeM = tmp2[0].substring(3,7);
		var codeL = tmp2[0].substring(7,12);
		var codeT = tmp2[0].substring(12,17);
		
		var trimsInfo = dnw_deChar2(estmDataAuto["T" + codeT]);
		
		dnw_array2(trimsInfo, "setTrms");
		
		var trimsFuel = setTrms.fuel;
		
		if (tmp2[6].indexOf("h") > 0 || tmp2[6].indexOf("f") > 0) {
			trimsFuel = "h";
		}
		
		// 개소세 혜택 적용/종료 선택 기능 추가 2015-11-24
		// 2015-08-27 개별소비세 인하 자동 반영 기능 추가 5.0 -> 3.5
		if ((tmp2[5] == "5.0" && ctaxCalType == "O") || (tmp2[5] == "3.5" && ctaxCalType == "X")){
			tmp2[3] = parseInt(tmp2[3]) + taxChangedPrice(tmp2[5],tmp2[3]);
		}
		
		// 트림 미지정
		if (rsltCode[eNo] == 0 && ct == 0) {
			eCkd = "checked";
			lineCkd = tmp2[0].substring(0,12);
			trimChecked = tmp2[0];
		}
		// 트림 지정
		else if (rsltCode[eNo] == tmp2[0] || rsltCode[eNo] == tmp2[0].substring(12)) {
			eCkd = "checked";
			lineCkd = tmp2[0].substring(0,12);
			trimChecked = tmp2[0];
		}
		else {
			eCkd = "";
		}
		
		var existBenefit = false;
		if (oldL != codeL) {
			var close = '';

			var fullName = eLine[codeL];
			
			var divisionLabel = "";
			if (tmp2[6].indexOf("n1") > 0) {
				divisionLabel += "<div class='etc_label'><span class='g-label-echo'>저공해1종</span></div>";
			}
			if (tmp2[6].indexOf("n2") > 0) {
				divisionLabel += "<div class='etc_label'><span class='g-label-echo'>저공해2종</span></div>";
			}
			if (tmp2[6].indexOf("n3") > 0) {
				divisionLabel += "<div class='etc_label'><span class='g-label-echo'>저공해3종</span></div>";
			}
			
			var lineupAddInfo = "<div class='label_area'>";
			
			if (divisionLabel) {
				lineupAddInfo += divisionLabel;
			}

			if (estmModelLineupRank["M"+codeM+"L"+codeL]) {
				lineupAddInfo += "<div class='prefer_label'><span class='g-label-newtop'>TOP"+estmModelLineupRank["M"+codeM+"L"+codeL].split("`")[0]+"</span><span class='rate'>선택률: <span class='num'>"+estmModelLineupRank["M"+codeM+"L"+codeL].split("`")[1]+"%</span></span></div>";
			}
			
			lineupAddInfo += "</div>"
			
			if (txt) txt += "</div></div>";

			txt += "<div class='eChkTrimList article-box article-box--close' code='" + tmp2[0].substring(0, 12) + "'>\
		                <div class='article-box__header'>\
		                    <h4 class='title'>"+fullName+"</h4>\
		                    <a href='javascript:getSpecPopup(\"price\", "+codeL+", \"가격·제원·사양\", "+codeT+", "+modl+")' class='sendGA g-btn__info' data-actionlabel='라인업 가격제원사양`"+codeL+"'>가격·사양/옵션·제원 페이지로 이동</a>\
		                    <a href='javascript:void(0);' class='sendGA btn-toggle' data-actionlabel='라인업 펼쳐보기`"+codeL+"'>접기</a>\
		                    "+lineupAddInfo+"\
		                </div>\
		                <div class='article-box__cont'>";
			
			oldL = codeL;
			
			lct ++;
		}

		var subsidiarySupportInfo = '';
		if (setTrms.subsidiarySupportYN == 'Y') {
			subsidiarySupportInfo = "<span class='g-label-subsidy'>보조금100%</span>";
		}
		
		trimsAddInfo = '';
		
		
		if (estmLineupTrimRank["L"+codeL+"T"+codeT]) {
			if (subsidiarySupportInfo) {
				subsidiarySupportInfo = "<div class='etc_label'><span class='g-label-subsidy'>보조금100%</span></div>";
			}
			trimsAddInfo += subsidiarySupportInfo + "<div class='prefer_label'><span class='g-label-newtop'>TOP"+estmLineupTrimRank["L"+codeL+"T"+codeT].split("`")[0]+"</span><span class='rate'>선택률: <span class='num'>"+estmLineupTrimRank["L"+codeL+"T"+codeT].split("`")[1]+"%</span></span></div>";
			
			subsidiarySupportInfo = '';
		}

		var off = '';
		
		// 세제혜택 적용 가격
		var trimPrice = tmp2[3];
		
		if (setTrms.priceAfterTax) {
			trimPrice = setTrms.priceAfterTax;
		}
		
		var estmDataTermImportTemp = '';
		if(Math.abs(trimPrice)>100){
			trimPrice = number_format(trimPrice/10000);
			if (estmDataTermImport["T"+codeT]) {
				estmDataTermImportTemp = estmDataTermImport["T"+codeT].split("`");
				
				if (estmDataTermImportTemp[0] == 'Y') {
					trimsAddInfo += "<div class='etc_label'><span class='g-label-special'>특가</span>" + subsidiarySupportInfo + "</div>";
					subsidiarySupportInfo = '';
				}
			}
		}
		
		var hightrimPriceClass = '';
		if(trimPrice != null && trimPrice != "") {
			if(Number(trimPrice.replace(',', '')) >= 10000) {
				var backPrcie = trimPrice.slice(-5);
				var frontPrcie = trimPrice.replace(backPrcie, '');
				backPrcie = number_format(Number(backPrcie.replace(',', '')));
				
				hightrimPriceClass = "<span class='num'>"+ frontPrcie +"</span>억 <span class='num'>" + backPrcie + "</span>만 원";
			} else {
				hightrimPriceClass = "<span class='num'>"+trimPrice+"</span>만 원";
			}			
		} 
		
		if (subsidiarySupportInfo) {
			subsidiarySupportInfo = "<div class='etc_label'><span class='g-label-subsidy'>보조금100%</span></div>";
			trimsAddInfo += subsidiarySupportInfo;
		}
		
		
		// 보조금 정보가 있는 트림에만 보조금 문구 출력을 위해 추가
		var subsidyTrimsClass = ""
		var subsidyTrimsSpanTag = "";
		var subsidyTrimsMobileChoicePriceClass = "";
		
		if (trimsEVCountList[codeT]) {
			subsidyTrimsClass = "choice__price--subsidy";
			subsidyTrimsSpanTag = "<span class='text__subsidy'></span>";
			if (mobile) {
				subsidyTrimsMobileChoicePriceClass = "choice__wrap--subsidy";
			}	
		}
		
		if(estmDataTermImportTemp != '') {
			if(estmDataTermImportTemp[1] != '' || estmDataTermImportTemp[2]) {
				bExistsImportBenefit = true;
			} else if(estmDataTermImportTemp[3] != '' || estmDataTermImportTemp[4]) {
				bExistsImportBenefitAdditional = true;
			}
		}
		
		if(brand >= 340 && bExistsImportBenefit == true) {
			existBenefit = true;
			var toggleClass = 'close'
				
			if(eCkd == 'checked') {
				checkedTrim = codeT;
				toggleClass = 'open'
			}
			
			var financeTxt = '';
			var cashTxt = '';
			var tmpName = setTrms.name.split("`");;
			var discountText = '';
			var discountPrice = 0;
			
			if(estmDataTermImportTemp[2] != '') {
				var financeChecked = '';
				if(estmDataTermImportTemp[1] != '') {
					if(estmDataTermImportTemp[2] >= estmDataTermImportTemp[1]) {
						financeChecked = 'checked';
						discountText = number_format(estmDataTermImportTemp[2]/10000);
						discountPrice = estmDataTermImportTemp[2]/10000;
					}
				}
				
				financeTxt += "<div class='imported-discount__choice'>\
					<input type='checkbox' name='discountFinanceCheck_" + codeT + "F' id='discountFinanceCheck_" + codeT + "F' " + financeChecked +" data-price='" + estmDataTermImportTemp[2]/10000 +"'>\
					<label for='discountFinanceCheck_" + codeT + "F'>" + tmpName[0] + " 파이낸스 이용 시 할인</label>\
					<div class='imported-discount__check'><span class='icon__check'></span></div>\
					<div class='imported-discount__wrap'>\
                    	<div class='imported-discount__info'><span class='text__info'>" + tmpName[0] + " 파이낸스 이용 시 할인</span><a href='javascript:void(0)' class='g-btn__help eFincPopup on' kind='dictionary' val='470'>도움말</a></div>\
                    	<div class='imported-discount__price'><span class='text__price'>-" + number_format(estmDataTermImportTemp[2]/10000) + "만 원</span></div>\
					</div>\
				</div>";
			}
			
			if(estmDataTermImportTemp[1] != '') {
				var cashChecked = '';
				if(estmDataTermImportTemp[2] != '') {
					if(estmDataTermImportTemp[1] > estmDataTermImportTemp[2]) {
						cashChecked = 'checked';
						discountText = number_format(estmDataTermImportTemp[1]/10000);
						discountPrice = estmDataTermImportTemp[1]/10000;
					}
				} else {
					cashChecked = 'checked';
				}
				
				cashTxt += "<div class='imported-discount__choice'>\
					<input type='checkbox' name='discountCashCheck_" + codeT + "C' id='discountCashCheck_" + codeT + "C' " + cashChecked + " data-price='" + estmDataTermImportTemp[1]/10000 +"'>\
					<label for='discountCashCheck_" + codeT + "C'>현금/타금융 이용 시 할인</label>\
					<div class='imported-discount__check'><span class='icon__check'></span></div>\
					<div class='imported-discount__wrap'>\
                    	<div class='imported-discount__info'><span class='text__info'>현금/타금융 이용 시 할인</span><a href='javascript:void(0)' class='g-btn__help eFincPopup on' kind='dictionary' val='471'>도움말</a></div>\
                    	<div class='imported-discount__price'><span class='text__price'>-" + number_format(estmDataTermImportTemp[1]/10000) + "만 원</span></div>\
					</div>\
				</div>";
			}
			
			var hightrimPriceClass = '';
			var hightrimOriPriceClass = '';

			if(trimPrice != null && trimPrice != "") {
				//할인전 가격
				var repTrimPrice = Number(trimPrice.replace(',', ''));
				
				if(repTrimPrice >= 10000) {
					var backPrcie = trimPrice.slice(-5);
					var frontPrcie = trimPrice.replace(backPrcie, '');
					
					hightrimOriPriceClass = frontPrcie +"억" + backPrcie + "만 원";
				} else {
					hightrimOriPriceClass = trimPrice+"만 원";
				}
				
				//수입차 할인후 가격
				
				var trimDiscountPrice = repTrimPrice - discountPrice;
				if(trimDiscountPrice >= 10000) {
					trimDiscountPrice = trimDiscountPrice.toString();
					var backPrice = trimDiscountPrice.toString().slice(-4);
					var frontPrice = trimDiscountPrice.replace(backPrice, '');
					
					hightrimPriceClass = "<span class='num'>"+ frontPrice +"억 " + number_format(backPrice) + "</span>만 원";
				} else {
					hightrimPriceClass = "<span class='num'>"+number_format(trimDiscountPrice)+"</span>만 원";
				}
			}
			
			var boxSubSidly = '';
			if(subsidyTrimsClass != '') {
				boxSubSidly = "<div class='box__subsidy choice__price--subsidy'><span class='text__subsidy'></span></div>";
			}
			
			txt += "<div class='choice-toggle choice-toggle--" + toggleClass + "'>\
					    <input type='radio' name='eChkTrim_" + eNo + "' id='trim_"+eNo+tmp2[0].substring(12)+"' "+eCkd+" code='" + tmp2[0] + "'>\
					    <div class='choice-toggle__header'>\
							<label for='trim_"+eNo+tmp2[0].substring(12)+"'>"+tmp2[1]+" "+tmp2[2]+"</label>\
							<div class='choice__check'><span class='icon_check'></span></div>\
							<div class='choice__wrap " + subsidyTrimsMobileChoicePriceClass + "'>\
							    <div class='choice__cell choice__info'><span class='txt'>"+tmp2[1]+" "+tmp2[2]+"</span><div class='label_area'>"+trimsAddInfo+"</div></div>\
							    <div class='choice__cell choice__price'>\
									<div class='box__price'>\
									    <div class='box__left'><span class='text__discount'>-" + discountText + "만 원</span><a href='javascript:void(0)' class='g-btn__help eFincPopup on' kind='dictionary' val='472'>도움말</a></div>\
									    <div class='box__right'><span class='discount' data-price='" + Number(trimPrice.replace(',', '')) +"'>" + hightrimOriPriceClass +"</span><span class='txt'>" + hightrimPriceClass +  "</span></div>\
									</div>\
									" + boxSubSidly + "\
							    </div>\
						     </div>\
					    </div>\
					    <div class='choice-toggle__cont'>\
							<div class='imported-discount'>\
								" + financeTxt + "\
							    " + cashTxt + "\
							</div>\
					    </div>\
					 </div>";
			
		} else if(brand >= 340 && bExistsImportBenefitAdditional == true) {
			existBenefit = true;
			var toggleClass = 'close'
				
			if(eCkd == 'checked') {
				checkedTrim = codeT;
				toggleClass = 'open'
			}
			
			var financeTxt = '';
			var cashTxt = '';
			var tmpName = setTrms.name.split("`");;
			var discountText = '';
			var discountPrice = 0;
			
			if(estmDataTermImportTemp[3] != '') {
				financeTxt += "<div class='imported-discount__choice imported-discount__choice--exec'>\
					<input type='checkbox' name='discountFinanceCheck_" + codeT + "F' id='discountFinanceCheck_" + codeT + "F' " + financeChecked +" data-price='" + estmDataTermImportTemp[2]/10000 +"'>\
					<label for='discountFinanceCheck_" + codeT + "F'>" + tmpName[0] + " 파이낸스 이용 시 할인</label>\
					<div class='imported-discount__check'><span class='icon__check'></span></div>\
					<div class='imported-discount__wrap'>\
                    	<div class='imported-discount__info'><span class='text__info'>" + tmpName[0] + " 파이낸스 이용 시 할인</span><a href='javascript:void(0)' class='g-btn__help eFincPopup on' kind='dictionary' val='470'>도움말</a></div>\
                    	<div class='imported-discount__price'><span class='text__price'>" + estmDataTermImportTemp[3] + "</span></div>\
					</div>\
				</div>";
			}
			
			if(estmDataTermImportTemp[4] != '') {
				cashTxt += "<div class='imported-discount__choice imported-discount__choice--exec'>\
					<input type='checkbox' name='discountCashCheck_" + codeT + "C' id='discountCashCheck_" + codeT + "C' " + cashChecked + " data-price='" + estmDataTermImportTemp[1]/10000 +"'>\
					<label for='discountCashCheck_" + codeT + "C'>현금/타금융 이용 시 할인</label>\
					<div class='imported-discount__check'><span class='icon__check'></span></div>\
					<div class='imported-discount__wrap'>\
                    	<div class='imported-discount__info'><span class='text__info'>현금/타금융 이용 시 할인</span><a href='javascript:void(0)' class='g-btn__help eFincPopup on' kind='dictionary' val='471'>도움말</a></div>\
                    	<div class='imported-discount__price'><span class='text__price'>" + estmDataTermImportTemp[4] + "</span></div>\
					</div>\
				</div>";
			}
			
			var boxSubSidly = '';
			if(subsidyTrimsClass != '') {
				boxSubSidly = "<div class='box__subsidy choice__price--subsidy'><span class='text__subsidy'></span></div>";
			}
			
			txt += "<div class='choice-toggle choice-toggle--" + toggleClass + "'>\
					    <input type='radio' name='eChkTrim_" + eNo + "' id='trim_"+eNo+tmp2[0].substring(12)+"' "+eCkd+" code='" + tmp2[0] + "'>\
					    <div class='choice-toggle__header'>\
							<label for='trim_"+eNo+tmp2[0].substring(12)+"'>"+tmp2[1]+" "+tmp2[2]+"</label>\
							<div class='choice__check'><span class='icon_check'></span></div>\
							<div class='choice__wrap " + subsidyTrimsMobileChoicePriceClass + "'>\
							    <div class='choice__cell choice__info'><span class='txt'>"+tmp2[1]+" "+tmp2[2]+"</span><div class='label_area'>"+trimsAddInfo+"</div></div>\
							    <div class='choice__cell choice__price'>\
									<div class='box__price'>\
									    <div class='box__right'><span class='txt'>" + hightrimPriceClass +  "</span></div>\
									</div>\
									" + boxSubSidly + "\
							    </div>\
						     </div>\
					    </div>\
					    <div class='choice-toggle__cont'>\
							<div class='imported-discount'>\
								" + financeTxt + "\
							    " + cashTxt + "\
							</div>\
					    </div>\
					 </div>";
			
		} else {
			txt += "<div class='choice'>\
			            <input type='radio' name='eChkTrim_" + eNo + "' id='trim_"+eNo+tmp2[0].substring(12)+"' "+eCkd+" code='" + tmp2[0] + "'>\
			            <label for='trim_"+eNo+tmp2[0].substring(12)+"'>"+tmp2[1]+" "+tmp2[2]+"</label>\
			            <div class='choice__check'><span class='icon_check'></span></div>\
			            <div class='choice__wrap " + subsidyTrimsMobileChoicePriceClass + "'>\
			                <div class='choice__cell choice__info'><span class='txt'>"+tmp2[1]+" "+tmp2[2]+"</span><div class='label_area'>"+trimsAddInfo+"</div></div>\
			                <div class='choice__cell choice__price " + subsidyTrimsClass + "'><span class='txt'>"+ hightrimPriceClass +"</span>" + subsidyTrimsSpanTag + "</div>\
			            </div>\
			        </div>";
		}
		
		ct ++;
	}
	
	if (txt) txt += "</div>";
	
	$("#eDiv_" + eNo + " .eTrimBox").html(txt);
	
	$(function() {
		if(brand >= 340 && bExistsImportBenefit == true) {
			$('div.eChkTrimList div.choice-toggle--open div.imported-discount__choice input').each(function() {
				if($(this).prop('checked')) {
					$(this).trigger('click');
					$('#' + $(this).attr('id')).prop('checked', true);
				}
			});
		}

		// 전기차 총주행거리순 
		if (setTrms.fuel == 'E' || setTrms.fuel == 'H') {
			getTotalDistance(valCode.trms);
		}	
		else {
			$("#totalDistance").remove();
		}
	});
	
	$(document).on("click", "div.imported-discount__choice input[id^=discountFinanceCheck_]", function(){
		var currentId = $(this).attr('id').split('_')[1];
		var opositId = currentId.replace('F', 'C');
		
		if(!$(this).prop('checked')) {
			$('#discountFinanceCheck_' + currentId).prop('checked', true);
		} else {
			$("#discountCashCheck_" + opositId).prop('checked', false);
			$("#term_1" + currentId).trigger('click');
			
			if($(this).parent().hasClass('imported-discount__choice--exec')) {
				return;
			}
			var term = $("#term_1" + currentId).attr('code');
			var currentTrimId = currentId.replace('F', '');
			var eChkTrimDiscountPrice = Number($('#trim_1' + currentTrimId).parent().find('span.discount').data('price'));
			var currentDiscountPrice = $(this).data('price');
			var nextDiscountPrice = eChkTrimDiscountPrice - currentDiscountPrice;
			
			var subsidyPriceObj = $('#trim_1' + currentTrimId).parent().find('span.text__subsidy');
			var subPrice = 0; 
			if(subsidyPriceObj.length > 0) {
				var subsidyPriceText = subsidyPriceObj.text().replace('보조금 적용 시 ', '');
				subsidyPriceText = subsidyPriceText.replace('만 원', '');
				subsidyPriceText = subsidyPriceText.replace(',', '');
				subsidyPriceText = Number(subsidyPriceText);
				
				var tempDiscountText = $('#trim_1' + currentTrimId).parent().find('div.box__right span.num').text();
				tempDiscountText = tempDiscountText.replace(',', '');
				tempDiscountText = Number(tempDiscountText.replace('만원', ''));
				subPrice = tempDiscountText - subsidyPriceText;
			}
			var nextDiscountText = nextDiscountPrice;
			if(nextDiscountPrice > 10000) {
				var backPrice = nextDiscountPrice.toString().slice(-4);
				var frontPrice = nextDiscountPrice.toString().replace(backPrice, '');
				
				nextDiscountText = frontPrice + '억 ' + number_format(Number(backPrice));
			} else {
				nextDiscountText = number_format(nextDiscountPrice);
			}
			
			$('#trim_1' + currentTrimId).parent().find('span.text__discount').text('-' + number_format(currentDiscountPrice) + '만 원');
			$('#trim_1' + currentTrimId).parent().find('div.box__right span.num').text(nextDiscountText);
			
			if(subPrice > 0) {
				var subPriceText = '보조금 적용 시 ' + number_format(nextDiscountPrice - subPrice) + '만 원';
				subsidyPriceObj.text(subPriceText);
			}
			
			calculate("term",term);
		}
	});
	
	$(document).on("click", "div.imported-discount__choice input[id^=discountCashCheck_]", function(){
		var currentId = $(this).attr('id').split('_')[1];
		var opositId = currentId.replace('C', 'F');
		
		if(!$(this).prop('checked')) {
			$('#discountCashCheck_' + currentId).prop('checked', true);
		} else {
			$("#discountFinanceCheck_" + opositId).prop('checked', false);
			$("#term_1" + currentId).trigger('click');
			
			if($(this).parent().hasClass('imported-discount__choice--exec')) {
				return;
			}
			
			var term = $("#term_1" + currentId).attr('code');
			var currentTrimId = currentId.replace('C', '');
			
			var eChkTrimDiscountPrice = Number($('#trim_1' + currentTrimId).parent().find('span.discount').data('price'));
			var currentDiscountPrice = $(this).data('price');
			var nextDiscountPrice = eChkTrimDiscountPrice - currentDiscountPrice;
			
			var subsidyPriceObj = $('#trim_1' + currentTrimId).parent().find('span.text__subsidy');
			var subPrice = 0; 
			if(subsidyPriceObj.length > 0) {
				var subsidyPriceText = subsidyPriceObj.text().replace('보조금 적용 시 ', '');
				subsidyPriceText = subsidyPriceText.replace('만 원', '');
				subsidyPriceText = subsidyPriceText.replace(',', '');
				subsidyPriceText = Number(subsidyPriceText);
				
				var tempDiscountText = $('#trim_1' + currentTrimId).parent().find('div.box__right span.num').text();
				tempDiscountText = tempDiscountText.replace(',', '');
				tempDiscountText = Number(tempDiscountText.replace('만원', ''));
				subPrice = tempDiscountText - subsidyPriceText;
			}
			
			var nextDiscountText = nextDiscountPrice;
			if(nextDiscountPrice > 10000) {
				var backPrice = nextDiscountPrice.toString().slice(-4);
				var frontPrice = nextDiscountPrice.toString().replace(backPrice, '');
				
				nextDiscountText = frontPrice + '억 ' + number_format(Number(backPrice));
			} else {
				nextDiscountText = number_format(nextDiscountPrice);
			}
			
			$('#trim_1' + currentTrimId).parent().find('span.text__discount').text('-' + number_format(currentDiscountPrice) + '만 원');
			$('#trim_1' + currentTrimId).parent().find('div.box__right span.num').text(nextDiscountText);
			
			if(subPrice > 0) {
				var subPriceText = '보조금 적용 시 ' + number_format(nextDiscountPrice - subPrice) + '만 원';
				subsidyPriceObj.text(subPriceText);
			}
			
			calculate("term",term);
		}
	});
	
	if($('div.eChkTrimList div.article-box__cont input[name^="discountFinanceCheck"]').length > 0 || 
			$('div.eChkTrimList div.article-box__cont input[name^="discountCashCheck"]').length > 0) {
		$('.estimate__cont.eChkTermList').hide();
	}
	
	var lineupCount = 0;
	var selectedElement;
	
	$.each($("#eDiv_" + eNo + " .eTrimBox .eChkTrimList"), function() {
		var code = $(this).attr('code');
		
		$(this).removeClass('article-box--open');
		$(this).removeClass('article-box--close');
		
		// 선택트림 없으면
		if (rsltCode[eNo] == 0) {

			if (lineupCount > 0) {
				$(this).addClass('article-box--close');
			}
			else {
				$(this).addClass('article-box--open');
			}
		}
		// 선택트림 있으면
		else {

			if (code == lineCkd) {
				$(this).addClass('article-box--open');
			}
			else {
				$(this).addClass('article-box--close');
			}
		}
		
		lineupCount++;
	});

	var offsetStr = $("#eDiv_" + eNo + " .eTrimBox input[code=" + trimChecked + "]").position().top - 38;

	$("#eDiv_" + eNo + " .eTrimBox").animate({scrollTop:offsetStr}, 500);
	
	// 트림 선택 확인 및 표시
	rsltCode[eNo] = $("#eDiv_" + eNo + " .eChkTrimList input[type='radio']:checked").attr("code");
}

function itemPriceSpec() {
	$("input[id^='trim_']").each(function(index, item) {
		if($(this).is(':checked')) {
			var lineup = $(this).attr('code').substring(7,12);
			var str = dnw_deChar2(estmDataAuto["L"+lineup]);
			dnw_array2(str, "setLine");
			
			var buttonTemplate = '';
			if((setLine.conv.indexOf("P") > -1) || (setLine.conv.indexOf("S") > -1) || (setLine.conv.indexOf("I") > -1)) {
				buttonTemplate = '<a href="javascript:void(0)" class="sendGA btn-white itemPriceSpecBtn" cont="price" data-actionlabel="플로팅`가격제원사양">가격·제원·사양</a>';
			}
			
			$(".itemPriceSpecBtn").remove();
			$(".buttonSection").prepend(buttonTemplate);
		}
	});
}

//캐시백 계산
function calculate_cashback (cash,kind) {	
	var txt = "";
	var cashPrice = $("#compSelCashCaps").val() * 10000; 

	if($('.eRsltListCashback input[name="lumpsum"]:checked').val()) {
		var tempArr = $('.eRsltListCashback input[name="lumpsum"]:checked').val().split(":");
		price.cashback = tempArr[0];
		price.cashbackR = tempArr[1];		
	} 

	for (var key in estmDataCash) {
		setCash=new Array();
		cardComp = new Array();
		var odrCt = 100000000;

		for (var key in estmDataCash) {
			var str = dnw_deChar2(estmDataCash[key]);
			var back = 0;
			dnw_array2(str,"setCash");
			var cardArr = setCash.cashback.split("|");
			if(!cardArr[1]){
				cardVal = parseFloat(setCash.cashback);
			}else{
				if(cash>50000000) cardVal = parseFloat(cardArr[3]);
				else if(cash>=20000000) cardVal = parseFloat(cardArr[2]);
				else if(cash>=10000000) cardVal = parseFloat(cardArr[1]);
				else if(cash>=5000000)  cardVal = parseFloat(cardArr[0]);
				else if(setCash.no == '1723' && cash>=1000000) cardVal = parseFloat(cardArr[0]);
				else cardVal = 0;
				
				// 삼성카드 캐시백
				if (setCash.no == '1723') {
					// 테슬라 
					if (brnd == 611) { 
						cardVal = "1.0";
						
						if (cash>=20000000) {
							cardVal = "1.2";
						}
					// 캐스퍼
					} else if(model == 4086) {
						cardVal = "1.7";
						
						if (cash>=20000000) {
							cardVal = "2.2";
						}
					} 
				} else if(setCash.no == '1721') {
                    if(cash >= 50000000) {
                        cardVal = "1.5";
	                } else if(cash >= 40000000 && cash < 50000000) {
	                	cardVal = "1.5";	                	
	                } else if(cash >= 30000000 && cash < 40000000) {
	                	cardVal = "1.5";
	                } else if(cash >= 20000000 && cash < 30000000) {
	                	cardVal = "1.5";
	                } else if(cash >= 10000000 && cash < 20000000) {
	                	cardVal = "1.1";
	                } else if(cash < 10000000) {
	                	cardVal = "1.0";
	                }
				} else if(setCash.no == '1724') {
					if(cash >= 30000000) {
                        cardVal = "1.5";						
					} else if(cash >= 3000000 && cash < 30000000) {
						cardVal = "1.4";
					}					
				}
			}
			back = number_round(cash * cardVal / 100,10,'floor');
			if(key==0){
				if(kind=="finc"){
					fince.cashback = back;
					fince.cashbackR = cardVal;
					return false;
				}
			}
			var backVal = "a"+parseInt(back+odrCt)+":"+setCash.no+":"+back+":"+cardVal+":"+setCash.card+":"+setCash.cashback+":"+setCash.remark+":"+setCash.other+":"+setCash.capital + ":" + encodeURIComponent(setCash.memo);
			cardComp[key] = backVal; 
		}
		
		var txt = "";

		var minPrice = 1000000000;
		for (var key in estmDataCash) {
			tmp = cardComp[key].split(":");
			if(minPrice > (price.total + entry.total - tmp[2])) {
				minPrice = (price.total + entry.total - tmp[2]);
			}
		}

		for (var key in estmDataCash) {
			tmp = cardComp[key].split(":");
			cashBackArray = tmp[5].split("|");
            if(tmp[1] == '1721') {
            	cashBackArray = [1.0, 1.1, 1.5, 1.5, 1.5, 1.5];
            } else if(tmp[1] == '1724') {
				cashBackArray = [1.4, 1.5];
			}		
			var backVal = parseInt(tmp[2]);
			
			var ad = '';
			var request = '';
			
			if(key == 0) {
				request =
				'<button type="button" title="상담신청" class="btn_counsel"><a href="/newcar/?Work=cash">상담신청</a></button>';
				
			}
			if(minPrice == (price.total + entry.total - tmp[2])) {
				minEffect = 'lowest';
			}
			else {
				minEffect = '';
			}
			
			var cashBackList = "<dl class='info'><dt class='left'>카드 결제금액</dt><dd class='right'>체크카드 제외</dd></dl>";
			var cashBackScope = new Array('500만원 이상 ~ 1,000만원 미만', '1,000만원 이상 ~ 2,000만원 미만', '2,000만원 이상 ~ 5,000만원 미만', '5,000만원 이상');
			var cashBackPriceScope = new Array(5000000, 10000000, 20000000, 50000000, 5000000000);
			var num = 4;
            if(tmp[1] == '1721') {
                cashBackScope = ['1,000만원 미만', '1,000만원 이상 ~ 2,000만원 미만', '2,000만원 이상 ~ 3,000만원 미만', '3,000만원 이상 ~ 4,000만원 미만', '4,000만원 이상 ~ 5,000만원 미만', '5,000만원 이상'];
                cashBackPriceScope = [1000000000, 2000000000, 3000000000, 4000000000, 5000000000];
                num = 6;
            } else if(tmp[1] == '1724') {
                cashBackScope = ['300만원 이상 ~ 3,000만원 미만', '3,000만원 이상'];
                cashBackPriceScope = [3000000, 30000000];
                num = 2;            	
            }
			
			for(var a = 0 ; a < num ; a++) {
				var cashChoic = '';
				var cashChoiceMobile = '';
				if(cashBackPriceScope[a] < cashPrice && cashPrice < cashBackPriceScope[a+1]) {
					cashChoic = 'txt_lower';
					cashChoiceMobile = 'blue';
				}
				
				if(tmp[4] == '삼성카드') {
					cashBackScope[0] = '100만원 이상 ~ 1,000만원 미만';
				}
				
				cashBackList += "<dl class='info'><dt class='left'>"+cashBackScope[a]+"</dt><dd class='right'>"+parseFloat(cashBackArray[a]).toFixed(2)+"</dd></dl>";
			}
			
			var eventButton = '';
			var linkURL = '';
			var adInfoText = '';
			
			if(tmp[1] == '1722') {
				linkURL = "//mycar.shinhancard.com/conts/html/auto/new/domestic/ADPFM111R21.html";
				
				eventButton = "<div class='finance__btn'>\
									<a href='"+linkURL+"' target='_blank' class='btn-estm'>신한카드 마이카 신청</a>\
								</div>";
				
			}
			// 삼성카드 일시불
			else if(tmp[1] == '1723') {
				var brnd = valCode.brnd;
				var model = valCode.modl;
				
				if(valCode.brnd=="316") {
					brnd = 312;
				}
				else if (valCode.brnd=="322") {
					brnd = 321;
				}
				
				linkURL = "//directauto.samsungcard.com/oap/product/UOAPFP0112M0.jsp?cmpid=PADANCONT2NCA000001&newwindow=2";
				
				var now = new Date();
				var todayDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
				var compareDate = new Date("09/01/2021");
				
				// 테슬라 
				if (brnd == 611) { 
					linkURL = "/newcar/?Work=cash";
				// 캐스퍼
				} else if(model == 4086) {
					linkURL = '/event/?Tab=event&Work=detail&Stab=ing&no=3431413&reply=3431413&Page=1';
				} 
				
				eventButton = "<div class='finance__btn'>\
									<a href='"+linkURL+"' target='_blank' class='btn-estm'>오토캐시백 신청</a>\
								</div>";
			}
			// 하나카드 일시불
			else if(tmp[1] == '1724') {
				linkURL = "/newcar/?Work=cash&Tab=hana&newwindow=2";
				
				eventButton = "<div class='finance__btn'>\
									<a href='"+linkURL+"' target='_blank' class='btn-estm'>오토캐시백 신청</a>\
								</div>";
			}
            else if(tmp[1] == '1721') {
                linkURL = "/newcar/?Work=cash&Tab=lotte&newwindow=2";
                eventButton = "<div class='finance__btn'>\
                                        <a href='"+linkURL+"' target='_blank' class='btn-estm'>오토캐시백 신청</a>\
                                </div>";
            }			

			// memo
			var memo = '';
			
			if (decodeURIComponent(tmp[9])) {
				memo = "<div class='finance__cont'>"+decodeURIComponent(tmp[9])+"</div>";
			}

			var index = 0;
			
			if($(".eRsltListCashback").children('li.on').index() >= 0) {
				index = $(".eRsltListCashback").children('li.on').index() - 1;
			}
			
			var checked = '' ;
			var on = (key == index) ? 'on' : '' ;
			
			if (key == index) {
				checked = 'checked';
			}
			
			if (linkURL) {
				linkURL = "<div class='estimate-pay__apply'>\
					            <a href='"+linkURL+"' target='_blank' class='sendGA btn-apply' data-actionlabel='일시불 신청`클릭'>자세히 보기</a>\
					        </div>";
			}
			
			txt += "<div class='choice choice-pay'>\
	                    <input type='radio' "+checked+" name='lumpsum' value='"+ tmp[2] + ":" + tmp[3] +"' id='cashList_"+key+"'>\
	                    <label for='cashList_"+key+"'>"+tmp[4]+"</label>\
	                    <div class='choice__check'><span class='icon_check'></span></div>\
	                    <div class='choice__wrap'>\
	                        <div class='choice__cell choice__info'>"+ad+"<span class='txt'>"+tmp[4]+"</span><a href='javascript:void(0)' class='sendGA g-btn__help' data-actionlabel='일시불상품 상세정보`클릭'>도움말</a></div>\
	                        <div class='choice__cell choice__price'><span class='txt'>캐시백 "+number_format(tmp[2])+"원</span><span class='subtxt'>("+parseFloat(tmp[3]).toFixed(2)+"%)</span></div>\
	                        "+adInfoText+"\
	                        <div class='choice__row choice-pay__apply'>\
							    <div class='choice__cell'>"+linkURL+"</div>\
						    </div>\
	                    </div>\
	                    <div class='infodetail off'>\
	                        <div class='finance__summary'>\
	                        <h2 class='title'>"+tmp[4]+"</h2>\
		                        "+cashBackList+"\
	                        </div>\
	                        "+memo+"\
	                        "+eventButton+"\
	                    </div>\
	                </div>";

		}
		
		$("#Finc_"+ebox+" .eRsltListCashback").html(txt);
	}
}

function calculate_sumry(){
	if(ftab=="CashS"){
		sumry.ext1T = "인 도 금";
		sumry.ext2T = "탁 송 료";
		
		if(codes.othr.indexOf("X")>=0){
			sumry.ext1P = price.total - sumry.sign - price.trns;
			sumry.ext2P = price.trns;
		}
		else{
			sumry.ext1P = price.total - sumry.sign;
			sumry.ext2P = "";
		}
		
		sumry.cost = price.total + entry.total;
		sumry.payM = 0;
		sumry.payEv = 0;
		sumry.payKd = "Cash";
		sumry.end = 0;
	}
	else if(ftab=="FincS"){
		sumry.ext1T = "인 도 금";
		sumry.ext2T = "탁 송 료";
		
		if(codes.othr.indexOf("X")>=0){
			sumry.ext1P = price.total - sumry.sign - price.trns - fince.cap;
			sumry.ext2P = price.trns;
		}
		else{
			sumry.ext1P = price.total - sumry.sign - fince.cap;
			sumry.ext2P = "";
		}
		
		sumry.indo = price.total - fince.cap;
		sumry.cost = price.total + entry.total - fince.cap;
		sumry.payM = parseInt(fince.cap) + fince.itrSum - fince.rem;
		sumry.payEv = parseInt(sumry.payM / fince.mon);
		sumry.payKd = "Finc";
		sumry.end = fince.rem;
	}
	else if(ftab=="LeasS"){
	}
	else if(ftab=="RentS"){
	}
	
	sumry.price = price.total;
	sumry.entry = entry.total;
	sumry.cash = price.total + entry.total;
	sumry.grand = price.total+entry.total+infos.total;
}

/* 탁송료 표시 */
// 2018.06.07 verere@danawa.com TUIX, TUON 옵션 선택에 따른 출고장 변화 
function viewTrnsCost (code, conf, eNo, option)
{
	if (conf) {
		tmp = conf.split(":");
		conf = tmp[1];
	}
	
	getHttprequest(webUrl + "/service/transForm.php?Code="+code+"&Conf="+conf+"&option="+option+"&carCode="+codes.code, "eViewTrnsCost");
}

/* 할부 기록 : 비교하기 */
function expression_fincC ()
{
	var txt = "";
	
	// 선택된 할부 상품
	fcod = $("#Finc_"+ebox+" .eRsltFincName").attr("fincNo");
		
	// 기간 원금 선택 구성
	$("#compSelFincMons option[value="+codes.mon+"]").prop('selected', true);

	// 총 금액 (초기값)
	if (!hasFincCNoAdChange) {
		$("#compSelFincCaps").val(number_round((price.total - price.trns), 10000, 'floor') / 10000);
	}
	else {
		$("#compSelFincCaps").val(fince.cap / 10000);
	}
	
	compP = 0;
	compR = 0;
	compI = 0;
	
	// 매칭 비교..
	var txtO = "";
	
	i=1;

	// advertise finance
	// 2018.07.30 verere@danawa.com 삼성카드 다이렉트 카드할부 추가 및 광고 노출 비율 조정. 삼성카드 다이렉트 카드할부:삼성카드 다이렉트 오토할부:신한카드 오토 다이렉트 할부 = 1:1:2
	// 2018.03.12 verere@danawa.com 신한카드의 경우 같은 그룹군 우선 선택. 없을시 랜덤 노출 
	// 2018.03.02 verere@danawa.com 신차견적 구매요약 내 할부원금 변경시 광고상품 유지 기능 추가
	// 2018.02.28 verere@danawa.com 신한카드 광고 추가 및 광고상품 랜덤 노출
	var adFinanceKeyArray = new Array();
	var adFinanceArray = new Array();
	
	// 2018.10.29 AD노출 상품 변경
	var now = new Date();
	var todayDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());

	if (todayDate.getTime() >= new Date("11/05/2018").getTime()) {		
		for (var r in fincCompO) {
			tmp = fincCompO[r].split(":");
			fno = tmp[1];
			
			if (tmp[2] == "Y") { // AD뱃지 노출
				adFinanceKeyArray.push(fno);
				
				txtO += expression_fincC_detail(fno,"AD");
			}
			else {
				txtO += expression_fincC_detail(fno,"O");
			}
		}
		
		txtO += "<div class='choice choice-pay choice-pay--exce'>\
				    <input type='radio' name='financeSel' id='PUTFINCJ0' setFinc='"+ fince.mon+":"+fince.cap +"' data-rate='0'>\
				    <label for='PUTFINCJ0'>선택안함</label>\
				    <div class='choice__check'><span class='icon_check'></span></div>\
				    <div class='choice__wrap'>\
				        <div class='choice__cell choice__info'><span class='txt'>선택안함</span></div>\
				    </div>\
				    <div class='ratetip_layer' id='addBenefitLayer' style='display:none;'>\
                        <p class='txt'>추가혜택이 제공되는 <br> <strong class='point'>위 금융 상품을 확인</strong>해보세요.</p>\
                        <a href='javascript:void(0);' id='addBenefitLayerCloseBtn' class='btn_tt_close'><span class='ico_blog'>레이어 닫기</span></a>\
                    </div>\
				</div>";
	}
	else {
		
	}	

	adFinenceSelectPosition = Math.random() * adFinanceKeyArray.length;
	adFinenceSelectPosition = Math.floor(adFinenceSelectPosition);

	if (adFinanceKeyArray[adFinenceSelectPosition]) {
		
		fcod = adFinanceKeyArray[adFinenceSelectPosition];

		if (hasFincCNoAdChange) {
			hasFincCNoAdChange = false;
			fcod = selectedAdFincCNo;
		}
		else {
			selectedAdFincCNo = fcod;
		}
	}

	// 비매칭 비교..
	var txtX = "";
	
	fincCompX.sort(
		function( a, b ) {
			if ( a === b ) return 0; // a and b are equal
			
			if ( a < b ) return -1; // a is less than b, b comes first
			else return 1; // a is greater than b, a comes first
		}
	);
	
	i=1;
	
	for (var r in fincCompX) {
		tmp = fincCompX[r].split(":");
		fno = tmp[1];
		txtX += expression_fincC_detail(fno,"X");
	}
	
	if (mobile) {
		var txt = '';
	}
	else {
		var txt = "";		
	}

	$("#result_finance").html(txt + txtO + txtX);
	
	/*ad상품 노출 랜덤*/
	if ($("#PUTFINCJ" + fcod).length) {
		$("#result_finance").prepend($("#PUTFINCJ" + fcod).parent())
	}
	else {
		//$("#result_finance [id ^= 'PUTFINCJ']:eq(0)").click();
	}
}

/* 할부 비교 표시 정보 만들기 */
function expression_fincC_detail (no, kd)
{
	var str = "";
	
	tmpArr = rsltFinc[no].split("#");
	tmpCt = tmpArr.length;
	fince = new Array();
	
	for (t = 0; t < tmpCt - 1; t++) {
		tmpArr2 = tmpArr[t].split("^");
		fince[tmpArr2[0].substring(tmpArr2[0].indexOf("_")+1)] = tmpArr2[1];
	}

	var gapR = "";
	var gapP = "";
	var gapI = "";
	
	var ad = '';
	var adButton = linkURL = '';
	var adver = '';
	
	//모바일 주유권
	var gasPrice = 0;
	
	var pcMobileType = '';
	
	if (mobile) {
		pcMobileType = '모바일';
	} else {
		pcMobileType = '웹';
	}
	
	if (fince.codeF == '104') {
		var brnd = valCode.brnd;
		
		// 한국GM 쉐보레로 통합 
		if (valCode.brnd == "316") {
			brnd = 312;	
		}
		else if (valCode.brnd == "322") {
			brnd = 321;	
		}

		adButton = "<div class='finance__btn'>\
						<a onclick=\"eval('try{ _trk_clickTrace( \\'EVT\\', \\'자동차_삼성카드 할부 버튼_견적 구매 방법("+pcMobileType+")\\' ); }catch(_e){ }');\" href='//directauto.samsungcard.com/oap/limit/UOAPLI0211M1.jsp?cmpid=PADANCONT2NIN000001&thgMnftCoC="+brnd+"&carModlC="+valCode.modl+"&trimC="+valCode.line+"&trimDtlC="+valCode.trms+"&newwindow=2' target='_blank' class='btn-estm'>다이렉트 오토할부 신청</a>\
					</div>";
		
		linkURL = "//directauto.samsungcard.com/oap/limit/UOAPLI0211M1.jsp?cmpid=PADANCONT2NIN000001&thgMnftCoC="+brnd+"&carModlC="+valCode.modl+"&trimC="+valCode.line+"&trimDtlC="+valCode.trms;
	
	} else if (fince.codeF == '356' || fince.codeF == '357') {

		adButton = "<div class='finance__btn'>\
						<a href='//www.samsungfire.com/sfmi/ui/wshomepage/loan/provision/purchase/CN_loan_car_agree.jsp?FECP=e2016009_001_0001' target='_blank' class='btn-estm'>애니카 자동차 대출 신청</a>\
					</div>";
		
		linkURL = "//www.samsungfire.com/sfmi/ui/wshomepage/loan/provision/purchase/CN_loan_car_agree.jsp?FECP=e2016009_001_0001";
	
	} else if (fince.codeF == '418') {

		adButton = "<div class='finance__btn'>\
						<a href='//db.blueweb.co.kr/formmail/Newformmail_plus.html?dataname=itools7' target='_blank' class='btn-estm'>다이렉트 오토론 신청</a>\
					</div>";
		
		linkURL = "//db.blueweb.co.kr/formmail/Newformmail_plus.html?dataname=itools7";
	
	} else if (fince.codeF == '436' || fince.codeF == '451') {
		
		var brnd = valCode.brnd;

		// 제네시스 현대로 통합
		if (valCode.brnd == "304") {
			brnd = 303;	
		}
		
		adButton = "<div class='finance__btn'>\
					    <a href='https://mycar.shinhancard.com/adp/ADPFM001N/ADPFM001R10.shc?LCD=H0012&newwindow=1' target='_blank' class='btn-estm'>마이카 할부 신청</a>\
					</div>";
		
		linkURL = "https://mycar.shinhancard.com/adp/ADPFM001N/ADPFM001R10.shc?LCD=H0012&newwindow=1";
		
		if (parseInt(fince.cap) >= 10000000 && valCode.brnd < 340) {
			gasPrice = 60000;
		}
		
	} else if (fince.codeF == '445') {	
	} else if (fince.codeF == '447') {
		if (mobile) {
			adButton = "<div class='finance__btn'>\
							<a href='//bit.ly/2LE5rRn' target='_blank' class='btn-estm'>매직카 대출 신청</a>\
						</div>";
			
			linkURL = "//bit.ly/2LE5rRn";
			
		} else {
			adButton = "<div class='finance__btn'>\
							<a href='//bit.ly/2sIozpu' target='_blank' class='btn-estm'>매직카 대출 신청</a>\
						</div>";
			
			linkURL = "//bit.ly/2sIozpu";
		}
		
	} else if (fince.codeF == '449') {
		var brnd = valCode.brnd;
		
		if (valCode.brnd == "316") {
			brnd = 312;
		} else if (valCode.brnd == "322") {
			brnd = 321;
		}

		adButton = "<div class='finance__btn'>\
						<a onclick=\"eval('try{ _trk_clickTrace( \\'EVT\\', \\'자동차_삼성카드 할부 버튼_견적 구매 방법("+pcMobileType+")\\' ); }catch(_e){ }');\" href='//directauto.samsungcard.com/oap/card-installment/UOAPNC0221M0.jsp?cmpid=PADANCONT2CIN000001&thgMnftCoC="+brnd+"&carModlC="+valCode.modl+"&trimC="+valCode.line+"&trimDtlC="+valCode.trms+"&newwindow=1' target='_blank' class='btn-estm'>다이렉트 카드할부 신청</a>\
					</div>";
		
		linkURL = "//directauto.samsungcard.com/oap/card-installment/UOAPNC0221M0.jsp?cmpid=PADANCONT2CIN000001&thgMnftCoC="+brnd+"&carModlC="+valCode.modl+"&trimC="+valCode.line+"&trimDtlC="+valCode.trms+"&newwindow=1";
	
	} else if (fince.codeF == '450') {
		// 하나은행 1Q 오토론
		var buttonType = '';
		
		if (mobile) {
			buttonType = 'link';
		} else {
			buttonType = 'counsel';
		}
		
		adButton = "<div class='finance__btn'>\
						<a href='//db.blueweb.co.kr/formmail/Newformmail_plus.html?dataname=itools7' target='_blank' class='btn-estm'>1Q 오토론 신청</a>\
					</div>";
		
		linkURL = "//db.blueweb.co.kr/formmail/Newformmail_plus.html?dataname=itools7";
		
	} else if (fince.codeF == '452') {
		linkURL = "/newcar/?Work=finance&Tab=hana";
	} else if (fince.codeF == '453' || fince.codeF == '454') {
		linkURL = "/newcar/?Work=finance&Tab=woori";
	} else if (fince.codeF == '455') {
		linkURL = "//directauto.samsungcard.com/oap/card-installment/UOAPNC0201M0.jsp?carModlC="+valCode.modl+"&cmpid=PADANCONT2CIN000001&newwindow=1&thgMnftCoC="+valCode.brnd+"&trimC="+valCode.line+"&trimDtlC="+valCode.trms+"#none";
	} else if (fince.codeF == '456') {
		linkURL = "//directauto.samsungcard.com/oap/limit/UOAPLI0201M1.jsp?carModlC="+valCode.modl+"&cmpid=PADANCONT2NIN000001&thgMnftCoC="+valCode.brnd+"&trimC="+valCode.line+"&trimDtlC="+valCode.trms+"#none";
	} else if (fince.codeF == '458') {
		linkURL = "//card.kbcard.com/CXPRIFICD0066.cms?withID=Danawa";
		if(mobile) {
			linkURL = "//m.kbcard.com/CXHIAFLSD0004.cms?withID=Danawa";
		}
	} else if (fince.codeF == '103') {
		linkURL = "/newcar/?Work=finance&Tab=lotte";
	}

	if (fince.preP) {
		var sum = parseInt(fince.cap) + parseInt(fince.itrSum) - (fince.lost * (-1)) - fince.back - gasPrice - fince.preP;
	}
	else {
		var sum = parseInt(fince.cap) + parseInt(fince.itrSum) - (fince.lost * (-1)) - fince.back - gasPrice;	
	}
	
	// fince.lost  + 이변 !표시  그리고 기본할인이 없어지는거
	var risk = '';
	
	if (fince.lost > 0) {
		if (mobile) {
			risk = '<em class="risk"></em>';
		}
		else {
			risk = '<em class="risk">!</em>';			
		}
	}
	
	// AD뱃지 노출
	if(fince.adBadge == 'Y') {
		adver = 'adver';
		ad = "<span class='g-label-ad'>AD</span>";
	}

	var explainText = '';
	
	if (estmDataFincExplain[fince.codeF] && estmDataFincExplain[fince.codeF] != '') {
		explainText = dnw_deChar2(estmDataFincExplain[fince.codeF]);
	}
	
	var toFixLength = ((fince.itr).length < 4) ? 2 :  (fince.itr).length - 2;

	if (kd == 'AD' || kd == "O") {
		str += "<div class='choice choice-pay' id=financeList_"+fince.codeF+">\
		            <input type='radio' name='financeSel' setFinc='"+ fince.mon+":"+fince.cap +"' id='PUTFINCJ"+ fince.codeF +"' data-rate="+parseFloat(fince.itr).toFixed(toFixLength)+">\
		            <label for='PUTFINCJ"+ fince.codeF +"'>"+fince.nameF + risk+"</label>\
		            <div class='choice__check'><span class='icon_check'></span></div>\
		            <div class='choice__wrap'>\
		                <div class='choice__cell choice__info'>"+ad+"<span class='txt'>"+fince.nameF+"</span><a href='javascript:void(0)' data-id='PUTFINCJ"+ fince.codeF +"' class='sendGA g-btn__help' data-actionlabel='할부상품 상세정보`광고상품O'>도움말</a></div>\
		                <div class='choice__cell choice__price'><span class='txt'>월 "+number_format(fince.payEv)+"원</span><span class='subtxt'>("+parseFloat(fince.itr).toFixed(toFixLength)+"%)</span></div>\
		                <div class='choice__row choice-pay__ad'>\
		                	<div class='choice__cell'>\
				                <div class='estimate-pay__ad'>\
				                	<div class='estimate-pay__ad-cont'>\
				                    	<div class='cont eRsltFincDiscount hide'></div>\
				                    	<div id=eRsltPrimeRate_"+fince.codeF+" class='cont hide'></div>\
			                    	</div>\
				                </div>\
		            		</div>\
		                </div>\
		                <div class='choice__row choice-pay__apply'>\
						    <div class='choice__cell'>\
						        <div class='estimate-pay__apply'>\
						            <a href='"+linkURL+"' target='_blank' class='btn-apply sendGA' data-actionlabel='할부 신청`"+fince.nameF+risk+"'>할부 신청</a>\
						        </div>\
						    </div>\
						</div>\
		            </div>\
			        <div class='infodetail off'>\
		                <div class='finance__summary'>\
		                	<h2 class='title'>"+fince.nameF+"</h2>\
		                    <dl class='info'><dt class='left'>월납입금</dt><dd class='right'>"+number_format(fince.payEv)+"원</dd></dl>\
		                    <dl class='info'><dt class='left'>적용금리</dt><dd class='right'>"+parseFloat(fince.itr).toFixed(2)+"% </dd></dl>\
		                    <dl class='info'><dt class='left'>총 이자</dt><dd class='right'>"+number_format(fince.itrSum)+"원</dd></dl>\
		                    <dl class='info'><dt class='left'>원리금 합계</dt><dd class='right eRsltFincGrand'>원</dd></dl>\
		                    <dl class='info'><dt class='left'>할인 혜택</dt><dd class='right eRsltFincDiscount'></dd></dl>\
		                </div>\
		                <div class='finance__cont'>"+explainText+"</div>\
		                "+adButton+"\
		            </div>\
		        </div>";
	}
	
	return str;
}

function codes_reset ()
{
	tmpConf = rsltConf[ebox].split("@");
	
	if (tmpConf[0]) {	// 옵션 선택 복원
		tmp = tmpConf[0].split(",");
		
		for (var key in tmp) {
			$("#Optn_"+ebox+" .eChkItemList li[code='"+tmp[key]+"']").addClass("sel");
			$("#Optn_"+ebox+" .eChkItemList input[code='"+tmp[key]+"']").prop("checked",true);
		}
	}
	
	if (tmpConf[1]) {	// 판매조건 선택 복원
		tmp = tmpConf[1].split(",");
		
		for (var key in tmp) {
			$("#eDiv_"+ebox+" .eChkTermList li[code='"+tmp[key]+"']").addClass("sel");
			$("#eDiv_"+ebox+" .eChkTermList li[code='"+tmp[key].substring(0,3)+"']").addClass("sel");
			$("#eDiv_"+ebox+" .eChkTermList input[code='"+tmp[key]+"']").prop("checked",true);
		}
	}
	
	if (tmpConf[2]) {	// 장애 선택 복원
		$("#eDiv_"+ebox+" .eSelFreeKind").val(tmpConf[2]);
	}
	
	if (tmpConf[3]) {	// 등록지역 복원
		$("#eDiv_"+ebox+" .eSelRegiSido").val(tmpConf[3]);
	}
	
	if (tmpConf[4] && tmpConf[4].indexOf("C") >= 0) {	// 다자녀 복원
		$("#eDiv_"+ebox+" .eChkRegiChild").prop("checked",true);
	}
	
	if (tmpConf[4] && tmpConf[4].indexOf("S") >= 0) {	// 계약금 수동입력
		$("#eDiv_"+ebox+" .eSelCostSign").val("self");
		$("#eDiv_"+ebox+" .ePutCostSign").val(copyData.sumry_sign);
		$("#eDiv_"+ebox+" .contCost .Sign .auto").addClass("dis");
		$("#eDiv_"+ebox+" .contCost .Sign .self").removeClass("dis");
	}
	
	if (tmpConf[4] && tmpConf[4].indexOf("X") >= 0) {	// 탁송료 분리
		$("#eDiv_"+ebox+" .eSelCostTrns").val("X");
	}
	
	if (tmpConf[5]) {
		var temp = tmpConf[5].split(":");
		
		$("#eDiv_"+ebox+" .btnTrnsView").attr("conf", tmpConf[5]);
		
		//브랜드마다 두번째 탭에서 완료되는 경우가 있음
		if (temp[1].substr(0, 3) == 'S00') {
			if (mobile) {
				$(window).load(function() {
					$("input[name='SETRNSKD']:eq(1)").trigger('click');
					
					//180704 모바일만 로딩속도로 인해 timeout설정
					setTimeout(function() {
						$("#SETRNSST option").each(function() {
							if (dnw_deChar2($(this).val()) == tmpConf[5]) {
								$(this).attr('selected','true');
							}
						});
					}, 800);
				});
			}
			else {
				$("input[name='SETRNSKD']:eq(1)").click();
				
				$("#SETRNSST option").each(function() {
					if (dnw_deChar2($(this).val()) == tmpConf[5]) {
						$(this).attr('selected','true');
					}
				});
			}
		}
		else {
			if (valCode.brnd == '326' || valCode.brnd == '321') {
				$("#SETRNSDO [value='"+ temp[1].substr(0,3) +"']").attr('selected','true');
				$("#SETRNSDO [value='"+ temp[1].substr(0,3) +"']").change();
				
				$("#SETRNSGU option").each(function(){
					if ($(this).val() != 0) {
						if (dnw_deChar2($(this).val()) == tmpConf[5]) {
							$(this).attr('selected', 'true');
						}						
					}
				});
			}
			else {
				if (mobile) {
					$(window).load(function() {
						$("#SETRNSDO [value='"+ temp[1].substr(0,3) +"']").attr('selected','true');
						$("#SETRNSDO [value='"+ temp[1].substr(0,3) +"']").change();
						
						//180704 모바일만 로딩속도로 인해 timeout설정
						setTimeout(function() {
							$("#SETRNSGU [value='"+ temp[1].split('site')[0] +"']").attr('selected','true');
							$("#SETRNSGU [value='"+ temp[1].split('site')[0] +"']").change();
						}, 200);
						
						setTimeout(function() {
							$("#SETRNSST option").each(function() {
								
								if (dnw_deChar2($(this).val()) == tmpConf[5]) {
									$(this).attr('selected','true');
								}
							});
						}, 600);	
					});
				}
				else {
					$("#SETRNSDO [value='"+ temp[1].substr(0,3) +"']").attr('selected','true');
					$("#SETRNSDO [value='"+ temp[1].substr(0,3) +"']").change();
					$("#SETRNSGU [value='"+ temp[1].split('site')[0] +"']").attr('selected','true');
					$("#SETRNSGU [value='"+ temp[1].split('site')[0] +"']").change();
					
					$("#SETRNSST option").each(function() {
						if (dnw_deChar2($(this).val()) == tmpConf[5]) {
							$(this).attr('selected','true');
						}
					});
				}
			}
		}
	}
}

/** 색상 정보 조회 **/
function setTrimColorInfo() {
	$.get(
			webUrl + "/service/ajax_trimsInfo.php",{
				type: 'estimateTrimsColorHtml',
				trimsNo: codes.code.substring(12)
			},
			function (data, status) {
				if (status == "success") {
					if(_.isEmpty(data)) {
						if(!$("#Optn_1 .eChkItemList").is(":visible")) {
							data = 	"<div class='article-box'>" +
										"<div class='estimate__blank'>색상과 옵션을 선택 할 수 없는 차량입니다.</div>" +
									"</div>";
							$("#eDiv_1 #estimateColorList").show();
						} else {
							$("#eDiv_1 #estimateColorList").hide();
						}
					} else {
						$("#eDiv_1 #estimateColorList").show();
					}
					
					$("#eDiv_1 #estimateColorList").html(data);
					
					var colorParam = "";
					var exteriorColorArray = "";
					var interiorColorArray = "";
					
					if(!_.isUndefined(rsltConf[ebox])) {
						var rsltConfArray = rsltConf[ebox].split("@");
						if(rsltConfArray.length >= 10) {
							colorParam = rsltConfArray[10];
							
							var colorParamArray = colorParam.split(",");
							if(colorParamArray.length >= 2) {
								exteriorColorArray = colorParamArray[0];
								exteriorColorArray = exteriorColorArray.split(":");
								
								interiorColorArray = colorParamArray[1];
								interiorColorArray = interiorColorArray.split(":");
							}
							
							if(Array.isArray(exteriorColorArray)) {
								exteriorColorArray.forEach(function(item){
									$("#estimateExteriorColorList .choice-color__item[color='"+item+"']").trigger("click");
								});
							}
							if(Array.isArray(interiorColorArray)) {
								interiorColorArray.forEach(function(item){
									$("#estimateInteriorColorList .choice-color__item[color='"+item+"']").trigger("click");
								});
							}
						}
					}
					
				}
			}
	);
}

$(function() {
	/* =세부모델 변경 */
	$(document).on("click","[name ^= 'eChkTrim_']",function(){
		ebox = '1';		
		code = $(this).attr("code");
		
		hasSpecialConsumptionTaxDiscounted = 0;

		var line = code.substring(7,12);
		var trms = code.substring(12);
		var lineO = rsltCode[ebox].substring(7,12);
		
//		var rTrimCount = $('div.choice-toggle--open input:radio').length;
//		if(rTrimCount > 1) {
//			$('div.choice-toggle--open input:radio').eq(1).prop('checked', true);
//			if(rTrimCount > 2) {
//				$('div.choice-toggle--open input:radio').eq(2).prop('checked', false);
//			}
//		}
		
		rsltCode[ebox] = code;
		
		if (lineInfo[line]['hasCatalog']) {
			$("#info_model a[cont='catalog']").css('display', '');
		}
		else {
			$("#info_model a[cont='catalog']").css('display', 'none');
		}
		
		$('div.eChkTrimList  div.choice-toggle--open').each(function() {
			$(this).removeClass('choice-toggle--open');
			$(this).addClass('choice-toggle--close');
		});
		
		if($(this).parent().hasClass('choice-toggle--close')) {
			$(this).parent().removeClass('choice-toggle--close');
			$(this).parent().addClass('choice-toggle--open');
		}
		
		if (line == lineO) {
			calculate("trms",trms);
		}
		else {
			var modelCode = code.substr(3, 4);
			var changePhoto = '';
			
			if (lineInfo[line]['photo']) {
				changePhoto = '//autoimg.danawa.com/photo/'+ modelCode +'/'+ lineInfo[line]['photo'] +'/lineup_360.png';
			}
			else {
				changePhoto = '//autoimg.danawa.com/photo/'+ modelCode +'/model_360.png';
			}
			
			$('#info_model .estimate-model__img img').attr('src', changePhoto);
			
			rsltConf[ebox] = "@@"+codes.free+"@"+codes.zone+"@"+codes.othr+"@"+codes.trns+"@"+codes.year+"@"+codes.mile+"@"+ftab+"@";
			
			calculate("line",trms);
		}
		
		itemPriceSpec();
		
		/** 모델 변경에 따른 탁송료 부분 설정 **/
		$("[name='SETRNSKD']:eq(0)").trigger("click");
		
		// 전기차 보조금 영역 노출여부
		if($("#Incnt_tab").length > 0 || (mobile)) { // 캐시 적용 문제로 보조금탭 있는지 우선체크
			if($("#trim_1"+ valCode.trms).parent().find("div.choice__price--subsidy").length > 0) {
				getHttprequestSync(webUrl + '/service/ajax_estimate_EVform.php?trims='+trms, 'Incnt_1');
				
				$("#Incnt_tab").removeClass("off"); // 보조금 탭
				$("#Incnt_1").removeClass("off"); // 보조금 혜택 선택 영역
				$("#Finc_1 .estimate__title .title").text("5. 결제방법 선택"); // 결제방법 영역 타이틀
				$("#info_summary .eIncentiveDiv").removeClass("off"); // 견적상세 보조금
				
				if(mobile) {
					$("#financialNumber").text("5");
				}
				
				var tmpSido = $("#selectEVSido").val();
				var tmpSigungu = $("#selectEVSigungu").val();
				
				if (!tmpSido && !tmpSigungu) {
					tmpSido = 'S20';
					tmpSigungu = '1';
				}

				$("#EVSidoSelect").val(tmpSido).trigger("change");
				$("#EVSigunguSelect").val(tmpSigungu).trigger("change");
				
				calculate('incnt', '');
			} else {
				$("#Incnt_tab").addClass("off");
				$("#Incnt_1").addClass("off");
				$("#Finc_1 .estimate__title .title").text("4. 결제방법 선택");
				$("#info_summary .eIncentiveDiv").addClass("off");
				
				if(mobile) {
					$("#financialNumber").text("4");
				}
			}
		}
		
		setTrimColorInfo();

		if($("#Optn_"+ebox + " .eChkItemList").is(":hidden")) {
			if($('div.eChkItemList input[id^="popupItem_"]').length > 0) {
				$("#Optn_"+ebox + " .eChkItemList").show();
			}
		}
		
		if($('div.eChkTrimList div.choice-toggle--open div.imported-discount__choice input').length > 0) {
			$('div.eChkTrimList div.choice-toggle--open div.imported-discount__choice input').each(function() {
				if($(this).prop('checked')) {
					$(this).trigger('click');
					$('#' + $(this).attr('id')).prop('checked', true);
				}
			});
		}
	
		// 총주행거리 추가
		if (setTrms.fuel == 'E' || setTrms.fuel == 'H') {
			getTotalDistance(valCode.trms);
		}	
		else {
			$("#totalDistance").remove();
		}
	});
	
	/*  =옵션 선택 : 견적  */
	$(document).on("click",".eChkItemList input",function(){
		ebox = '1';
		var itms = $(this).attr("code");
		var ckd = $(this).is(":checked");
		
		//items_check 계산하기위해 ebox 임시변환
		items_check(itms,ckd);	// 중복 제거, 의존 추가
		calculate("itms",itms);

		// 2018.06.07 verere@danawa.com TUIX, TUON 옵션 선택에 따른 출고장 변화 
		if ($(this).parent().find("label").text().indexOf("TUIX") != -1 || $(this).parent().find("label").text().indexOf("TUON") != -1 
				|| $(this).parent().find("label").text().indexOf("N퍼포먼스") != -1 || $(this).parent().find("label").text().indexOf("HGA") != -1
				|| $(this).parent().find("label").text().indexOf("KGA") != -1 || $(this).parent().find("label").text().indexOf("액세서리") != -1 || $(this).parent().find("label").text().indexOf("[") != -1) {
			$("[name='SETRNSKD']:eq(0)").trigger("click");
		}
		
		// 전기차 보조금>셀렉트박스 초기화
		if(($("#Incnt_tab").length > 0 && $("#trim_1"+ valCode.trms).siblings(".choice__wrap").children(".choice__price").hasClass("choice__price--subsidy")) 
		|| (mobile && $("#trim_1"+ valCode.trms).siblings(".choice__wrap").children(".choice__price").hasClass("choice__price--subsidy"))) {
			$('#EVSidoSelect>option').prop("selected", false);
			$('#EVSigunguSelect>option').prop("selected", false);
			$("#EVSigunguSelect").prev("label").removeClass("hide");
			
			// 기존에 눌렸던 지역으로 설정하기
			var tmpSido = $("#selectEVSido").val();
			var tmpSigungu = $("#selectEVSigungu").val();
			
			if (!tmpSido && !tmpSigungu) {
				tmpSido = 'S20';
				tmpSigungu = '1';
			}
			
			$("#EVSidoSelect").val(tmpSido).trigger("change");
			$("#EVSigunguSelect").val(tmpSigungu).trigger("change");
			
			calculate("incnt",itms);
		}
	});
	
	/* 판매조건 선택 */
	$(document).on("click",".eChkTermList input",function(){
		var term = $(this).attr("code");
		var ckd = $(this).is(":checked");
		if(ckd){
			terms_check(term);	// 중복체크
		}
		
		$(this).closest('li').addClass('sel');
		
		//제조사 할인 혜택 클릭시 국가 노후 경유차 세제혜택도 같이 선택
		if(term.indexOf('T99') >= 0) {
			oldCarSel = ckd;
			$("#Term_"+ebox+" .eOldCar input").attr('checked', oldCarSel);
		}		
		
		var termCode = term.substring(0,3);
		if(valCode.brnd > 340) {
			termCode = term;
		}
		
		if(ckd){
			$("#Term_"+ebox+" .eChkTermList li[code='"+termCode+"']").find('div').addClass("checked");
		}else{
			$("#Term_"+ebox+" .eChkTermList li[code='"+termCode+"']").find('div').removeClass("checked");
		}
		calculate("term",term);
	});
	
	/* 노후차 관련 설정 */
	$(document).on("click",".eOldCar input",function(){
		var eNo = '1';
		estmAct = eNo;
		ebox = estmAct;

		var term = $(this).attr("code");
		oldCarSel = $(this).is(":checked");
		
		$("#Term_"+ebox+" .eOldCar input").attr('checked' , oldCarSel);

		//자동체크 제조사 할인
		$("#Term_"+ebox+" .eChkTermList li[code='T990']").find('input').attr('checked' , oldCarSel);
		
		/* 중복 할인 제거*/
		$("#Term_"+ebox+" .eChkTermList li.sel input").each(function(){
			var termC = $(this).attr("code");
			
			if(termC != 'T990') {
				var temVal2 = setTermB[termC.substring(0,3)].split("`");
				
				if(temVal2[2] && temVal2[2].indexOf('Z')>=0){
					$("#Term_"+ebox+" .eChkTermList li[code='"+termC.substring(0,3)+"']").removeClass("sel");
					
					$(this).removeClass("sel");
					$(this).parent().removeClass("sel");
					$(this).prop("checked",false);
				}				
			}
		});
		
		calculate("term",term);
	});
	
	/* =면세 선택 */
	$(document).on("change",".eSelFreeKind",function(){
		var eNo = '1';
		
		estmAct = eNo;
		ebox = estmAct;
		calculate("free","");
		
		sendGA('면세조건 변경', $(this).find(":selected").text());
	});
	
	$(document).on("change",".eSelRegiSido",function(){
		var eNo = '1';
		
		estmAct = eNo;
		ebox = estmAct;
		calculate("enty","");

		sendGA('등록지역 변경', $(this).find(":selected").text());
	});
	
	/* 탁송 방법 선택 */
	// 2018.06.07 verere@danawa.com TUIX, TUON 옵션 선택에 따른 출고장 변화 
	$(document).on("click", "[name='SETRNSKD']", function() {
		var code = $("#eDiv_"+ebox+" .btnTrnsView").attr("code");
		var conf = $(this).val();
		var option = '';
		
		$("input[name='option']:checked").each(function (index, item) {
			
			// 관리자 페이지에서 추가된 출고장 옵션을 인식하기 위함
			var optionStr = $(this).parent().find("label").text();
			if ((optionStr.indexOf("[") != -1)) {
				var start = optionStr.indexOf('[') + 1;
				var end = optionStr.indexOf(']');
				var resultOption = optionStr.substring(start, end);
				
				if (resultOption != 'TUIX'&& resultOption != 'HGA' && resultOption != 'TUON' && resultOption != 'KGA' && resultOption != 'N퍼포먼스' && resultOption != '액세서리') {
					option = resultOption;
					return false;
				}
			}
			// ---

			if ($(this).parent().find("label").text().indexOf("TUIX") != -1) {
				option = 'TUIX';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("HGA") != -1) {
				option = 'HGA';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("TUON") != -1) {
				option = 'TUON';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("KGA") != -1) {
				option = 'KGA';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("N퍼포먼스") != -1) {
				option = 'NPPMS';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("액세서리") != -1) {
				option = 'ACC';
				return false;
			}
		});
		
		// 2018.07.11 탁송료 방법 선택시 초기화 추가
		$("#eDiv_"+ebox+" .ePutTrnsSelf").val(0);
		$("#eDiv_"+ebox+" .btnTrnsView").attr("conf", "");
		$("#eDiv_"+ebox+" .btnTrnsView").attr("title", "");
		
		calculate("trns", "");
		
		viewTrnsCost(code, conf, ebox, option);

		sendGAExcpt('견적페이지', '탁송_방법', $(this).parent().text());
	});
	
	
	// 탁송료 시도 선택	
	$(document).on("change","#SETRNSDO",function(e){
		tset = $(this).val();
		tcod = $("#SETRNSDO").attr("code");
		
		var option = '';		
		
		$("input[name='option']:checked").each(function (index, item) {
			
			// 관리자 페이지에서 추가된 출고장 옵션을 인식하기 위함
			var optionStr = $(this).parent().find("label").text();
			if ((optionStr.indexOf("[") != -1)) {
				var start = optionStr.indexOf('[') + 1;
				var end = optionStr.indexOf(']');
				var resultOption = optionStr.substring(start, end);
				
				if (resultOption != 'TUIX'&& resultOption != 'HGA' && resultOption != 'TUON' && resultOption != 'KGA' && resultOption != 'N퍼포먼스' && resultOption != '액세서리') {
					option = resultOption;
					return false;
				}
			}
			// ---
			
			if ($(this).parent().find("label").text().indexOf("TUIX") != -1) {
				option = 'TUIX';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("HGA") != -1) {
				option = 'HGA';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("TUON") != -1) {
				option = 'TUON';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("KGA") != -1) {
				option = 'KGA';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("N퍼포먼스") != -1) {
				option = 'NPPMS';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("액세서리") != -1) {
				option = 'ACC';
				return false;
			}
		});
		
		if (e.target.tagName == 'SELECT') {
			sendGA('지역 시도', $(this).find(":selected").text());
		}
		
		var transUrl = '';
		
		if (document.getElementById("SETRNSST")) {
			transUrl = webUrl + "/service/transStep.php?Code="+tcod+"&Conf="+tset+"&option="+option;
			
			$("#SETRNSST").html("<option value=\"0\">출고장 선택</option>");
		}
		else {
			transUrl = webUrl + "/service/transCost.php?Code="+tcod+"&Conf="+tset+"&option="+option+"&model="+$("#scriptModel").val()+"&trim="+valCode.trms;
		}
		
		getHttprequest(transUrl, "SETRNSGU");
	});
	
	/* 탁송료 시군구 선택 */
	$(document).on("change","#SETRNSGU",function(e){
		tset = $(this).val();
		tcod = $("#SETRNSDO").attr("code");
		
		var option = '';		
		
		$("input[name='option']:checked").each(function (index, item) {
			
			// 관리자 페이지에서 추가된 출고장 옵션을 인식하기 위함
			var optionStr = $(this).parent().find("label").text();
			if ((optionStr.indexOf("[") != -1)) {
				var start = optionStr.indexOf('[') + 1;
				var end = optionStr.indexOf(']');
				var resultOption = optionStr.substring(start, end);
				
				if (resultOption != 'TUIX'&& resultOption != 'HGA' && resultOption != 'TUON' && resultOption != 'KGA' && resultOption != 'N퍼포먼스' && resultOption != '액세서리') {
					option = resultOption;
					return false;
				}
			}
			// ---
			
			if ($(this).parent().find("label").text().indexOf("TUIX") != -1) {
				option = 'TUIX';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("HGA") != -1) {
				option = 'HGA';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("TUON") != -1) {
				option = 'TUON';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("KGA") != -1) {
				option = 'KGA';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("N퍼포먼스") != -1) {
				option = 'NPPMS';
				return false;
			}
			
			if ($(this).parent().find("label").text().indexOf("액세서리") != -1) {
				option = 'ACC';
				return false;
			}
		});
		
		if(tset==0 || tset==""){
			alert("시군구를 선택하세요.");
		}
		else if(document.getElementById("SETRNSST")){	// 출고장
			getHttprequest(webUrl + "/service/transCost.php?Code="+tcod+"&Conf="+tset+"&option="+option+"&model="+$("#scriptModel").val()+"&trim="+valCode.trms, "SETRNSST");
			
			setTimeout(function() {
				if ($("#SETRNSST").val()) {
					tval = dnw_deChar2($("#SETRNSST").val());
					tmp = tval.split(":");
				}
				
				$("#eDiv_"+ebox+" .ePutTrnsSelf").val(tmp[0]);
				$("#eDiv_"+ebox+" .btnTrnsView").attr("conf",tval);
				$("#eDiv_"+ebox+" .btnTrnsView").attr("title",tmp[2]);
				calculate("trns","");
			}, 200);

			if (e.target.tagName == 'SELECT') {
				sendGA('지역 시군구', $(this).find(":selected").text());
			}
		}
		else{
			tval = dnw_deChar2($(this).val());
			tmp = tval.split(":");
			$("#eDiv_"+ebox+" .btnTrnsView").attr("conf",tval);
			calculate("trns","");
		}
	});
	
	// 탁송료 출고장 선택
	$(document).on("change","#SETRNSST",function(){
		tval = dnw_deChar2($(this).val());
		tmp = tval.split(":");
		$("#eDiv_"+ebox+" .ePutTrnsSelf").val(tmp[0]);
		$("#eDiv_"+ebox+" .btnTrnsView").attr("conf",tval);
		$("#eDiv_"+ebox+" .btnTrnsView").attr("title",tmp[2]);
		calculate("trns","");
		
		sendGA('출고장 선택', $(this).find(":selected").text());
	});
	
	/** 전기차 보조금 혜택>지역 선택 **/
	$(document).on("change","#EVSidoSelect",function(e){
		if($("#EVSidoSelect option:selected").val()) {
			$("#EVSigunguSelect").prev("label").addClass("hide");
		} else {
			$("#EVSigunguSelect").prev("label").removeClass("hide");
		}
		
		// 보조금 총합
		$("#totalIncentive").text($("#Incnt_1 .nGovIncentive").attr("data-govincentive")+"만 원");
		
		getHttprequestSync(webUrl + "/service/ajax_estimate_EVSigungu.php?trims="+valCode.trms+"&sido="+$(this).val()+"&option="+codes.itms, "EVSigunguSelect");
	});
	
	/** 전기차 보조금 혜택>시군구 선택 **/
	$(document).on("change","#EVSigunguSelect",function(e){
		var nGovPrice = $("#Incnt_1 .nGovIncentive").attr("data-govincentive");
		var nLocPrice = $("#EVSigunguSelect option:selected").data("price");
		var nLocRemainCount = $("#EVSigunguSelect option:selected").data("remaincount");
		var nTotPrice = 0;
		
		if(nLocRemainCount > 0) {
			nTotPrice = parseInt(nGovPrice)+parseInt(nLocPrice);
		} else {
			nTotPrice = parseInt(nGovPrice);
		}
		
		$("#totalIncentive").text(nTotPrice+"만 원");
		
		// 선택된 트림의 보조금 적용 문구
		var nSubsidy = Number(nGovPrice) + Number(nLocPrice);
		var strCarResultPrice = '';
		var selectedTargetObj = $("#trim_1" + valCode.trms).parent().find('.choice__price--subsidy');
		
		if(selectedTargetObj.hasClass('choice__price')) {
			var strCarDefaultPrice = $("#trim_1" + valCode.trms).parent().find("div.choice__price span.num").text();
			var nCarDefaultPrice = strCarDefaultPrice.replace(/,/g, "");
			var carResultPrice =  nCarDefaultPrice - nSubsidy;
			strCarResultPrice = carResultPrice.toLocaleString();
			
		} else if(selectedTargetObj.hasClass('box__subsidy')) {
			var strCarDefaultPrice = $("#trim_1" + valCode.trms).parent().find("div.box__right span.num").text();
			var nCarDefaultPrice = strCarDefaultPrice.replace(/,/g, "");
			var carResultPrice =  nCarDefaultPrice - nSubsidy;
			strCarResultPrice = carResultPrice.toLocaleString();
		}
		
		$("#trim_1" + valCode.trms).parent().find(".text__subsidy").text("보조금 적용 시 " + strCarResultPrice + "만 원");

		// 'selectEVSido' hidden 값에 선택된 시/도 값 저장
		$("#selectEVSido").val($("#EVSidoSelect option:selected").val());

		// 'selectEVSigungu' hidden 값에 선택된 시/군/구 값 저장
		$("#selectEVSigungu").val($("#EVSigunguSelect option:selected").val());
		
		$.ajax({
			type : "GET",
			url : webUrl + "/service/ajax_EVincentive_priceList.php",
			dataType : 'json',
			data : {
				modelCode : valCode.modl,
				sidoCode : $("#selectEVSido").val(),
				sigunguCode : $("#selectEVSigungu").val(),
				optionCode : codes.itms
			},
			success : function (data) {
				$(".choice__price--subsidy").each(function(index, item) {
					if($(this).hasClass('choice__price')) {
						var tmpIdStr = $(this).parent().parent().children('input').attr('id');
						var tmpIdArr = tmpIdStr.split('_1');
						
						if (tmpIdArr[1] != valCode.trms) {
							var strCarDefaultPrice = $(this).children(".txt").children().text();
							var nCarDefaultPrice = strCarDefaultPrice.replace(/,/g, "");
							var carResultPrice = 0;
							if (data) {
								carResultPrice = nCarDefaultPrice - (parseInt(data[tmpIdArr[1]]['nGovernmentIncentive']) + parseInt(data[tmpIdArr[1]]['nLocalIncentive']));
							} 
							else {
								carResultPrice = nCarDefaultPrice - nGovPrice;
							}
							
							var strCarResultPrice = carResultPrice.toLocaleString();
							$(this).children(".text__subsidy").text("보조금 적용 시 " + strCarResultPrice + "만 원");
						}
					} else if($(this).hasClass('box__subsidy')) {
						var tmpIdStr = $(this).parent().parent().parent().parent().find('input').attr('id');
						var tmpIdArr = tmpIdStr.split('_1');
						
						if (tmpIdArr[1] != valCode.trms) {
							var strCarDefaultPrice = $(this).parent().find('.num').text();
							var nCarDefaultPrice = strCarDefaultPrice.replace(/,/g, "");
							var carResultPrice = 0;
							if (data) {
								carResultPrice = nCarDefaultPrice - (parseInt(data[tmpIdArr[1]]['nGovernmentIncentive']) + parseInt(data[tmpIdArr[1]]['nLocalIncentive']));
							} 
							else {
								carResultPrice = nCarDefaultPrice - nGovPrice;
							}
							
							var strCarResultPrice = carResultPrice.toLocaleString();
							$(this).children(".text__subsidy").text("보조금 적용 시 " + strCarResultPrice + "만 원");
						}
					} 
				});
			},
			error : function () {
				alert('보조금 정보 호출 실패');
			}
		});
	
		calculate("incnt","");
	});
	
	//옵션 삭제
	$(document).on('click', '#info_summary .eSelOptionList .optionDel' , function(){
		$(".eChkItemList input[code='"+ $(this).attr('val') +"']").attr('checked',false);
		
		var itms = $(".eChkItemList input[code='"+ $(this).attr('val') +"']").attr("code");
		var ckd = false;
		ebox = '1';
		items_check(itms,ckd);	// 중복 제거, 의존 추가
		calculate("itms",itms);
		
		// 셀렉트박스 초기화
		$('#EVSidoSelect>option').prop("selected", false);
		$('#EVSigunguSelect>option').prop("selected", false);
		$('#EVSidoSelect>option:eq(0)').trigger("change");
		$('#EVSigunguSelect>option:eq(0)').trigger("change");
		
		calculate("incnt","");
		
		$("#totalIncentive").text($("#Incnt_1 .nGovIncentive").attr("data-govincentive")+"만 원");
	});
	
	//할인 삭제
	$(document).on('click', '#info_summary .eSelDiscountList .discountDel' , function(){
		if($(this).attr('val') == 'OUD0' || $(this).attr('val') == 'OUD1' || $(this).attr('val') == 'OUD2') {
			oldCarSel = ckd;
			
			var term = $(".eOldCar input[code='"+ $(this).attr('val') +"']").attr("code");
			
			$(".eOldCar input[code='"+ $(this).attr('val') +"']").attr('checked',false);
			$(".eChkTermList input[code='T99']").attr('checked',false);
		}
		else {
			$(".eChkTermList input[code='"+ $(this).attr('val') +"']").attr('checked',false);
			
			var term = $(".eChkTermList input[code='"+ $(this).attr('val') +"']").attr("code");
			var ckd = false;
			
			//제조사 할인 혜택 클릭시 국가 노후 경유차 세제혜택도 같이 선택
			if(term == 'T99') {
				oldCarSel = ckd;
				$("#Term_"+ebox+" .eOldCar input").attr('checked', oldCarSel);
			}					
		}
		
		if($(this).attr('val').indexOf("F") > -1) {
			if($(".eChkTrimList input[name='discountFinanceCheck_"+ $(this).attr('val') +"']").length > 0) {
				$(".eChkTrimList input[name='discountFinanceCheck_"+ $(this).attr('val') +"']").attr('checked',false);
			}
		} else if($(this).attr('val').indexOf("C") > -1) {
			if($(".eChkTrimList input[name='discountCashCheck_"+ $(this).attr('val') +"']").length > 0) {
				$(".eChkTrimList input[name='discountCashCheck_"+ $(this).attr('val') +"']").attr('checked',false);
			}
		}
		calculate("term",term);
	});
	
	// 할부 기간 변경
	$(document).on('change', '#compSelFincMons', function(){
		fset = $(this).val() + ":"+$("#compSelFincCaps").val() * 10000 +":";
		hasFincCNoAdChange = true;	// 할부원금 유지
		calculate("fincC", fset);

		sendGA('할부 기간', $(this).val()+"개월");
	});

	// 할부 금액 기간
	$(document).on('change', "#compSelFincCaps", function(){
		
		var val = $("#compSelFincCaps").val() * 10000;
		var consignmentFee = price.trns;
		var sellingPrice = price.total;
		var maxFiancePrincipal = 0;
		
		if (!$.isNumeric(consignmentFee)) {
			consignmentFee = 0;
		}
		
		maxFiancePrincipal = sellingPrice - consignmentFee;

		$("#compSelFincCaps").closest('.estimate-pay__prepay').find('.emphasis').html('* ' + number_format( number_round(maxFiancePrincipal, 1000000, 'ceil') / 1000000 ) + '만원 ~ ' + number_format( number_round(maxFiancePrincipal, 10000, 'floor') / 10000 ));
		
		// 2018.02.06 verere@danawa.com 할부원금 입력 가능 금액 변경 : 차량가격 1% ~ 100%
		if ((maxFiancePrincipal / 100) > val || val > maxFiancePrincipal) {
			alert('할부원금 금액은 ' + number_format( number_round(maxFiancePrincipal, 1000000, 'ceil') / 1000000 ) + '만원 ~ ' + number_format( number_round(maxFiancePrincipal, 10000, 'floor') / 10000 ) + '만원으로 설정해 주시기 바랍니다.');
			return 0;
		}
		else {
			fset = $("#compSelFincMons option:selected").val() + ":"+ val +":";	
			
			// 2018.03.02 verere@danawa.com 신차견적 구매요약 내 할부원금 변경시 광고상품 유지 기능 추가
			calculate("fincC_ad", fset);
		}
		
		sendGA('할부원금', '클릭');
	});
	
	$(document).on('change', '#compSelFincCaps' , function(e){
		if(e.which ==13) {
			$("#compSelFincCapsSubmit").click();
		}
	});
	
	// 할부 상품 변경
	$(document).on("click","[id ^= 'PUTFINCJ']",function(){
		$(this).closest('input').removeAttr('checked');
		$(this).closest('input').attr('checked', 'checked');

		var tmpId = $(this).attr("id");

		// 결제방법 탭 금액 표시하기
		if (tmpId != 'PUTFINCJ0') {
			$("#info_finance li:eq(0) .info").html("<span class='txt'>"+$("#" + tmpId).parent().find(".choice__price span.txt").text()+"~</span>");
		}
		else {
			$("#info_finance li:eq(0) .info").html("<span class='txt'></span>");
			
			// 추가 혜택이 제공되는 위 금융 상품 레이어 노출
			$("#result_finance").find("#addBenefitLayer").css('display', 'block');
			
			setTimeout(function() {
			  $("#result_finance").find("#addBenefitLayer").css('display', 'none');
			}, 5000);
		}
		
		fsel = tmpId.substring(tmpId.indexOf("J")+1);
		fset = $(this).attr("setFinc");
		
		$("#Finc_"+ebox+" .eSelFincGood").val(fsel);
		
		calculate("fincP",fset);
	});
	
	// 일시불 상품 변경
	$(document).on("click","[id ^= 'cashList_']",function(){
		var tmpId = $(this).attr("id");

		// 결제방법 탭 금액 표시하기
		$("#info_finance li:eq(1) .info").html($("#" + tmpId).parent().find(".choice__price span.txt").clone());
	});

	// 가격표/제원/사양/카달로그 팝업창 보기
	$(document).on("click",".eBtnLineupInfo button, #info_model a",function(){
		var eNo = 1;
		
		estmAct = eNo;
		ebox = estmAct;
		type = $(this).attr("cont");

		subject = $(this).text();
		code = rsltCode[ebox];
		brand = code.substring(0,3);
		model = code.substring(3,7);
		lineup = code.substring(7,12);
		trims = code.substring(12);
		
		if(!mobile){
			var loggerMobile = "(웹)";
		}
		else {
			var loggerMobile = "(모바일)";
		}

		if(type=="shop"){
			eval('try{ _trk_clickTrace( \'EVT\', \'자동차_백과_종합정보 버튼'+ loggerMobile +'\' ); }catch(_e){ }');

			sendGAExcpt('신차 견적_차량정보', '종합정보', model);
			
			if(brand=="316") {
				brand="312";
			}
			else if (brand=="322") {
				brand="321";
			}
			
			window.open("/auto/?Work=model&Model=" + model,"_blank" );
		}
		else if(type=="compare"){
			eval('try{ _trk_clickTrace( \'EVT\', \'자동차_백과_모델_모델비교 버튼'+ loggerMobile +'\' ); }catch(_e){ }');
			
			if(mobile) location.href="/compare/?Codes="+trims;
			else window.open("/compare/?Codes="+trims,"_blank" );
		}
		else if(type=="catalog"){
			eval('try{ _trk_clickTrace( \'EVT\', \'자동차_백과_모델_카탈로그 버튼'+ loggerMobile +'\' ); }catch(_e){ }');
			
			sendGAExcpt('신차 견적_차량정보', '카탈로그', model);
			
			if(mobile){
				window.open("/gallery/?Work=gallery_view&Model="+model+"&Tab=catalog&newwindow=2&title=카달로그");
			}
			else{
				if(gnb=="estimate"){
					window.open("/auto/?Work=model&Model="+model+"&Tab=catalog");
				}
				else{
					getHttprequest("/gallery/catalog.php?Tab=catalog&Model="+model,"popup_data");
					openPopup("카탈로그",1020,'');
				}
			}
		}
		else if (type) {
			if(type =='price') {
				eval('try{ _trk_clickTrace( \'EVT\', \'자동차_백과_모델_가격 버튼'+ loggerMobile +'\' ); }catch(_e){ }');

				sendGAExcpt('신차 견적_차량정보', '가격', model);
			}
			else if(type == 'spec') {
				eval('try{ _trk_clickTrace( \'EVT\', \'자동차_백과_모델_제원 버튼'+ loggerMobile +'\' ); }catch(_e){ }');

				sendGAExcpt('신차 견적_차량정보', '제원', model);
			}
			else if(type =='item') {
				eval('try{ _trk_clickTrace( \'EVT\', \'자동차_백과_모델_사양/옵션 버튼'+ loggerMobile +'\' ); }catch(_e){ }');

				sendGAExcpt('신차 견적_차량정보', '사양/옵션', model);
			}
			
			if(mobile){
				window.open("/service/ajax_spec_mobile.php?Type="+type+"&Lineup="+lineup+"&Trims="+trims+"&newwindow=2&title="+subject);
				return false;
			}
			else{
				getSpecPopup(type, lineup, subject, trims, model);
			}
		}
	});
	
	$(document).on('mouseover', '#modelColorList button', function(){
		colr = $(this).attr("color");
		titl = $(this).find("span").text();
		line = $(this).parent().attr('key');
		
		$(".eImgModel").attr("src","//autoimg.danawa.com/photo/"+valCode.modl + '/' + line +"/color_"+colr.substring(1)+"_360.png");
	});
	
	$(document).on('click' , '.eFincPopup', function(){
		$(this).addClass("on");

		var subject = '';
		var no = $(this).attr("no");
		var kind = $(this).attr("kind");
		var size = 500;
		var contents='';
		var location = '';

		subject = $(this).attr("subject");
		
		if(kind == 'itemInfo') {
			no = $(this).attr('val');
			getHttprequest("/gallery/itemImg_detail.php?no="+ no +"&kind=itemInfo","help_data");
		}
		/*
		else if(kind == 'incidenta') {
			//location = 'selfLeft';
			$("#help_data").html('다나와자동차 신차견적에 포함되는 등록/부대비용은 취득세와 채권할인(공채매입)에 부대비용이 추가된 금액입니다.<br/><br/> 부대비용은 증지대, 인지대, 번호판 탈/부착 등의 비용이며,다나와자동차는 평균 4만원으로 책정하여 견적에 반영하였으나, 등록지역이나 대행업체에 따라 다소 차이가 발생할 수 있습니다.');
		}
		*/
		else if(kind == 'dictionary') {
			no = $(this).attr('val');
			
			getHttprequest("/dictionary/dictionary.php?Dterm="+no, "layerPopup .g-layer__cont");

			if (no == 470 || no == 471 || no == 472) {
				openLayerPopup('near', '할인/비용 선택', $(this));
			}
			else {
				openLayerPopup('near', '용어사전', $(this));
			}
			
			return false;
		}
		else if(kind == 'option') {

		}else if(kind == 'hybridHelp') {
			var contents = '<div class="layer__hybrid">' +
                        '<div class="text__info">하이브리드 차량 취득세 감면액은 법안 통과 후 적용 예정</div>' +
                        '<div class="box__cont">' +
                            '<p class="text__cont">하이브리드 차량의 취득세를 최대 40만원까지 감면해 주는 정책이 2022년 12월 31일자로 일몰(종료) 되었습니다.</p>' +
                            '<p class="text__cont">이를 2024년까지 2년 더 연장하는 정책이 결정되었으나 \'지방세 특례 제한법 개정안\'이 최종 확정되지 않았습니다.</p>' +
                            '<p class="text__cont">2023년초 현재 대부분의 자동차 제조사와 수입사는 위 혜택을 미적용하여 차량을 판매하고 등록하고 있습니다.</p>' +
                            '<p class="text__cont">국회 행정 안전 위원회는 위 법안이 확정되어 시행되면 소급 적용하여 미적용 혜택을 환급해주는 부칙을 준비중입니다.</p>' +
                            '<p class="text__cont">다나와자동차의 신차견적 서비스는 2023년 2월 현재 하이브리드 차량의 취득세 최대 40만원 감면이 미적용되어 있습니다.</p>' +
                            '<p class="text__cont">관련 법안 통과시 다시 적용 할 예정이니 참조하시기 바랍니다.</p>' +
                        '</div></div>';
			$("#layerPopup .g-layer__cont").html(contents);
			openLayerPopup('near', '하이브리드 취득세 감면 안내', $(this));
		}
		else if(kind == 'termInfo') {

			getHttprequest(webUrl + "/service/help.php?no="+ $(this).attr('val') +"&kind="+kind, "layerPopup .g-layer__cont");
			
			openLayerPopup('near', '할인/비용 선택', $(this));

			return false;
		}
		else if(kind == 'termPopupExp') {
			getHttprequest(webUrl + "/service/help.php?no="+ $(this).attr('val') +"&kind="+kind, "popupTermExp_"+$(this).data('id'));
			return false;
		}
		else if (kind == 'rankPopup') {
			$(this).find("a").addClass('open');
			var contents = "<div class='layer__data-info'><p class='datainfo_txt'>다나와자동차는 월 3만건에 이르는 온라인 고객 <br> 상담자료를 빅데이터화 하여 <strong class='point'>모델과 옵션에 대한 <br> 선호도 자료를 제공</strong>합니다.</p><p class='datainfo_subtxt'>*다나와자동차 자체 온라인 상담문의 자료로 실제 <br> 계약/판매 자료와는 다를 수 있습니다.</p></div>";
			$("#layerPopup .g-layer__cont").empty().append(contents);
			openLayerPopup('near', "고객 선호도 데이터 제공", $(this));
			return false;
		}
		else if(kind == "event"){
			var eventLink = '/event/?Tab=event&Work=detail&Stab=ing&no=2919945';
			
			$("#help_data").html("<p class='info_detail_help'>할부원금 2,000만원 이상 시 파인뷰 LX2000(40만원상당)을 증정해드리는 이벤트로,<br/>자세한 신청 정보는 <a target='_blank' class='link_event' href='" + eventLink + "'>[이벤트 자세히 보기]</a>에서 확인하세요</p>");
		}
		else if(kind == "schedule"){
			var finceType = '';
			
			if(fince.kindC.substr(0,1) == "W"){
				var payOrigin = number_round(fince.cap / fince.mon,10,"round");
				finceType = 'W';
			}
			else if(fince.kindC.substr(0,1) == "G"){
				var payArr = fince.payM.split("~");
				finceType = 'G';
			}
			else{
				finceType = 'N';
			}
			
			var txt = "";
			var total = parseInt(fince.cap);		//원리금 합계
			var principal = parseInt(fince.cap);	//납임원금
			var principalSum = 0;					//납입누계
			var interest = parseInt(fince.itrSum);	//총 이자금액
			var ItrSum = 0;							//이자 누계
			var monthPay = 0;
			
			for(var a = 1 ; a<= fince.mon ; a++) {
				var payItr = 0; //납입 이자
				var payPrincipal = 0;  //납입 원금
				
				if(finceType == 'W') {	//원금균등
					monthPay = payOrigin + number_round(principal * fince.itr / 12 / 100,1,"round");
					principal = principal - payOrigin;
					payPrincipal = payOrigin;
					payItr = monthPay - payOrigin;
					principalSum += payPrincipal;
					ItrSum += payItr;
				}
				else if(finceType =='G') {	//거치형
					if(a <= fince.monG) {
						monthPay = payArr[0];
						payItr = number_round(principal * fince.itr / 12 / 100,1,"round");
						ItrSum += payItr;
					}
					else {
						monthPay = payArr[1];
						payItr = number_round(principal * fince.itr / 12 / 100,1,"round");
						payPrincipal = monthPay - payItr;
						principal = principal - payPrincipal;
						principalSum += payPrincipal; 
						ItrSum += payItr;
					}
					
				}
				else {	//원리금균등
					monthPay = fince.payEv;
					payItr = number_round(principal * fince.itr / 12 / 100,1,"round");
					payPrincipal = monthPay - payItr;
					principal = principal - payPrincipal;
					principalSum += payPrincipal; 
					ItrSum += payItr;
					
				}
				
				//마지막회차 대출 잔액 맞추기
				if(a == fince.mon) {
					var originPayPrincipal = payPrincipal;
					var originPayItr = payItr;
					payPrincipal = total;
					if(fince.kindC.substr(0,1) != "U") {
						payItr = monthPay - payPrincipal;						
					}else {
						payItr = monthPay - payPrincipal + fince.rem;
					}
					monthPay = payPrincipal + payItr;
					principalSum += payPrincipal - originPayPrincipal;
					ItrSum += payItr - originPayItr;
				}
				
				total = (total - payPrincipal);
				
				if(mobile) {
					txt += "<tr>";
					txt += "	<td class='nth_01 bold dark' rowspan='2'>"+ a +"<br />회차</td>";
					txt += "	<td class='nth_02 bold blue'>"+ number_format(monthPay); +"</td>";
					txt += "	<td class='nth_03'>"+ number_format(payPrincipal) +"</td>";
					txt += "	<td class='nth_04'>"+ number_format(payItr) +"</td>";
					txt += "</tr>";
					txt += "<tr>";
					txt += "	<td class='nth_05'>"+ number_format(principalSum) +"</td>";
					txt += "	<td class='nth_06'>"+ number_format(ItrSum) +"</td>";
					txt += "	<td class='nth_07'>"+ number_format(total) +"</td>";
					txt += "</tr>";
				}
				else {
					txt += "<tr>";
					txt += "	<td class='nth_01 bold dark'>"+ a +"회차</td>";		//납입회차
					txt += "	<td class='nth_02 bold blue'>"+ number_format(monthPay); +"</td>";		//월납입액
					txt += "	<td class='nth_03'>"+ number_format(payPrincipal) +"</td>";					//납입 원금
					txt += "	<td class='nth_04'>"+ number_format(payItr) +"</td>";					//납입 이자
					txt += "	<td class='nth_05'>"+ number_format(principalSum) +"</td>";				//원금 누계
					txt += "	<td class='nth_06'>"+ number_format(ItrSum) +"</td>";					//이자 누계
					txt += "	<td class='nth_07'>"+ number_format(total) +"</td>";				//대출잔액
					txt += "</tr>";
				}
			}
			
			var finceItrEv = fince.itrSum / fince.mon;	//평균이자
			
			size = 620;
			
			if(mobile) {
				contents += "<table class='table_detail' cellspacing='0' id=''>";
				contents += "		<caption>조달비용 상세</caption>";
				contents += "		<tbody>";
				contents += "			<tr>";
				contents += "				<th>할부 원금</th>";
				contents += "				<td>"+ number_format(fince.cap) +"</td>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th>월 평균 이자</th>";
				contents += "				<td>"+ number_format(finceItrEv) +"</td>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th>대출 기간</th>";
				contents += "				<td>"+ fince.mon +"개월</td>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th>총 이자</th>";
				contents += "				<td>"+ number_format(fince.itrSum) +"</td>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th>적용금리</th>";
				contents += "				<td class='blue'>"+ fince.itr +"%</td>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th>원리금 합계</th>";
				contents += "				<td class='blue'>"+ number_format(fince.cap + fince.itrSum) +"</td>";
				contents += "			</tr>";
				contents += "		</tbody>";
				contents += "</table>";
				contents += "<table class='table_schedule' cellspacing='0' id=''>";
				contents += "		<caption>상환스케쥴</caption>";
				contents += "		<thead>";
				contents += "			<tr>";
				contents += "				<th class='nth_01' rowspan='2'>회차</th>";
				contents += "				<th class='nth_02'>월 납입액</th>";
				contents += "				<th class='nth_03'>납입 원금</th>";
				contents += "				<th class='nth_04'>납입 이자</th>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th class='nth_05'>원금 누계</th>";
				contents += "				<th class='nth_06'>이자 누계</th>";
				contents += "				<th class='nth_07'>대출 잔액</th>";
				contents += "			</tr>";
				contents += "		</thead>";
				contents += "		<tbody>";
				contents +=  txt;
				contents += "		</tbody>";
				contents += "</table>";
			}
			else {
				contents += "<table class='table_detail' cellspacing='0' id=''>";
				contents += "		<caption>조달비용 상세</caption>";
				contents += "		<tbody>";
				contents += "			<tr>";
				contents += "				<th>할부 원금</th>";
				contents += "				<td>"+ number_format(fince.cap) +"</td>";
				contents += "				<th>월 평균 이자</th>";
				contents += "				<td>"+ number_format(finceItrEv) +"</td>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th>대출 기간</th>";
				contents += "				<td>"+ fince.mon +"개월</td>";
				contents += "				<th>총 이자</th>";
				contents += "				<td>"+ number_format(fince.itrSum) +"</td>";
				contents += "			</tr>";
				contents += "			<tr>";
				contents += "				<th>적용금리</th>";
				contents += "				<td class='blue'>"+ fince.itr +"%</td>";
				contents += "				<th>원리금 합계</th>";
				contents += "				<td class='blue'>"+ number_format(fince.cap + fince.itrSum) +"</td>";
				contents += "			</tr>";
				contents += "		</tbody>";
				contents += "</table>";
				contents += "<table class='table_schedule' cellspacing='0' id=''>";
				contents += "		<caption>상환스케쥴</caption>";
				contents += "		<thead>";
				contents += "			<tr>";
				contents += "				<th class='nth_01'>납입 회차</th>";
				contents += "				<th class='nth_02'>월 납입액</th>";
				contents += "				<th class='nth_03'>납입 원금</th>";
				contents += "				<th class='nth_04'>납입 이자</th>";
				contents += "				<th class='nth_05'>원금 누계</th>";
				contents += "				<th class='nth_06'>이자 누계</th>";
				contents += "				<th class='nth_07'>대출 잔액</th>";
				contents += "			</tr>";
				contents += "		</thead>";
				contents += "		<tbody>";
				contents += txt;
				contents += "		</tbody>";
				contents += "</table>";
			}
			
			$("#help_data").html(contents);
		}
		else if(kind == "cashback") {
			$("#help_data").html("<p class='info_detail_help'>할부금을 제외한 금액(선수금)을 카드로 결제 시 금액의 1~1.2% 혜택을 제공해드립니다.</br>※ 금액별 캐시백률</br>- 100만원 이상 ~ 2,000만원 미만: 1.0%</br>- 2,000만원 이상: 1.2%</p>");
		}
		else if(kind == "gas_coupon") {
			var keepMonth = 6;
			
			size = 520;
						
			$("#help_data").html("<p class='info_detail_help'>국산 신차 1,000만원 이상 대출 시 주유쿠폰을 매월 만원(5천원권 2장)씩 "+ keepMonth +"개월 연속증정"
				+ "<br/>자세한 신청 정보는 <a target='_blank' class='link_event' href='/event/?Tab=event&Work=detail&Stab=ing&no=3003993'>[이벤트 자세히 보기]</a>에서 확인하세요</p>");
		}
		else if (kind == "repayment") {
			$("#help_data").html("중도상환 수수료 면제: 언제 상환해도 중도 상환수수료 0%<br />대출기록 남지 않음: 대출기록 남지 않아, 대출한도, 신용등급 영향 없음!");
		}
		// 2018.08.14 verere@danawa.com
		else if(kind == "cashbackC") {
			$("#help_data").html("<p class='info_detail_help'>차량가(옵션 가격을 포함한)에 대해 캐시백을 제공해드립니다.</p>");
		}
		
		if(kind != "hybridHelp") {
			openHelp(subject,size,location);
		}
		return false;
	});
	
	$(document).on('click', "#result_cash .radio_cash", function(){
		$("#result_cash > li").removeClass("on");
		$(this).parent().parent().closest('li').addClass("on");
		
		calculate('cashC','');
	});

	// 일시불 금액 변경
	$(document).on('change', "#compSelCashCaps", function(){
		$("#compSelCashCaps").attr('kind', 'handWork');
		
		var val = $("#compSelCashCaps").val() * 10000;
		
		if(val > price.total) {
			alert('일시불 결제는 차량가격을 넘을수 없습니다.');
		}
		else {
			calculate('cashP',val);			
		}

		sendGA('카드결제금액', '클릭');
	})
	
	/* 옵션 선택 : 가격표 */
	$(document).on("click",".pChkItemList input",function(){
		ebox = $(this).closest(".pChkItemList").attr("ebox");
		var itms = $(this).attr("code");
		var ckd = $(this).is(":checked");
		if(ckd){
			$(this).closest("li").addClass("sel");
			
			sendGA('옵션 선택', $(this).next().text());
		}else{
			$(this).closest("li").removeClass("sel");
		}
		
		items_check(itms,ckd);	// 중복 제거, 의존 추가
		
		calculate_cost();
	});
	
	/*  옵션 선택 : 제원표  */
	$(document).on("click",".iChkItemList input",function(){
		ebox = $(this).closest("td").attr("ebox");
		if (ebox == undefined) {
			ebox = $(this).closest("li").attr("ebox");
		}
		var itms = $(this).attr("code");
		var ckd = $(this).is(":checked");
		if(ckd) {
			$(this).closest("div").addClass("sel");
		} else {
			$(this).closest("div").removeClass("sel");
		}
		
		items_check(itms,ckd);	// 중복 제거, 의존 추가
		calculate_cost();
		
		setTimeout(function(){
			var newH = $(".model_data_head ."+ebox).parent().outerHeight();
			$(".model_data_head .price li.title").css("height",newH+"px");
		}, 40);
	});
	
	$(document).on("click", "#result_finance div[id^='eRsltPrimeRate'] input", function(){
		var rate = 0;
		var divID = $(this).closest(".cont").prop('id');
		var finceCode = divID.split("_")[1];
		var toFixLength = ((fince.itr).length < 4) ? 2 :  (fince.itr).length - 2;

		if (divID && finceCode) {
			$("#financeList_"+finceCode+" input[id^='pay']").each(function(i, e){
				if ($(e).is(":checked")) {
					rate += $(e).data('value');
				}
			})

			var price = number_round(finance_payment(fince.mon,(fince.itr - rate).toFixed(toFixLength),fince.cap,0),1,'floor');

			$("#info_finance li:eq(0) .info .txt").text("월 "+number_format(price)+"원~")
			$("#financeList_"+finceCode).find(".choice__price .txt").text("월 "+number_format(price)+"원")
			$("#financeList_"+finceCode).find(".choice__price .subtxt").text("("+(fince.itr - rate).toFixed(toFixLength)+"%)")
			$("#financeList_"+finceCode).find(".estimate-pay__rate--btm .rate_num").text(""+(fince.itr - rate).toFixed(toFixLength)+"%")
		}
	})
	
	/** 추가 혜택 플로팅 배너 닫기 이벤트 **/
	$(document).on("click","#addBenefitLayerCloseBtn",function(){
		$("#result_finance").find("#addBenefitLayer").css('display', 'none');
	});
	
	/** 견적 페이지 외장 색상 선택 **/
	$(document).on('click', "#estimateExteriorColorList button", function(){
		var choiceChk = false;
		if($(this).hasClass("choice-color--choice") === false) {
			choiceChk = true;
		}
		//choiceChk = true;
		var selectedColor = '';
		var carCode = '';
		var optionCode = $(this).data('optioncode');
		
		if ($(this).hasClass("choice-color--choice")) {
			$(this).removeClass("choice-color--choice");
		} else {
   			$('#estimateExteriorColorList .choice-color__item').removeClass('choice-color--choice');
			$(this).addClass('choice-color--choice');	
		}
		
		$("#eDiv_1 #estimateExteriorColorDiv").empty();
		
		$("#estimateExteriorColorList button").each(function () {
			if ($(this).hasClass("choice-color--choice")) {    					
				var percentText = '';

				if ($(this).data('percent') != '') {
					percentText = "<span class='rate'>선택률: <span class='num'>"+$(this).data('percent')+"%</span></span>";
				}
				
				selectedColor += "," + $(this).attr("color") + ":" + $(this).find(".blind").text();
				$("#eDiv_1 #estimateExteriorColorDiv").append("<p class='txt'>"+$(this).find(".blind").text()+percentText+"</p>");
			}
		});

		if (selectedColor.length > 1) {
			selectedColor = selectedColor.substr(1, selectedColor.length);
		}

		$("#eDiv_1 input[name='color']").val(selectedColor);
		
		if(choiceChk) {
			var colorGroupArray = [];
			
			$(".choice-color--choice").each(function() {
				var colorGroup = $(this).attr("group");
				if(colorGroup != "") {
					if(colorGroup.indexOf(",") > -1) {
						var tempArray = colorGroup.split(",");
						tempArray.forEach(function(item){
							colorGroupArray.push(item);
						});
					} else {
						colorGroupArray.push($(this).attr("group"));
					}   						
				}
			});

			$("#estimateInteriorColorList button").removeClass('choice-color--disable');
			$("#estimateInteriorColorList button").removeAttr('disabled');
			
			$("#estimateExteriorColorList button").removeClass('choice-color--disable');
			$("#estimateExteriorColorList button").removeAttr('disabled');
			
			colorGroupArray.forEach(function(item){
				$("#estimateExteriorColorList button").each(function () {
					if($(this).hasClass("choice-color--choice") === false) {
						if($(this).attr("group").indexOf(item) > -1) {
							$(this).addClass('choice-color--disable');
							$(this).attr('disabled', 'disabled');								
						} 
					}
				});
				
				$("#estimateInteriorColorList button").each(function () {
					if($(this).hasClass("choice-color--choice") === false) {
						if($(this).attr("group").indexOf(item) > -1) {
							$(this).addClass('choice-color--disable');
							$(this).attr('disabled', 'disabled');								
						}							
					}
				});
			});
		}
		
		// 옵션 연동하기
		setDependOption("estimateExteriorColorList", optionCode);

		setEstimateParam();
	});
	
	/** 견적 페이지 내장 색상 선택 **/
	$(document).on('click', "#estimateInteriorColorList button", function(){
		var choiceChk = false;
		if($(this).hasClass("choice-color--choice") === false) {
			choiceChk = true;
		}
		//choiceChk = true;
		var selectedColor = '';
		var optionCode = $(this).data('optioncode');
		
		if ($(this).hasClass("choice-color--choice")) {
			$(this).removeClass("choice-color--choice");
		} else {
			$('#estimateInteriorColorList .choice-color__item').removeClass('choice-color--choice');
			$(this).addClass('choice-color--choice');					
		}
		
		$("#eDiv_1 #estimateInteriorColorDiv").empty();
		
		$("#estimateInteriorColorList button").each(function () {
			if ($(this).hasClass("choice-color--choice")) {
				selectedColor += "," + $(this).attr("color") + ":" + $(this).find(".blind").text();
				
				var percentText = '';
				   
				if ($(this).data('percent') != '') {
					percentText = "<span class='rate'>선택률: <span class='num'>"+$(this).data('percent')+"%</span></span>";
				}
				
				$("#eDiv_1 #estimateInteriorColorDiv").append("<p class='txt'>"+$(this).find(".blind").text()+percentText+"</p>")
			}
		});
		
		if (selectedColor.length > 1) {
			selectedColor = selectedColor.substr(1, selectedColor.length);
		}
		
		$("#eDiv_1 input[name='interiorColor']").val(selectedColor);
		
		if(choiceChk) {
			var colorGroupArray = [];
			
			$(".choice-color--choice").each(function() {
				var colorGroup = $(this).attr("group");
				if(colorGroup != "") {
					if(colorGroup.indexOf(",") > -1) {
						var tempArray = colorGroup.split(",");
						tempArray.forEach(function(item){
							colorGroupArray.push(item);
						});
					} else {
						colorGroupArray.push($(this).attr("group"));
					}							
				}
			});

			$("#estimateInteriorColorList button").removeClass('choice-color--disable');
			$("#estimateInteriorColorList button").removeAttr('disabled');
			
			$("#estimateExteriorColorList button").removeClass('choice-color--disable');
			$("#estimateExteriorColorList button").removeAttr('disabled');
			
			colorGroupArray.forEach(function(item){
				$("#estimateInteriorColorList button").each(function () {
					if($(this).hasClass("choice-color--choice") === false) {
						if($(this).attr("group").indexOf(item) > -1) {
							$(this).addClass('choice-color--disable');
							$(this).attr('disabled', 'disabled');								
						} 
					}
				});
				
				$("#estimateExteriorColorList button").each(function () {
					if($(this).hasClass("choice-color--choice") === false) {
						if($(this).attr("group").indexOf(item) > -1) {
							$(this).addClass('choice-color--disable');
							$(this).attr('disabled', 'disabled');								
						}							
					}
				});
			});
		}
		
		// 옵션 연동하기
		if (optionCode) {
			setDependOption("estimateInteriorColorList", optionCode);
		}

		setEstimateParam();
	});		
	
	$(document).on("click", "button[id^='choiceDependOption_']", function(){

		if ($("#popupItem_1"+$(this).data('code')).length) {
			$("#popupItem_1"+$(this).data('code')).prop("checked", true).click().prop("checked", true);
		}
	})
});

function openDependOptionPopup(text) {
	$("#layerPopup .g-layer__cont").empty().append("<div class='layer__data-info'><b>'" + text +"'</b> 옵션이 필수 옵션으로 함께 선택되었습니다.</div>");
	
	if (bIsMobile) {
		openLayerPopup('', "필수 옵션 안내");
	} else {
		openLayerPopup('full', "필수 옵션 안내", $(this));
	}
}

function openDependOptionChoice(text) {
	$('#layerPopup .g-layer__cont').empty().append("<div class='layer__option'><div class='text__info'>필수 옵션 중 하나를 선택해주세요.</div><div class='box__option'>"+text+"</div></div>");
	
	if (bIsMobile) {
		openLayerPopup('', "필수 옵션 안내");
	} else {
		openLayerPopup('full', "필수 옵션 안내", $(this));
	}
}